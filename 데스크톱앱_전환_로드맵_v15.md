# 인사관리시스템 데스크톱 앱 전환 로드맵

## 📋 문서 정보
- **작성일**: 2026년 1월 23일
- **최종 수정일**: 2026년 2월 6일
- **버전**: v15.3
- **목표**: 웹앱 → Electron 데스크톱 앱 전환
- **예상 총 기간**: 17~23시간 (10단계)
- **현재 진행 상태**: ✅ **전체 완료** 🎉
- **최신 앱 버전**: v1.0.33 (GitHub Release)
- **최신 릴리즈**: https://github.com/mangfeel/hr-system/releases
- **저장소 상태**: Public (향후 Private 전환 검토 — [향후 과제](#-향후-과제--github-저장소-private-전환) 참고)

---

## 📖 배경 및 목적

### 1. 현재 상태 (웹앱)

```
[브라우저]
    │
    ├── F12로 소스 코드 보임 ⚠️
    ├── 핵심 로직 → 서버 API (보호됨 ✅)
    ├── UI/API 호출 코드 → 노출됨 ⚠️
    └── 데이터 → localStorage
```

**문제점**:
- F12 개발자 도구로 클라이언트 코드 노출
- UI 구조, API 호출 패턴 등 분석 가능

### 2. 목표 상태 (데스크톱 앱)

```
[Windows 앱 - Electron]
    │
    ├── F12 소스 노출 방지 ✅
    ├── 핵심 로직 → 서버 API (유지) ✅
    ├── 데이터 → 로컬 파일 (암호화) ✅
    └── 라이선스 키 시스템 ✅
```

**달성 목표**:
| 목표 | 설명 |
|------|------|
| 코드 보호 | F12로 소스 노출 방지 |
| 라이선스 관리 | 사용 기간 제어 가능 |
| 구독 시스템 기반 | 향후 유료 전환 대비 |
| 자동 업데이트 | 새 버전 알림 및 설치 |

---

## 💻 개발 환경 및 폴더 구조

### 1. 로컬 PC 폴더 구조

#### C:\hr-system (클라이언트 - 메인 작업 폴더)

```
C:\hr-system\
│
├── index.html              # Vercel 진입점 (→ 소개 페이지로 변경 예정)
├── login.html              # 로그인/회원가입 페이지
├── 메인_인사.html          # 메인 애플리케이션
│
├── package.json            # ← NEW (Electron 설정)
├── main.js                 # ← NEW (Electron 메인 프로세스)
├── preload.js              # ← NEW (보안 브릿지)
│
├── css/
│   ├── 근로계약서_스타일.css
│   ├── 스타일_인사.css
│   ├── 인사카드_스타일.css
│   ├── 통계분석_스타일.css
│   ├── 포상관리_스타일.css
│   └── 호봉획정표_스타일.css
│
├── js/
│   ├── 초기화_인사.js
│   │
│   ├── auth/               # 인증 (Supabase 연동)
│   │   ├── auth_인사.js
│   │   └── supabase_인사.js
│   │
│   ├── career/             # 경력 관리
│   │   ├── 경력관리_인사.js
│   │   └── 경력편집_인사.js
│   │
│   ├── config/             # 설정/상수
│   │   └── 상수_인사.js
│   │
│   ├── core/               # 핵심 모듈
│   │   ├── API_인사.js         # 서버 API 호출
│   │   ├── 검증_인사.js
│   │   ├── 데이터베이스_인사.js  # ← 수정 예정 (localStorage → 파일)
│   │   └── 호봉계산기_인사.js
│   │
│   ├── employee/           # 직원 관리
│   │   ├── 직원등록_인사.js
│   │   ├── 직원목록_인사.js
│   │   ├── 직원상세_인사.js
│   │   └── 직원수정_인사.js
│   │
│   ├── hr/                 # 인사 업무
│   │   ├── 근로계약서_인사.js
│   │   ├── 단축근로_인사.js
│   │   ├── 육아휴직_인사.js
│   │   ├── 인사발령_인사.js
│   │   ├── 퇴사관리_인사.js
│   │   └── 포상등록_인사.js
│   │
│   ├── labor/              # 급여/근로
│   │   ├── 급여계산기_인사.js
│   │   ├── 급여설정_인사.js
│   │   ├── 급여현황_인사.js
│   │   └── 시간외근무_인사.js
│   │
│   ├── reports/            # 리포트/현황표
│   │   ├── 근속현황표_인사.js
│   │   ├── 연명부_인사.js
│   │   ├── 인사카드_인사.js
│   │   ├── 입사자목록_인사.js
│   │   ├── 조직도_인사.js
│   │   ├── 통계분석_인사.js
│   │   ├── 퇴사자목록_인사.js
│   │   ├── 포상현황_인사.js
│   │   └── 호봉획정표_인사.js
│   │
│   ├── system/             # 시스템 기능
│   │   ├── 검색_인사.js
│   │   ├── 겸직관리_인사.js
│   │   ├── 네비게이션_인사.js
│   │   ├── 백업_인사.js        # ← 수정 예정 (파일 저장 방식)
│   │   ├── 복원가져오기_인사.js  # ← 수정 예정
│   │   └── 조직도설정_인사.js
│   │
│   ├── utils/              # 유틸리티
│   │   ├── DOM유틸_인사.js
│   │   ├── 로거_인사.js
│   │   ├── 에러처리_인사.js
│   │   ├── 인쇄유틸_인사.js
│   │   └── 직원유틸_인사.js
│   │
│   └── license/            # ← NEW (라이선스 관련)
│       ├── license_인사.js     # 라이선스 검증 로직
│       └── storage_인사.js     # 로컬 데이터 저장 (electron-store)
│
├── assets/                 # ← NEW (앱 리소스)
│   ├── icon.ico
│   └── icon.png
│
├── build/                  # ← NEW (빌드 설정)
│   └── electron-builder.yml
│
└── dist/                   # ← NEW (빌드 결과물)
    ├── 인사관리시스템_Setup_x.x.x.exe
    └── latest.yml
```

#### C:\hr-system-server (서버 API - Edge Functions)

```
C:\hr-system-server\
│
├── .vscode/
│   ├── extensions.json
│   └── settings.json
│
└── supabase/
    ├── config.toml
    │
    ├── .temp/              # Supabase CLI 임시 파일
    │
    └── functions/          # Edge Functions (서버 API)
        │
        ├── calculate-batch/        # 배치 호봉 계산
        │   └── index.ts
        │
        ├── calculate-overtime/     # 시간외수당 계산
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-rank/         # 호봉 계산 (통합)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-rank-utils/   # 호봉 계산 (개별 함수)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-salary/       # 급여 계산
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── hello-world/            # 연결 테스트용
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── validate-employee/      # 직원 데이터 검증
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── validate-license/       # ← NEW (라이선스 검증)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        └── generate-license/       # ← NEW (라이선스 생성)
            ├── .npmrc
            ├── deno.json
            └── index.ts
```

### 2. 관련 URL 및 서비스

| 항목 | URL/경로 | 설명 |
|------|----------|------|
| 웹앱 (현재) | https://hr-system-phi-bluish.vercel.app | Vercel 배포 |
| Supabase 프로젝트 | https://pulanyznvpsrlkpqotat.supabase.co | 백엔드/DB |
| Supabase 대시보드 | https://supabase.com/dashboard | 관리 콘솔 |
| GitHub 저장소 | https://github.com/mangfeel/hr-system | 소스 코드 |
| Vercel 대시보드 | https://vercel.com/dashboard | 배포 관리 |

---

## 🔧 작업 흐름 (중요!)

### 파일 수정/생성 작업 절차

```
[1] Claude가 파일 제공
    │
    ▼
[2] 사용자가 다운로드 (C:\Users\김화겸\Downloads\)
    │
    ▼
[3] PowerShell에서 파일 복사
    │
    ▼
[4] Git 커밋/푸시
    │
    ▼
[5] (서버 API인 경우) Supabase 배포
```

### PowerShell 명령어 템플릿

#### 클라이언트 파일 복사 (C:\hr-system)

```powershell
# 단일 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\[파일명]" "C:\hr-system\[경로]\[파일명]" -Force

# 예시: main.js 복사
Copy-Item "C:\Users\김화겸\Downloads\main.js" "C:\hr-system\main.js" -Force

# 예시: js/core 폴더에 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\API_인사.js" "C:\hr-system\js\core\API_인사.js" -Force

# 예시: 새 폴더 생성 후 파일 복사
New-Item -ItemType Directory -Path "C:\hr-system\js\license" -Force
Copy-Item "C:\Users\김화겸\Downloads\license_인사.js" "C:\hr-system\js\license\license_인사.js" -Force
```

#### Git 커밋/푸시 (C:\hr-system)

```powershell
# hr-system 폴더로 이동
cd C:\hr-system

# 변경사항 확인
git status

# 모든 변경사항 스테이징
git add .

# 커밋 (메시지는 작업 내용에 맞게 수정)
git commit -m "1단계: Electron 기본 설정"

# 푸시
git push
```

#### 서버 API 파일 복사 및 배포 (C:\hr-system-server)

```powershell
# 서버 폴더로 이동
cd C:\hr-system-server

# 새 함수 폴더 생성
New-Item -ItemType Directory -Path "supabase\functions\validate-license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\index.ts" "C:\hr-system-server\supabase\functions\validate-license\index.ts" -Force

# Supabase에 함수 배포
npx supabase functions deploy validate-license --project-ref pulanyznvpsrlkpqotat
```

#### 폴더 구조 확인

```powershell
# hr-system 폴더 구조 확인
tree C:\hr-system /F | Select-Object -First 100

# hr-system-server 폴더 구조 확인
tree C:\hr-system-server /F | Select-Object -First 100

# 특정 폴더만 확인
Get-ChildItem C:\hr-system\js\core
```

---

## 🏗️ 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│  사용자 PC                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  인사관리시스템.exe (Electron)                       │   │
│  │                                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
│  │  │ UI/화면     │  │ 데이터 저장  │  │ 라이선스   │  │   │
│  │  │ (HTML/JS)   │  │ (로컬 파일)  │  │ (암호화)   │  │   │
│  │  └─────────────┘  └─────────────┘  └────────────┘  │   │
│  │         │                                │         │   │
│  └─────────┼────────────────────────────────┼─────────┘   │
│            │                                │             │
└────────────┼────────────────────────────────┼─────────────┘
             │ API 호출                       │ 라이선스 검증
             ▼                                ▼
┌─────────────────────────────────────────────────────────────┐
│  서버 (Supabase)                                            │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │ Edge Functions  │  │ Database        │                  │
│  │                 │  │                 │                  │
│  │ - 호봉 계산     │  │ - users         │                  │
│  │ - 급여 계산     │  │ - profiles      │                  │
│  │ - 경력 환산     │  │ - licenses ←NEW │                  │
│  │ - 배치 API     │  │                 │                  │
│  │ - 라이선스 검증 │  │                 │                  │
│  └─────────────────┘  └─────────────────┘                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────────────────────────┐
│  GitHub Releases (업데이트 서버)                             │
│                                                             │
│  - latest.yml (최신 버전 정보)                              │
│  - 인사관리시스템_Setup_x.x.x.exe                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 데이터 저장 위치

| 항목 | 저장 위치 | 방식 | 이유 |
|------|----------|------|------|
| 직원 정보 (개인정보) | **로컬 PC** | 암호화 파일 | 개인정보보호 |
| 급여 데이터 | **로컬 PC** | 암호화 파일 | 민감정보 |
| 백업/복원 데이터 | **로컬 PC** | JSON 파일 | 사용자 데이터 |
| 설정 (조직명, 급여표 등) | **로컬 PC** | 암호화 파일 | 사용자 데이터 |
| 라이선스 키 | **로컬 PC** | 암호화 저장 | 자동 로그인 |
| 핵심 계산 로직 | **서버** | Edge Function | 코드 보호 |
| 회원 정보 | **서버** | Supabase Auth | 로그인/인증 |
| 라이선스 정보 | **서버** | Supabase DB | 유효성 검증 |

### 웹앱 vs 데스크톱 앱 비교

| 항목 | 웹앱 (현재) | 데스크톱 앱 |
|------|------------|------------|
| 저장 방식 | localStorage | 로컬 파일 (electron-store) |
| 저장 위치 | 브라우저 내부 | `C:\Users\사용자\AppData\...` |
| 백업/복원 | JSON 파일 | JSON 파일 (동일) |
| 용량 제한 | 약 5~10MB | **제한 없음** ✅ |
| 암호화 | 없음 | **AES 암호화** ✅ |

---

## 👤 사용자 경험 흐름

### 1. 최초 사용자 (신규 가입)

```
[1] 다운로드
    hr-system.vercel.app 접속 (소개 페이지)
         │
         ▼
    ┌─────────────────────────────┐
    │  🏢 인사관리시스템           │
    │                             │
    │  • 기능 소개                │
    │  • 스크린샷                 │
    │                             │
    │  [다운로드 (Windows)]       │
    └─────────────────────────────┘
         │
         ▼
    인사관리시스템_Setup.exe 다운로드 (GitHub Releases)

[2] 설치
         │
         ▼
    Setup.exe 실행
         │
         ▼
    ┌─────────────────────────────┐
    │  설치 마법사                 │
    │                             │
    │  ☑ 바탕화면 바로가기 생성   │
    │  ☑ 시작메뉴 등록            │
    │                             │
    │  [다음] → [설치] → [완료]   │
    └─────────────────────────────┘
         │
         ▼
    바탕화면 아이콘 생성

[3] 회원가입
         │
         ▼
    앱 실행
         │
         ▼
    ┌─────────────────────────────┐
    │  🔐 로그인                   │
    │                             │
    │  이메일: [            ]     │
    │  비밀번호: [            ]   │
    │                             │
    │  [로그인] [회원가입]         │
    └─────────────────────────────┘
         │
         ▼
    회원가입 폼 (이메일, 비밀번호, 이름, 기관명)
         │
         ▼
    "가입 완료! 관리자 승인을 기다려주세요"

[4] 관리자 승인 (운영자)
         │
         ▼
    Supabase 대시보드 또는 관리자 페이지
         │
         ▼
    승인 + 라이선스 키 발급 + 만료일 설정
         │
         ▼
    사용자에게 이메일 발송
    "승인 완료! 라이선스 키: XXXX-XXXX-XXXX-XXXX"

[5] 라이선스 등록
         │
         ▼
    앱 실행 → 로그인
         │
         ▼
    ┌─────────────────────────────┐
    │  🔑 라이선스 키 등록         │
    │                             │
    │  키: [XXXX-XXXX-XXXX-XXXX] │
    │                             │
    │  ☑ 이 기기에 저장           │
    │                             │
    │  [등록]                     │
    └─────────────────────────────┘
         │
         ▼
    서버 검증 → 성공 → 로컬 암호화 저장

[6] 사용 시작
         │
         ▼
    ┌─────────────────────────────────────┐
    │  🏢 인사관리시스템                   │
    │                                     │
    │  📅 라이선스: 2026.12.31까지 (342일)│
    │                                     │
    │  [직원관리] [보고서] [설정] ...     │
    └─────────────────────────────────────┘
```

### 2. 기존 사용자 (이후 접속)

```
앱 실행
    │
    ▼
저장된 라이선스 키 자동 로드
    │
    ▼
서버에 유효성 검증 요청 (온라인 필수)
    │
    ├─ 유효 → 메인 화면 진입 + 남은 기간 표시
    │
    ├─ 만료 임박 (30일 이내) → 경고 배너 + 메인 화면
    │
    ├─ 만료 임박 (7일 이내) → 팝업 경고 + 메인 화면
    │
    └─ 만료됨 → "기간이 만료되었습니다" + 갱신 안내
```

### 3. 라이선스 만료 알림 정책

| 남은 기간 | 동작 |
|----------|------|
| 30일 이하 | 상단 노란색 배너 "30일 후 만료됩니다" |
| 7일 이하 | 팝업 경고 "7일 후 만료! 갱신하세요" |
| 만료됨 | 사용 불가 + 갱신 화면만 표시 |

---

## 🔧 기술 스택

| 항목 | 기술 | 설명 |
|------|------|------|
| 앱 프레임워크 | **Electron** | 웹 기술로 데스크톱 앱 제작 |
| UI | 기존 HTML/CSS/JS | 현재 코드 100% 재사용 |
| 데이터 저장 | **electron-store** | 로컬 암호화 저장 |
| 서버 API | Supabase Edge Functions | 기존 그대로 유지 |
| 인증 | Supabase Auth | 기존 그대로 유지 |
| 라이선스 DB | Supabase Database | 신규 테이블 |
| 자동 업데이트 | **electron-updater** | GitHub Releases 연동 |
| 빌드/배포 | **electron-builder** | Setup.exe 생성 |

### 필요한 Node.js 패키지

```json
{
  "devDependencies": {
    "electron": "^28.0.0",
    "electron-builder": "^24.0.0"
  },
  "dependencies": {
    "electron-store": "^8.0.0",
    "electron-updater": "^6.0.0"
  }
}
```

---

## 🗄️ 데이터베이스 구조 (신규)

### licenses 테이블

```sql
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  
  -- 키 정보
  license_key VARCHAR(50) UNIQUE NOT NULL,  -- XXXX-XXXX-XXXX-XXXX
  
  -- 플랜 정보
  plan_type VARCHAR(20) NOT NULL,           -- 'beta', 'monthly', 'yearly'
  
  -- 기간 정보
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  
  -- 상태
  status VARCHAR(20) DEFAULT 'active',      -- 'active', 'expired', 'revoked'
  
  -- 기기 정보 (선택)
  device_id VARCHAR(100),                   -- 등록된 기기 ID
  last_verified_at TIMESTAMP,               -- 마지막 검증 시간
  
  -- 메타
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_licenses_user_id ON licenses(user_id);
CREATE INDEX idx_licenses_license_key ON licenses(license_key);
CREATE INDEX idx_licenses_status ON licenses(status);
```

### 플랜 타입

| plan_type | 설명 | 기간 |
|-----------|------|------|
| beta | 클로즈 베타 (무료) | 관리자 지정 |
| monthly | 월간 구독 (향후) | 30일 |
| yearly | 연간 구독 (향후) | 365일 |

### 상태 값

| status | 설명 |
|--------|------|
| active | 활성 (사용 가능) |
| expired | 만료됨 |
| revoked | 관리자가 취소함 |

---

## 🌐 API 목록

### 기존 API (유지)

| API | 용도 |
|-----|------|
| calculate-rank | 호봉 계산 (통합) |
| calculate-rank-utils | 호봉 계산 (개별 함수) |
| calculate-salary | 급여 계산 |
| calculate-overtime | 시간외수당 계산 |
| calculate-batch | 배치 호봉 계산 |
| validate-employee | 직원 데이터 검증 |

### 신규 API (추가)

| API | 용도 | 설명 |
|-----|------|------|
| validate-license | 라이선스 키 유효성 검증 | 앱 실행 시 호출 |
| generate-license | 라이선스 키 생성 | 관리자 승인 시 호출 |

### validate-license API 상세

**요청**:
```json
{
  "license_key": "XXXX-XXXX-XXXX-XXXX",
  "device_id": "기기고유ID",
  "app_version": "1.0.0"
}
```

**응답 (성공)**:
```json
{
  "success": true,
  "status": "active",
  "plan_type": "beta",
  "start_date": "2026-01-23",
  "expire_date": "2026-12-31",
  "days_remaining": 342
}
```

**응답 (만료)**:
```json
{
  "success": false,
  "status": "expired",
  "message": "라이선스가 만료되었습니다.",
  "expire_date": "2026-01-22"
}
```

---

## 📋 작업 단계 상세

### 1단계: Electron 기본 설정 (1~2시간)

**목표**: Electron 프로젝트 구조 생성

**작업 내용**:
1. package.json 생성 (Electron 의존성 추가)
2. main.js (메인 프로세스) 생성
3. preload.js (보안 브릿지) 생성
4. 기본 실행 테스트

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| package.json | C:\hr-system\ | Electron 프로젝트 설정 |
| main.js | C:\hr-system\ | Electron 메인 프로세스 |
| preload.js | C:\hr-system\ | 보안 브릿지 (IPC) |

**PowerShell 명령어**:
```powershell
# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\package.json" "C:\hr-system\package.json" -Force
Copy-Item "C:\Users\김화겸\Downloads\main.js" "C:\hr-system\main.js" -Force
Copy-Item "C:\Users\김화겸\Downloads\preload.js" "C:\hr-system\preload.js" -Force

# 의존성 설치
cd C:\hr-system
npm install

# 실행 테스트
npm start

# Git 커밋 (테스트 성공 후)
git add .
git commit -m "1단계: Electron 기본 설정"
git push
```

**완료 기준**:
- [ ] `npm start`로 Electron 앱 실행됨
- [ ] 기존 메인_인사.html이 앱에 표시됨
- [ ] 콘솔에 에러 없음

---

### 2단계: 기존 코드 통합 (1~2시간)

**목표**: 기존 웹앱 코드를 Electron에서 실행

**작업 내용**:
1. 모든 HTML/CSS/JS 파일 통합 확인
2. 경로 문제 해결 (file:// vs http://)
3. Supabase 연결 확인
4. 서버 API 호출 확인

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | 경로 설정 조정 |
| supabase_인사.js | C:\hr-system\js\auth\ | 필요시 수정 |

**완료 기준**:
- [ ] 로그인 페이지 정상 작동
- [ ] 메인 화면 정상 표시
- [ ] 서버 API 호출 정상 (호봉 계산 등)
- [ ] 데이터 저장/불러오기 정상

---

### 3단계: 로컬 데이터 저장 전환 (2~3시간)

**목표**: localStorage → electron-store로 전환

**작업 내용**:
1. electron-store 설치 및 설정
2. storage_인사.js 생성 (저장소 래퍼)
3. 데이터베이스_인사.js 수정 (저장 방식 변경)
4. 백업/복원 기능 수정

**생성/수정 파일**:
| 파일 | 경로 | 작업 |
|------|------|------|
| storage_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| 데이터베이스_인사.js | C:\hr-system\js\core\ | 수정 |
| 백업_인사.js | C:\hr-system\js\system\ | 수정 |
| 복원가져오기_인사.js | C:\hr-system\js\system\ | 수정 |
| preload.js | C:\hr-system\ | IPC 핸들러 추가 |
| main.js | C:\hr-system\ | IPC 핸들러 추가 |

**PowerShell 명령어**:
```powershell
# 새 폴더 생성
New-Item -ItemType Directory -Path "C:\hr-system\js\license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\storage_인사.js" "C:\hr-system\js\license\storage_인사.js" -Force
Copy-Item "C:\Users\김화겸\Downloads\데이터베이스_인사.js" "C:\hr-system\js\core\데이터베이스_인사.js" -Force
# ... 기타 파일

# Git 커밋
cd C:\hr-system
git add .
git commit -m "3단계: 로컬 데이터 저장 전환 (electron-store)"
git push
```

**완료 기준**:
- [x] 직원 데이터 로컬 파일 저장됨
- [x] 앱 재시작 후 데이터 유지됨
- [x] 백업/복원 정상 작동
- [x] 기존 localStorage 데이터 마이그레이션 (자동 동기화)

---

### 4단계: licenses 테이블 생성 (30분)

**목표**: Supabase에 라이선스 테이블 생성

**작업 내용**:
1. Supabase 대시보드 접속
2. SQL Editor에서 테이블 생성
3. 인덱스 생성
4. 테스트 데이터 삽입

**SQL 실행** (Supabase SQL Editor):
```sql
-- licenses 테이블 생성
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  license_key VARCHAR(50) UNIQUE NOT NULL,
  plan_type VARCHAR(20) NOT NULL,
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  device_id VARCHAR(100),
  last_verified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX idx_licenses_user_id ON licenses(user_id);
CREATE INDEX idx_licenses_license_key ON licenses(license_key);
CREATE INDEX idx_licenses_status ON licenses(status);
```

**완료 기준**:
- [x] licenses 테이블 생성됨
- [x] Supabase 대시보드에서 테이블 확인 가능
- [x] 테스트 데이터 삽입 가능

---

### 5단계: 라이선스 API 구현 (2~3시간)

**목표**: 라이선스 검증/생성 API 구현

**작업 내용**:
1. validate-license Edge Function 생성
2. generate-license Edge Function 생성
3. API 테스트
4. 에러 처리

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| index.ts | C:\hr-system-server\supabase\functions\validate-license\ | 라이선스 검증 |
| index.ts | C:\hr-system-server\supabase\functions\generate-license\ | 라이선스 생성 |

**PowerShell 명령어**:
```powershell
# 서버 폴더로 이동
cd C:\hr-system-server

# 새 함수 폴더 생성
New-Item -ItemType Directory -Path "supabase\functions\validate-license" -Force
New-Item -ItemType Directory -Path "supabase\functions\generate-license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\validate-license-index.ts" "supabase\functions\validate-license\index.ts" -Force
Copy-Item "C:\Users\김화겸\Downloads\generate-license-index.ts" "supabase\functions\generate-license\index.ts" -Force

# Supabase에 함수 배포
npx supabase functions deploy validate-license --project-ref pulanyznvpsrlkpqotat
npx supabase functions deploy generate-license --project-ref pulanyznvpsrlkpqotat
```

**완료 기준**:
- [x] validate-license API 정상 작동
- [x] generate-license API 정상 작동
- [x] 유효/만료/무효 케이스 모두 처리

---

### 6단계: 앱에 라이선스 검증 로직 추가 (2~3시간)

**목표**: 앱 실행 시 라이선스 검증

**작업 내용**:
1. license_인사.js 생성 (라이선스 관리 모듈)
2. 앱 시작 시 라이선스 검증 로직
3. 라이선스 키 입력 UI
4. 만료 알림 UI
5. 로컬 암호화 저장

**생성/수정 파일**:
| 파일 | 경로 | 작업 |
|------|------|------|
| license_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| login.html | C:\hr-system\ | 수정 (라이선스 UI 추가) |
| main.js | C:\hr-system\ | 수정 (라이선스 검증 추가) |
| 메인_인사.html | C:\hr-system\ | 수정 (남은 기간 표시) |

**완료 기준**:
- [x] 라이선스 키 입력 화면 표시
- [x] 키 검증 후 메인 화면 진입
- [x] 키 로컬 저장 및 자동 로드
- [x] 만료 시 경고/차단
- [x] 남은 기간 표시

---

### 7단계: 자동 업데이트 설정 (1~2시간)

**목표**: electron-updater로 자동 업데이트 구현

**작업 내용**:
1. electron-updater 설정
2. GitHub Releases 연동 설정
3. 업데이트 확인 로직
4. 업데이트 알림 UI

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | 업데이트 로직 추가 |
| package.json | C:\hr-system\ | 빌드 설정 추가 |

**완료 기준**:
- [x] 앱 시작 시 업데이트 확인
- [x] 새 버전 알림 표시
- [x] 업데이트 다운로드 및 설치

---

### 8단계: 빌드 및 테스트 (2~3시간)

**목표**: Setup.exe 생성 및 전체 테스트

**작업 내용**:
1. electron-builder 설정
2. 앱 아이콘 설정
3. 빌드 테스트
4. 설치 테스트
5. 전체 기능 테스트

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| electron-builder.yml | C:\hr-system\build\ | 빌드 설정 |
| icon.ico | C:\hr-system\assets\ | 앱 아이콘 |

**PowerShell 명령어**:
```powershell
# 폴더 생성
New-Item -ItemType Directory -Path "C:\hr-system\build" -Force
New-Item -ItemType Directory -Path "C:\hr-system\assets" -Force

# 빌드 실행
cd C:\hr-system
npm run build

# 결과물 확인
Get-ChildItem C:\hr-system\dist
```

**완료 기준**:
- [x] Setup.exe 빌드 성공
- [x] 설치 및 실행 정상
- [x] 모든 기능 정상 작동
- [ ] 자동 업데이트 테스트 (실제 릴리즈 배포 시 테스트)

---

### 9단계: 소개 페이지 + 다운로드 링크 (1~2시간)

**목표**: Vercel에 소개 페이지 배포

**작업 내용**:
1. 소개 페이지 HTML 작성
2. 다운로드 버튼 (GitHub Releases 연결)
3. 기능 소개 / 스크린샷
4. Vercel 배포

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| index.html | C:\hr-system\ | 소개 페이지로 변경 |

**완료 기준**:
- [x] sw-hrm-landing-ju27.vercel.app 접속 시 소개 페이지 표시
- [x] 다운로드 버튼 클릭 시 exe 다운로드
- [x] 기능 소개 표시

---

## ✅ 전체 완료 기준

- [x] F12로 소스 코드 보이지 않음 (Electron 빌드)
- [x] 라이선스 키 없이 사용 불가
- [x] 라이선스 만료 시 사용 차단
- [x] 데이터 로컬 저장 (암호화)
- [x] 서버 API 정상 호출
- [x] 자동 업데이트 작동
- [x] 백업/복원 정상 작동
- [x] 소개 페이지에서 다운로드 가능
- [x] 관리자 페이지에서 라이선스 발급/관리 가능

---

## 📝 참고 문서

| 문서 | 설명 |
|------|------|
| 완전서버이동_로드맵_v5.md | 서버화 작업 완료 기록 |
| 인사관리시스템_서버화_작업가이드.md | 서버화 상세 과정 |
| 개발_핵심가이드_v1_5.md | 시스템 개발 가이드 |
| 시스템_레퍼런스_v1_3.md | 시스템 API 레퍼런스 |

---

## 🌐 배포된 URL 정리

| 용도 | URL |
|------|-----|
| 소개 페이지 | https://sw-hrm-landing-ju27.vercel.app/ |
| 관리자 페이지 | https://sw-hrm-admin.vercel.app/ |
| GitHub Release | https://github.com/mangfeel/hr-system/releases |
| 다운로드 파일 | HRM-System Setup 1.0.0.exe |

---

## 📁 저장소 정리

| 저장소 | 용도 | 공개 여부 |
|--------|------|----------|
| hr-system | 앱 소스 코드 (Electron) | Public |
| sw-hrm-landing | 소개 페이지 (Vercel) | Public |
| sw-hrm-admin | 관리자 페이지 (Vercel) | Private |

---

## 🔐 계정 정보 정리

| 서비스 | 용도 |
|--------|------|
| Supabase | 인증, DB, Edge Functions |
| Vercel | 소개/관리자 페이지 배포 |
| GitHub | 소스 코드, Release 배포 |
| Resend | 이메일 전송 (월 3,000통 무료) |

---

## 🔄 작업 진행 기록

| 날짜 | 단계 | 작업 내용 | 상태 |
|------|------|----------|------|
| 2026-01-23 | 준비 | 로드맵 문서 작성 (v1) | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v2) - 폴더 구조/작업 방식 추가 | ✅ 완료 |
| 2026-01-23 | 1단계 | Electron 기본 설정 (package.json, main.js, preload.js) | ✅ 완료 |
| 2026-01-23 | 2단계 | 기존 코드 통합 - 로그인/메인화면 정상 작동 확인 | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v3) - 진행 상태 반영 | ✅ 완료 |
| 2026-01-23 | 3단계 | electron-store 연동 + 버그 수정 | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v4) - 3단계 완료 및 발견 이슈 기록 | ✅ 완료 |
| 2026-01-23 | 4단계 | licenses 테이블 생성 (Supabase SQL Editor) | ✅ 완료 |
| 2026-01-23 | 5단계 | 라이선스 API 구현 (validate-license, generate-license) | ✅ 완료 |
| 2026-01-23 | 6단계 | 앱에 라이선스 검증 로직 추가 | ✅ 완료 |
| 2026-01-23 | 7단계 | 자동 업데이트 기능 추가 | ✅ 완료 |
| 2026-01-23 | 8단계 | 빌드 완료 - 원클릭 설치 | ✅ 완료 |
| 2026-01-23 | 9단계 | 소개 페이지 배포 | ✅ 완료 |
| 2026-01-23 | 10단계 | 관리자 페이지 구현 | ✅ 완료 |
| | 6단계 | 앱에 라이선스 검증 추가 | ⏳ 대기 |
| | 7단계 | 자동 업데이트 설정 | ⏳ 대기 |
| | 8단계 | 빌드 및 테스트 | ⏳ 대기 |
| | 9단계 | 소개 페이지 배포 | ⏳ 대기 |
| | 10단계 | 관리자 페이지 구현 | ⏳ 대기 |

---

## 📌 1단계 완료 내용

### 생성된 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| package.json | C:\hr-system\ | Electron 프로젝트 설정, 빌드 설정 포함 |
| main.js | C:\hr-system\ | Electron 메인 프로세스 (윈도우 생성, IPC 핸들러) |
| preload.js | C:\hr-system\ | 보안 브릿지 (contextBridge로 안전한 API 노출) |

### 실행 명령어

```powershell
cd C:\hr-system
npm install    # 의존성 설치 (최초 1회)
npm start      # 앱 실행
```

### Git 커밋

```powershell
git add .
git commit -m "1단계: Electron 기본 설정 (package.json, main.js, preload.js)"
git push
```

---

## 📌 2단계 완료 내용

### 테스트 결과

| 항목 | 결과 |
|------|------|
| Electron 앱 실행 | ✅ 정상 |
| 로그인 페이지 표시 | ✅ 정상 |
| Supabase 로그인 | ✅ 정상 |
| 메인 화면 진입 | ✅ 정상 |
| 서버 API 호출 | ✅ 정상 (기존 코드 그대로 동작) |

### 확인 사항

- 기존 HTML/CSS/JS 코드 수정 없이 Electron에서 정상 동작
- Supabase 인증 및 서버 API 연동 정상
- localStorage 데이터 저장/불러오기 정상 (3단계에서 electron-store로 전환 예정)

---

**문서 끝**

---

## 📌 3단계 완료 내용

### 수정/생성된 파일

| 파일 | 경로 | 버전 | 작업 내용 |
|------|------|------|----------|
| main.js | C:\hr-system\ | v3단계 | electron-store IPC 핸들러 추가 |
| preload.js | C:\hr-system\ | v3단계 | electronStore API 노출 |
| 데이터베이스_인사.js | C:\hr-system\js\core\ | v4.0.0 | electron-store 연동, 하이브리드 저장 |
| 직원등록_인사.js | C:\hr-system\js\employee\ | v4.1.1 | 호봉 계산 undefined 버그 수정 |
| 호봉계산기_인사.js | C:\hr-system\js\core\ | v4.0.1 | calculateTotalCareer() 반환값 보강 |
| 직원목록_인사.js | C:\hr-system\js\employee\ | v6.0.1 | Electron prompt() 호환성 수정 |
| .gitignore | C:\hr-system\ | - | node_modules/ 제외 추가 |

### 테스트 결과

| 항목 | 결과 |
|------|------|
| electron-store 저장 | ✅ 정상 |
| 앱 재시작 후 데이터 유지 | ✅ 정상 |
| 고유번호 생성 | ✅ 정상 |
| 신규 직원 등록 | ✅ 정상 |
| 직원 삭제 | ✅ 정상 |
| 호봉 계산 결과 표시 | ✅ 정상 |

### 수정된 버그

| 버그 | 원인 | 해결 |
|------|------|------|
| 고유번호 undefined | CONFIG.UNIQUE_CODE_PREFIX 미정의 | fallback 값 'H' 추가 |
| 호봉 계산 undefined | careerResult.years → careerResult.totalYears | 필드명 수정 |
| 직원 삭제 오류 | Electron에서 prompt() 미지원 | confirm()으로 대체 |

### Git 커밋

```powershell
git add .
git commit -m "3단계: electron-store 연동 + 버그 수정"
git push
```

**주의**: `node_modules/` 폴더가 GitHub에 push되어 오류 발생 → `.gitignore` 추가 및 `git filter-branch`로 히스토리에서 제거 완료

---

## ⚠️ 발견된 이슈: Electron에서 prompt() 미지원

### 문제

Electron 환경에서 JavaScript의 `prompt()` 함수가 지원되지 않습니다.
웹앱에서는 정상 작동하지만, Electron 앱에서 실행 시 에러 발생:

```
Uncaught Error: prompt() is and will not be supported.
```

### 영향 받는 파일 목록

| 파일 | 경로 | 사용 횟수 | 상태 |
|------|------|----------|------|
| 직원목록_인사.js | js/employee/ | 1곳 (삭제 확인) | ✅ 수정 완료 |
| 급여설정_인사.js | js/labor/ | 11곳 | ⏳ 수정 필요 |
| 백업_인사.js | js/system/ | 1곳 | ⏳ 수정 필요 |
| 육아휴직_인사.js | js/hr/ | 1곳 | ⏳ 수정 필요 |

### 해결 방법

```javascript
// 환경 감지
const isElectron = typeof window !== 'undefined' && window.isElectron === true;

if (isElectron) {
    // Electron: confirm()으로 대체
    const confirmed = confirm('정말 삭제하시겠습니까?');
    if (!confirmed) return;
} else {
    // 웹: prompt() 사용 가능
    const inputName = prompt('이름을 입력하세요:');
    if (inputName !== expectedName) return;
}
```

### 향후 작업

- 각 기능 테스트 시 해당 파일의 prompt() 사용 부분 발견되면 수정
- 또는 모든 파일 일괄 수정 (별도 작업으로 진행)

---

**문서 끝 (v4)**

---

## 📌 4단계 완료 내용

### 작업 내용

| 항목 | 결과 |
|------|------|
| Supabase SQL Editor 접속 | ✅ 완료 |
| licenses 테이블 생성 | ✅ 완료 |
| 인덱스 3개 생성 | ✅ 완료 |

### 생성된 테이블 구조

```sql
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  license_key VARCHAR(50) UNIQUE NOT NULL,
  plan_type VARCHAR(20) NOT NULL,
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  device_id VARCHAR(100),
  last_verified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 생성된 인덱스

| 인덱스명 | 대상 컬럼 |
|----------|----------|
| idx_licenses_user_id | user_id |
| idx_licenses_license_key | license_key |
| idx_licenses_status | status |

---

**문서 끝 (v4 업데이트)**

---

## 📌 5단계 완료 내용

### 생성된 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| index.ts | supabase/functions/validate-license/ | 라이선스 검증 API |
| deno.json | supabase/functions/validate-license/ | 설정 파일 |
| index.ts | supabase/functions/generate-license/ | 라이선스 생성 API |
| deno.json | supabase/functions/generate-license/ | 설정 파일 |

### API 테스트 결과

| API | 테스트 결과 |
|-----|------------|
| generate-license | ✅ 라이선스 생성 성공 (GHF4-NFWG-3ZMR-JY4M) |
| validate-license | ✅ 라이선스 검증 성공 (valid: true) |

### 설정 변경

| 항목 | 변경 내용 |
|------|----------|
| validate-license | Verify JWT → OFF |
| generate-license | Verify JWT → OFF |

### API 사용법

**라이선스 생성**:
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "apikey" = "[SUPABASE_ANON_KEY]"
}

# 30일짜리 trial 라이선스
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/generate-license" -Method POST -Headers $headers -Body '{"plan_type":"trial","duration_days":30}'

# 1년짜리 premium 라이선스
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/generate-license" -Method POST -Headers $headers -Body '{"plan_type":"premium","duration_days":365}'
```

**라이선스 검증**:
```powershell
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/validate-license" -Method POST -Headers $headers -Body '{"license_key":"XXXX-XXXX-XXXX-XXXX"}'
```

---

## 📌 6단계 완료 내용

### 생성/수정된 파일

| 파일 | 경로 | 작업 |
|------|------|------|
| license_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| login.html | C:\hr-system\ | 수정 (라이선스 입력 UI 추가) |
| 메인_인사.html | C:\hr-system\ | 수정 (상단 라이선스 정보 표시) |

### 테스트 결과

| 항목 | 결과 |
|------|------|
| 로그인 | ✅ 성공 |
| 라이선스 키 입력 화면 | ✅ 표시됨 |
| 라이선스 검증 | ✅ 성공 |
| 메인 화면 진입 | ✅ 성공 |
| 상단 라이선스 정보 | ✅ "체험판 30일 남음" 표시 |

### 라이선스 흐름

```
[로그인 화면]
    │
    ▼ (이메일/비밀번호)
[계정 인증]
    │
    ▼ (승인된 사용자인지 확인)
[라이선스 확인]
    │
    ├── 유효함 → [메인 화면] (상단에 남은 기간 표시)
    │
    └── 없음/만료 → [라이선스 키 입력 화면]
                         │
                         ▼ (키 입력)
                    [서버에서 검증]
                         │
                         ├── 유효 → [메인 화면]
                         └── 무효 → 에러 메시지
```

### Git 커밋

```powershell
git add .
git commit -m "6단계: 라이선스 검증 로직 추가"
git push
```

---

## 📌 7단계 완료 내용

### 수정된 파일

| 파일 | 버전 | 작업 내용 |
|------|------|----------|
| main.js | v3.0.0 | 자동 업데이트 기능 추가 (electron-updater) |
| preload.js | v2.0.0 | 업데이트 API 추가 |
| package.json | - | electron-log 패키지 추가 |

### 자동 업데이트 기능

| 기능 | 설명 |
|------|------|
| 업데이트 확인 | 앱 시작 3초 후 자동 확인 |
| 새 버전 알림 | 다이얼로그로 다운로드 여부 확인 |
| 다운로드 진행률 | 타이틀바에 % 표시 |
| 설치 | 다운로드 완료 후 재시작 여부 확인 |

### 업데이트 흐름

```
[앱 실행] → (3초 후) → [업데이트 확인]
                            │
    ┌───────────────────────┴───────────────────────┐
    │                                               │
[새 버전 있음]                              [최신 버전]
    │                                               │
[다운로드 여부 묻기]                          [정상 사용]
    │
    ├── "다운로드" → [다운로드 중 (진행률 표시)]
    │                       │
    │               [다운로드 완료]
    │                       │
    │               [재시작 여부 묻기]
    │                       │
    │       ┌───────────────┴───────────────┐
    │       │                               │
    │   [지금 재시작]                   [나중에]
    │       │                               │
    │   [업데이트 적용]              [다음 실행 시 적용]
    │
    └── "나중에" → [다음 실행 시 다시 확인]
```

### Git 커밋

```powershell
git add .
git commit -m "7단계: 자동 업데이트 기능 추가"
git push
```

---

## 📌 8단계 완료 내용

### 빌드 결과

| 항목 | 결과 |
|------|------|
| 빌드 명령어 | `npm run build:win` |
| 생성된 파일 | 인사관리시스템 Setup 1.0.0.exe |
| 설치 방식 | 원클릭 설치 (옵션 없음) |
| 아이콘 | SW HRM 로고 적용 |

### 테스트 결과

| 항목 | 결과 |
|------|------|
| 설치 | ✅ 성공 |
| 프로그램 실행 | ✅ 정상 |
| 콘솔 숨김 | ✅ 깔끔하게 실행 |
| 로그인/메인화면 | ✅ 정상 |

### package.json 변경 사항

| 항목 | 이전 | 변경 후 |
|------|------|--------|
| oneClick | false | true |
| author | 김화겸 | SW HRM |

### .gitignore 추가

```
node_modules/
dist/
```

### Git 커밋

```powershell
git add .
git commit -m "8단계: 빌드 완료 - 원클릭 설치"
git push
```

---

## 📌 9단계 완료 내용

### 배포 결과

| 항목 | 결과 |
|------|------|
| 소개 페이지 URL | https://sw-hrm-landing-ju27.vercel.app/ |
| GitHub Release | https://github.com/mangfeel/hr-system/releases/tag/v1.0.0 |
| Setup.exe | 인사관리시스템 Setup 1.0.0.exe (74.5MB) |

### 소개 페이지 구성

| 섹션 | 내용 |
|------|------|
| 헤더 | SW HRM 로고, 다운로드 버튼 |
| 주요 기능 | 직원관리, 급여관리, 통계분석, 근로계약서, 포상관리, 데이터보안 |
| 데이터 저장 안내 | 서버 미저장, PC 로컬 저장, 백업/복원 안내 |
| 테스트 참여 안내 | 베타 테스트 단계, 참여 절차 안내 |
| 개발자 메시지 | 솔직한 안내, 의견 환영, 추가 기능 계획 없음 |
| 문의 및 의견 | 카카오톡 오픈채팅 연결 |

### 별도 저장소 생성

| 저장소 | 용도 |
|--------|------|
| hr-system | 앱 소스 코드 |
| sw-hrm-landing | 소개 페이지 (Vercel 배포용) |

### Git 커밋

```powershell
# hr-system
git add .
git commit -m "9단계: 소개 페이지 추가"
git push

# sw-hrm-landing (별도 저장소)
git init
git add .
git commit -m "소개 페이지"
git remote add origin https://github.com/mangfeel/sw-hrm-landing.git
git push -u origin main
```

---

## 🆕 10단계: 관리자 페이지 구현 (2~3시간)

**목표**: 라이선스 발급/관리를 위한 웹 기반 관리자 페이지

**작업 내용**:
1. 관리자 페이지 HTML/JS 작성
2. 라이선스 발급 UI (달력으로 만료일 선택)
3. 라이선스 목록 조회
4. 라이선스 관리 (연장/취소/재발급)
5. 사용자 관리 (승인/거절)

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| admin.html | C:\hr-system\ | 관리자 페이지 |
| admin_인사.js | C:\hr-system\js\admin\ | 관리자 기능 모듈 |

**관리자 페이지 기능**:

```
┌─────────────────────────────────────────────────────────┐
│  🔐 인사관리시스템 - 관리자 페이지                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📋 라이선스 발급                                        │
│  ┌─────────────────────────────────────────────────┐   │
│  │  플랜 유형:  [trial ▼] [basic ▼] [premium ▼]    │   │
│  │  만료일:     [2026-12-31] 📅                    │   │
│  │  사용자:     [선택안함 ▼] (선택사항)             │   │
│  │                                                 │   │
│  │  [🔑 라이선스 발급하기]                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  📊 발급된 라이선스 목록                                 │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 라이선스 키      │ 플랜   │ 만료일     │ 상태   │   │
│  │ GHF4-NFWG-...  │ trial  │ 2026-02-22│ 활성   │   │
│  │ ABCD-EFGH-...  │ premium│ 2027-01-23│ 활성   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  👥 사용자 승인 대기                                     │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 이메일              │ 가입일     │ 액션        │   │
│  │ user@example.com   │ 2026-01-20│ [승인][거절] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**완료 기준**:
- [x] 관리자 페이지 접속 가능
- [x] 기간 선택하여 라이선스 발급
- [x] 발급된 라이선스 목록 조회
- [x] 라이선스 상태 표시 (활성/만료/비활성)
- [x] 사용자 승인/거절 기능
- [x] 이메일 전송 기능

---

## 📌 10단계 완료 내용

### 배포 결과

| 항목 | 결과 |
|------|------|
| 관리자 페이지 URL | https://sw-hrm-admin.vercel.app/ |
| GitHub 저장소 | https://github.com/mangfeel/sw-hrm-admin |
| 관리자 이메일 | xrades4532@gmail.com |

### 관리자 페이지 기능

| 기능 | 설명 |
|------|------|
| 로그인 | Supabase Auth 연동 |
| 통계 | 승인 대기/완료, 라이선스 수 표시 |
| 승인 대기 사용자 | 기관명, 이름, 이메일, 연락처, 가입일 표시 |
| 라이선스 발급 | 플랜, 기간, 사용자 선택 후 발급 |
| 발급된 라이선스 | 키, 기관명, 이메일, 플랜, 만료일, 상태 표시 |
| 이메일 전송 | Resend API 연동, 라이선스 키 이메일 전송 |

### 생성된 파일

| 파일 | 위치 | 설명 |
|------|------|------|
| index.html | C:\sw-hrm-admin\ | 관리자 페이지 |
| send-license-email/index.ts | Supabase Edge Function | 이메일 전송 |

### Git 커밋

```powershell
cd C:\sw-hrm-admin
git add .
git commit -m "관리자 페이지"
git push
```

### Supabase 설정

| 항목 | 내용 |
|------|------|
| Foreign Key | licenses.user_id → profiles.id |
| 관리자 계정 | xrades4532@gmail.com (Auto Confirm) |
| Edge Function | send-license-email (Resend API) |

---

## 📌 추가 작업: 배포 및 설치 문제 해결

### GitHub 저장소 Public 전환

| 항목 | 변경 |
|------|------|
| hr-system 저장소 | Private → **Public** |
| 이유 | 로그인 없이 다운로드 가능하도록 |

### 빌드 파일명 영어로 변경

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| productName | 인사관리시스템 | HRM-System |
| shortcutName | 인사관리시스템 | HRM System |
| 설치 파일 | 인사관리시스템 Setup 1.0.0.exe | HRM-System Setup 1.0.0.exe |

### 소개 페이지 안내 추가

| 안내 항목 | 내용 |
|----------|------|
| 브라우저 안내 | Chrome 권장, Edge 다운로드 안될 수 있음 |
| 차단 해제 안내 | 우클릭 → 속성 → 차단 해제 체크 |

### 코드 서명 (미적용)

| 항목 | 내용 |
|------|------|
| 현재 상태 | 서명 없음 (알 수 없는 게시자) |
| 해결 방법 | 코드 서명 인증서 구매 (연 $200~400) |
| 권장 시점 | 정식 출시/유료 전환 시 검토 |

---

## 🔧 선택사항: 관리자 디버그 모드

**목적**: 빌드된 앱에서 원호성님만 콘솔(DevTools) 열 수 있도록 함

**작동 방식**:
```
1. 비밀 단축키 입력 (예: Ctrl + Shift + Alt + D)
2. 비밀번호 입력창 표시
3. 비밀번호 일치 → 콘솔 열림
   비밀번호 불일치 → 아무 일도 안 일어남
```

**장점**:
- 일반 사용자: 코드 접근 불가
- 관리자(원호성님): 다른 PC에서도 디버깅 가능

**우선순위**: 낮음 (필요할 때 추가)

---

## 📌 v5.2 추가 작업 (2026-01-27)

### Electron 환경 버그 수정

| 파일 | 문제 | 해결 |
|------|------|------|
| 백업_인사.js | `prompt()` 미지원으로 전체 삭제 오류 | `confirm()`으로 변경 |
| 데이터베이스_인사.js | `window.electronAPI.store` undefined 오류 | `window.electronStore` 사용, 안전 처리 |

### 수정된 함수

**백업_인사.js (v3.6)**
- `resetAllData()`: prompt → confirm 변경

**데이터베이스_인사.js**
- `reset()`: electron-store 오류 무시, 항상 새로고침
- `_initElectronStore()`: electronStore 없으면 스킵
- `_saveToElectronStore()`: 안전한 오류 처리
- `syncFromElectronStore()`: 안전한 오류 처리

### 관리자 페이지 기능 추가

| 기능 | 내용 |
|------|------|
| 라이선스 만료일 직접 지정 | 기간 선택에 "직접 지정" 옵션 추가 |
| 날짜 선택 | 달력에서 원하는 만료일 직접 선택 가능 |

---

## 🔮 향후 작업 (미완료)

### 1. 이메일 자동 발송 - 도메인 구매 필요

**현재 상황**:
| 항목 | 상태 |
|------|------|
| Resend 서비스 | 연동 완료 |
| 발송 가능 대상 | 본인 이메일만 (테스트 모드) |
| 원인 | 도메인 미인증 |

**해결 방법**:
| 단계 | 내용 | 비용 |
|------|------|------|
| 1. 도메인 구매 | 가비아, 카페24 등에서 .com 구매 | 연 13,000~15,000원 |
| 2. Resend 도메인 등록 | DNS 레코드 설정 (DKIM, SPF) | 무료 |
| 3. 발신 주소 변경 | `noreply@yourdomain.com` 형식으로 변경 | - |

**권장 시점**: 정식 출시 시 또는 테스트 참여자 증가 시

---

### 2. 자동 업데이트 활성화

**현재 상황**:
- 자동 업데이트 기능 구현됨
- 버전 번호가 같으면 (v1.0.0 → v1.0.0) 업데이트 안 됨

**버전 업데이트 방법**:
```powershell
# 1. package.json 버전 수정
# "version": "1.0.0" → "version": "1.0.1"

# 2. 빌드
cd C:\hr-system
npm run build

# 3. GitHub에 새 Release 생성
# - 태그: v1.0.1
# - 파일: HRM-System Setup 1.0.1.exe 업로드
```

**버전 규칙**:
| 변경 유형 | 버전 예시 |
|----------|----------|
| 버그 수정 | 1.0.0 → 1.0.1 |
| 기능 추가 | 1.0.0 → 1.1.0 |
| 대규모 변경 | 1.0.0 → 2.0.0 |

---

### 3. 코드 서명 인증서

**현재 상황**:
- 서명 없음 → "알 수 없는 게시자" 경고
- 다운로드 시 Windows 차단 → 사용자가 "차단 해제" 필요

**해결 방법**:
| 인증서 | 비용 (연간) |
|--------|------------|
| Sectigo | $200~300 |
| DigiCert | $400~500 |
| GlobalSign | $300~400 |

**권장 시점**: 정식 출시/유료 전환 시

---

## 📋 향후 작업 우선순위

| 순위 | 작업 | 비용 | 시점 |
|------|------|------|------|
| 1 | 자동 업데이트 (버전 올리기) | 무료 | 다음 버그 수정/기능 추가 시 |
| 2 | 도메인 구매 + 이메일 발송 | 연 ~15,000원 | 정식 출시 시 |
| 3 | 코드 서명 인증서 | 연 ~$300 | 정식 출시/유료 전환 시 |

---

## 📌 v5.3 추가 작업 (2026-01-27)

### 1. 라이선스 보안 강화 - 사용자별 라이선스 구분

**문제점**: 동일 PC에서 다른 사용자가 로그인해도 이전 사용자의 라이선스로 접속 가능

**해결 방법**:

```
[기존]
라이선스 키만 검증 → 유효하면 통과

[개선]
라이선스 키 + user_id 검증 → 본인 라이선스만 통과
```

**수정 파일**:

| 파일 | 버전 | 변경 내용 |
|------|------|----------|
| license_인사.js | v1.3.0 | user_id 저장, 소유자 검증, 다른 기관 라이선스 차단, API 키/헤더 수정 |
| login.html | - | 로그인 성공 시 `License.setCurrentUser()` 호출 추가 |
| auth_인사.js | v1.1.0 | `signIn`에서 `License.setCurrentUser()`, `signOut`에서 `License.clearAll()` |
| validate-license (Edge Function) | v1.1.0 | 응답에 user_id 반환 추가 |

**작동 흐름**:
```
1. 로그인 성공 → License.setCurrentUser(userId, email) 호출
2. 저장된 라이선스 확인 → user_id 불일치 시 삭제
3. 라이선스 활성화 시 → 서버 반환 user_id와 현재 사용자 비교
4. 불일치 시 → "이 라이선스는 다른 기관에 할당되어 있습니다" 메시지
```

### 2. delete-user Edge Function 개선

**문제점**: 
- 사용자 삭제 시 profiles만 삭제 → auth.users 남아있음 → 재가입 불가
- auth.users가 이미 삭제된 경우 "User not found" 오류 발생

**해결**:
- 삭제 순서: licenses → profiles → auth.users
- auth.users 삭제 실패해도 정상 완료 처리

**배포 위치**: C:\hr-system\supabase\functions\delete-user\index.ts

### 3. 관리자 페이지 기능 추가

| 기능 | 설명 |
|------|------|
| 라이선스 만료일 직접 지정 | "직접 지정" 옵션 → 달력에서 날짜 선택 |
| 사용자 완전 삭제 | profiles + licenses + auth.users 삭제 (재가입 가능) |
| 승인 취소 | status를 'pending'으로 변경 |
| 라이선스 삭제 | 발급된 라이선스 직접 삭제 |
| **기기 초기화** | device_id를 null로 초기화 → 다른 기기에서 재등록 가능 |

### 4. 관리자 페이지 UI 개선

| 항목 | 변경 |
|------|------|
| 컨테이너 너비 | 1200px → 1400px |
| 테이블 레이아웃 | 고정 너비 설정, 줄바꿈 방지, 말줄임표 처리 |
| 기기 컬럼 | "등록/미등록" 상태 + "초기화" 버튼 |
| 버튼 툴팁 | 모든 버튼에 title 속성 추가 (마우스 오버 시 설명 표시) |

**툴팁 예시**:
- 복사: "라이선스 키 클립보드에 복사"
- 📧: "라이선스 키를 이메일로 전송"
- 삭제: "라이선스 삭제 (복구 불가)"
- 초기화: "기기 등록 초기화 - 다른 기기에서 재등록 가능"
- 승인: "사용자 승인 - 로그인 가능"
- 승인취소: "승인 취소 - 대기 상태로 변경"

### 5. 수정된 파일 경로 정리

| 파일 | 경로 |
|------|------|
| license_인사.js | C:\hr-system\js\license\license_인사.js |
| auth_인사.js | C:\hr-system\js\auth\auth_인사.js |
| login.html | C:\hr-system\login.html |
| validate-license | C:\hr-system-server\supabase\functions\validate-license\index.ts |
| delete-user | C:\hr-system\supabase\functions\delete-user\index.ts |
| 관리자 페이지 | C:\sw-hrm-admin\index.html |

### 6. Edge Function 배포 명령어

```powershell
# validate-license 배포
cd C:\hr-system-server
npx supabase functions deploy validate-license --project-ref pulanyznvpsrlkpqotat

# delete-user 배포
cd C:\hr-system
npx supabase functions deploy delete-user --project-ref pulanyznvpsrlkpqotat
```

---

## 📌 v5.3.1 추가 작업 (2026-01-27)

### 1. Electron 호환성 - prompt() → 모달 변환

**문제점**: Electron 환경에서 `prompt()` 함수가 지원되지 않아 기능 오류 발생

**해결**: 사용자 친화적인 커스텀 모달로 전환

| 파일 | 버전 | prompt() 개수 | 변경 내용 |
|------|------|---------------|----------|
| 급여설정_인사.js | v3.3.0 → v3.3.1 | 11개 → 0개 | 연도 선택 드롭다운, 직급명 수정, 삭제 확인 |
| 육아휴직_인사.js | v3.1.0 | 1개 → 0개 | 복직일 날짜 선택 (date picker) |
| 직원목록_인사.js | v6.1.0 | 1개 → 0개 | 삭제 확인 체크박스 모달 |

**모달 유형**:
- `showYearSelectModal()`: 연도 선택 드롭다운
- `showTextInputModal()`: 텍스트 입력 + Enter/ESC 지원
- `showDeleteConfirmModal()`: 체크박스 확인 방식 (실수 방지)
- `showDateInputModal()`: 날짜 선택 (date picker)
- `showSelectModal()`: 버튼식 선택 UI

### 2. 성능 최적화 - API 과부하 해결

**문제점**: 
- 경력관리/직원목록 진입 시 개별 API 호출 80회+ 발생
- HTTP 503 Service Unavailable 오류
- UI 응답 없음 (입력란 클릭 안됨)

**해결**: 개별 API 호출 → 로컬 계산으로 변경

| 파일 | 버전 | 변경 내용 |
|------|------|----------|
| 직원유틸_인사.js | v5.1.0 | `getCurrentRankAsync`, `getNextUpgradeDateAsync`, `getDynamicRankInfo`, `getTenureAsync` → 로컬 계산 |
| 연명부_인사.js | v6.1.0 | 과거경력 직원 개별 API → 로컬 계산 |

**결과**:
| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 직원목록 진입 | 배치 1회 + 개별 80회+ | 배치 1회만 |
| 503 오류 | 발생 | **해결** |
| UI 응답 | 멈춤 | **정상** |

### 3. 급여설정 연도 선택 범위 확대

**문제점**: 연도 선택이 2029년까지만 가능

**해결**: 
| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 연도 범위 | 2024 ~ 2029 (6년) | 2021 ~ 2056 (35년) |
| 파일 | 급여설정_인사.js | v3.3.1 |

### 4. GitHub Release 배포

| 항목 | 내용 |
|------|------|
| 릴리즈 태그 | v5.3.1 |
| 릴리즈 제목 | v5.3.1 - Electron 호환성 및 성능 최적화 |
| 설치 파일 | HRM-System Setup 1.0.0.exe |
| 상태 | ✅ Latest |

### 5. 수정된 파일 요약

| 파일 | 버전 | 경로 |
|------|------|------|
| 급여설정_인사.js | v3.3.1 | C:\hr-system\js\labor\ |
| 육아휴직_인사.js | v3.1.0 | C:\hr-system\js\hr\ |
| 직원목록_인사.js | v6.1.0 | C:\hr-system\js\employee\ |
| 직원유틸_인사.js | v5.1.0 | C:\hr-system\js\utils\ |
| 연명부_인사.js | v6.1.0 | C:\hr-system\js\reports\ |

### 6. Git 커밋 내역

```
v5.3.1: prompt() 모달 변환 및 API 과부하 해결

[Electron 호환성]
- 급여설정_인사.js v3.3.0: prompt() → 모달 (11개)
- 육아휴직_인사.js v3.1.0: 복직일 날짜 선택 모달
- 직원목록_인사.js v6.1.0: 삭제 확인 체크박스 모달

[성능 최적화]
- 직원유틸_인사.js v5.1.0: API 호출 → 로컬 계산
- 503 Service Unavailable 오류 해결
- UI 응답 지연 문제 해결

[라이선스 보안]
- license_인사.js v1.3.0: 사용자별 라이선스 구분
```

---

**문서 끝 (v5.3.1 최종 - 전체 완료! 🎉)**

---

## 📌 v6.0 추가 작업 (2026-01-28)

### 1. 랜딩 페이지 업데이트

**파일**: `C:\sw-hrm-landing\index.html`
**URL**: https://sw-hrm-landing-ju27.vercel.app

#### 1-1. 데이터 저장 경로 안내 수정

**변경 전**:
```
💾 내 PC에만 저장됩니다
모든 데이터는 사용자 PC의 아래 경로에 저장됩니다.
C:\Users\[사용자이름]\AppData\Roaming\hr-system\
```

**변경 후**:
```
💾 내 PC에만 저장됩니다
백업 파일은 다운로드 폴더에 저장됩니다.
C:\Users\[사용자이름]\Downloads\

📁 별도 폴더 관리를 권장합니다
다운로드 폴더에 "인사관리_백업" 같은 별도 폴더를 만들어
백업 파일을 정리해두시면 관리가 편리합니다.
```

#### 1-2. 오픈채팅 입장 안내 추가

```
💡 입장 시 기관명으로 닉네임을 설정해 주세요.
```

#### 1-3. 버전 자동 표시 기능 추가

GitHub Release에서 최신 버전을 자동으로 가져와 표시

---

### 2. 저작권 등록

**등록 기관**: 한국저작권위원회
**프로그램 명칭**: SW HRM (Social Welfare Human Resource Management)

| 항목 | 값 |
|------|-----|
| 창작연월일 | 2025-11-01 |
| 공표여부 | 예 |
| 공표일 | 2026-01-27 |
| 프로그램 종류 | 응용프로그램 > 사무/업무용 |
| 4차산업 | 클라우드(Cloud) |
| 적용분야 | 사회복지시설 인사관리 |
| 판매구분 | 상업용 |
| 사용기종 | IBM-PC 호환기종 |
| 사용OS | Windows 10 |
| 사용언어 | javascript(Node.js) |

**등록 비용**: 23,600원
**예상 기간**: 2~3주

---

### 3. Supabase 설정 수정

#### 3-1. 회원가입 → profiles 자동 추가 (Trigger)

**시도**: auth.users INSERT 시 profiles 자동 생성 Trigger 추가
**결과**: ❌ 삭제

**이유**: login.html에서 회원가입 시 직접 profiles INSERT 수행
```javascript
// login.html 회원가입 로직
const { data, error } = await supabaseAuth.auth.signUp({...});
await supabaseAuth.from('profiles').insert({...});  // 직접 insert
```

Trigger가 먼저 실행되어 빈 값으로 profiles 생성 → login.html insert 실패

**현재 방식**: login.html에서 signUp 후 profiles 직접 insert (정상 작동)

#### 3-2. 테스터 수동 등록

Trigger 문제로 profiles에 등록되지 않은 사용자 수동 추가:
```
Table Editor → profiles → Insert row
→ id, email, status, name, organization 입력
```

---

### 4. 자동 업데이트 시스템 활성화

#### 4-1. 버전 관리 체계 정립

| 변경 유형 | 버전 예시 | 예시 |
|----------|----------|------|
| 버그 수정 | x.x.X | 1.0.0 → 1.0.1 |
| 기능 추가 | x.X.0 | 1.0.1 → 1.1.0 |
| 대규모 변경 | X.0.0 | 1.1.0 → 2.0.0 |

#### 4-2. 자동 업데이트 배포 절차

```powershell
# 1. package.json 버전 수정
code C:\hr-system\package.json
# "version": "1.0.1" → "1.0.2"

# 2. Git 커밋 & 빌드
cd C:\hr-system
git add .
git commit -m "v1.0.2: 변경 내용"
git push origin main
npm run build

# 3. Tag 생성 & 푸시
git tag v1.0.2
git push origin v1.0.2

# 4. 파일명 변경 (공백 → 하이픈) ⭐ 중요!
cd C:\hr-system\dist
Rename-Item "HRM-System Setup 1.0.2.exe" "HRM-System-Setup-1.0.2.exe"
Rename-Item "HRM-System Setup 1.0.2.exe.blockmap" "HRM-System-Setup-1.0.2.exe.blockmap"

# 5. GitHub Release 생성 후 3개 파일 업로드
# - HRM-System-Setup-1.0.2.exe
# - HRM-System-Setup-1.0.2.exe.blockmap
# - latest.yml
```

#### 4-3. 파일명 규칙 (중요!)

| 항목 | 잘못된 예 | 올바른 예 |
|------|----------|----------|
| exe | `HRM-System Setup 1.0.2.exe` | `HRM-System-Setup-1.0.2.exe` |
| blockmap | `HRM-System Setup 1.0.2.exe.blockmap` | `HRM-System-Setup-1.0.2.exe.blockmap` |

**이유**: electron-updater가 하이픈(`-`)으로 파일을 찾음. 공백 사용 시 404 에러 발생

---

### 5. 앱 버전 v1.0.1 - 빠른실행 육아휴직 버그 수정

**문제점**: 빠른실행에서 "육아휴직" 클릭 시 `모듈을 찾을 수 없습니다: maternity-leave` 오류

**원인**:
| 위치 | 값 |
|------|-----|
| 빠른실행 버튼 | `navigateToModule('maternity-leave')` ❌ |
| 실제 모듈 ID | `id="module-maternity"` ✅ |

**해결**:
| 파일 | 수정 |
|------|------|
| 메인_인사.html (265줄) | `maternity-leave` → `maternity` |

**GitHub Release**: v1.0.1 - 빠른실행 육아휴직 버그 수정

---

### 6. 앱 버전 v1.0.2 - 업데이트 진행률 UI 개선

**문제점**: 업데이트 다운로드 시 진행 상황을 알 수 없음

**해결**: main.js v3.1.0

| 기능 | 설명 |
|------|------|
| 진행률 팝업창 | 다운로드 시 별도 모달창으로 진행률 표시 |
| 작업표시줄 진행률 | Windows 작업표시줄에도 진행률 바 표시 |
| 다운로드 용량 표시 | `45% (35.2 / 78.0 MB)` 형식 |

**추가된 함수**:
- `createProgressWindow()`: 진행률 윈도우 생성
- `closeProgressWindow()`: 진행률 윈도우 닫기 + 작업표시줄 초기화

**GitHub Release**: v1.0.2 - 업데이트 진행률 UI 개선

---

### 7. 수정된 파일 요약

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| 메인_인사.html | - | C:\hr-system\ | 빠른실행 육아휴직 모듈명 수정 |
| main.js | v3.1.0 | C:\hr-system\ | 업데이트 진행률 UI 개선 |
| index.html | - | C:\sw-hrm-landing\ | 저장 경로 안내, 오픈채팅 안내, 버전 자동 표시 |
| 초기화_인사.js | v1.1.0 | C:\hr-system\js\ | 대시보드 이번달 승급 호봉 표시 수정 |

---

### 8. 앱 버전 이력

| 앱 버전 | 날짜 | 주요 변경 |
|--------|------|----------|
| v1.0.0 | 2026-01-23 | 초기 배포 |
| v1.0.1 | 2026-01-28 | 빠른실행 육아휴직 버그 수정 |
| v1.0.2 | 2026-01-28 | 업데이트 진행률 UI 개선 |
| v1.0.3 | 2026-01-28 | 대시보드 이번달 승급 호봉 표시 수정 |
| v1.0.4 | 2026-01-29 | 시간외수당 절사 설정 적용 버그 수정 |
| v1.0.5 | 2026-01-29 | 인사카드 개별 직원 미리보기 버그 수정 |

---

### 9. 로그 파일 위치

업데이트 문제 발생 시 확인:
```powershell
# 앱 로그 확인
notepad "$env:APPDATA\hr-system\logs\main.log"

# 또는 마지막 50줄만 보기
Get-Content "$env:APPDATA\hr-system\logs\main.log" -Tail 50
```

---

**문서 끝 (v6.0 최종 - 전체 완료! 🎉)**

---

## 📌 v6.1 추가 작업 (2026-01-28)

### 10. 앱 버전 v1.0.3 - 대시보드 이번달 승급 호봉 표시 수정

**문제점**: 대시보드 "이번달 승급"에서 호봉이 잘못 표시됨
```
김나영: 1호봉 → 0호봉 (❌ 잘못됨)
실제로는: 7호봉 → 8호봉
```

**원인**: `showMonthlyUpgrades()` 함수에서 `getCurrentRank()` 호출 시 값이 제대로 반환되지 않음

**해결**: 초기화_인사.js v1.1.0
- `RankCalculator.calculateCurrentRank()` 직접 호출로 변경
- 폴백 로직 추가

| 파일 | 버전 | 경로 |
|------|------|------|
| 초기화_인사.js | v1.1.0 | C:\hr-system\js\ |

**GitHub Release**: v1.0.3 - 대시보드 이번달 승급 호봉 표시 수정

---

## 📚 배포 절차 표준 가이드 (초보자용)

> **중요**: 파일 수정 후에는 반드시 아래 절차를 따라 배포해야 사용자에게 자동 업데이트됩니다.

### 🔄 전체 배포 흐름

```
파일 수정 → 파일 적용 → 버전 수정 → Git 커밋 → 빌드 → Tag 생성 → 파일명 변경 → GitHub Release
```

---

### 📋 단계별 상세 절차

#### 1단계: 수정된 파일 적용

다운로드 받은 파일을 프로젝트 폴더에 복사합니다.

```powershell
# 예시: 초기화_인사.js 파일 적용
Copy-Item "C:\Users\김화겸\Downloads\초기화_인사.js" "C:\hr-system\js\초기화_인사.js" -Force

# 예시: main.js 파일 적용
Copy-Item "C:\Users\김화겸\Downloads\main.js" "C:\hr-system\main.js" -Force

# 예시: 메인_인사.html 파일 적용
Copy-Item "C:\Users\김화겸\Downloads\메인_인사.html" "C:\hr-system\메인_인사.html" -Force
```

---

#### 2단계: package.json 버전 수정

버전 번호를 올려야 자동 업데이트가 작동합니다.

```powershell
# VS Code로 package.json 열기
code C:\hr-system\package.json
```

**수정 내용**:
```json
{
  "name": "hr-system",
  "version": "1.0.2",  ← 이 숫자를 올립니다 (예: "1.0.3")
  ...
}
```

**버전 규칙**:
| 변경 유형 | 예시 | 설명 |
|----------|------|------|
| 버그 수정 | 1.0.2 → **1.0.3** | 마지막 숫자 +1 |
| 기능 추가 | 1.0.3 → **1.1.0** | 중간 숫자 +1, 마지막 0 |
| 대규모 변경 | 1.1.0 → **2.0.0** | 첫 숫자 +1, 나머지 0 |

저장: `Ctrl + S`

---

#### 3단계: Git 커밋 & 푸시

변경사항을 Git에 저장하고 GitHub에 업로드합니다.

```powershell
cd C:\hr-system
git add .
git commit -m "v1.0.3: 대시보드 이번달 승급 호봉 표시 수정"
git push origin main
```

**커밋 메시지 형식**:
```
v버전: 변경 내용 요약

예시:
v1.0.3: 대시보드 이번달 승급 호봉 표시 수정
v1.0.2: 업데이트 진행률 UI 개선
v1.0.1: 빠른실행 육아휴직 버그 수정
```

---

#### 4단계: 앱 빌드

설치 파일(.exe)을 생성합니다.

```powershell
npm run build
```

**빌드 완료 시 출력 예시**:
```
• building        target=nsis file=dist\HRM-System Setup 1.0.3.exe archs=x64
• building block map  blockMapFile=dist\HRM-System Setup 1.0.3.exe.blockmap
```

**생성되는 파일** (C:\hr-system\dist\):
- `HRM-System Setup 1.0.3.exe` (설치 파일)
- `HRM-System Setup 1.0.3.exe.blockmap` (차등 업데이트용)
- `latest.yml` (버전 정보)

---

#### 5단계: Git Tag 생성 & 푸시

GitHub Release를 위한 버전 태그를 생성합니다.

```powershell
git tag v1.0.3
git push origin v1.0.3
```

**확인**: GitHub 저장소 → Tags에서 `v1.0.3` 확인

---

#### 6단계: 파일명 변경 (⚠️ 중요!)

**반드시 공백을 하이픈으로 변경**해야 합니다. 그렇지 않으면 자동 업데이트가 404 에러 발생!

```powershell
cd C:\hr-system\dist
Rename-Item "HRM-System Setup 1.0.3.exe" "HRM-System-Setup-1.0.3.exe"
Rename-Item "HRM-System Setup 1.0.3.exe.blockmap" "HRM-System-Setup-1.0.3.exe.blockmap"
```

| 변경 전 (❌) | 변경 후 (✅) |
|-------------|-------------|
| `HRM-System Setup 1.0.3.exe` | `HRM-System-Setup-1.0.3.exe` |
| `HRM-System Setup 1.0.3.exe.blockmap` | `HRM-System-Setup-1.0.3.exe.blockmap` |

---

#### 7단계: GitHub Release 생성

1. **GitHub 접속**: https://github.com/mangfeel/hr-system/releases

2. **"Draft a new release" 클릭** (오른쪽 위 버튼)

3. **설정 입력**:
   | 항목 | 예시 |
   |------|------|
   | Choose a tag | `v1.0.3` 선택 |
   | Release title | `v1.0.3 - 대시보드 이번달 승급 호봉 표시 수정` |

4. **파일 업로드** (하단 영역에 드래그 또는 클릭):
   - `HRM-System-Setup-1.0.3.exe` ✅
   - `HRM-System-Setup-1.0.3.exe.blockmap` ✅
   - `latest.yml` ✅

5. **"Publish release" 클릭**

---

### ✅ 배포 완료 확인

1. GitHub Releases 페이지에서 `v1.0.3`이 **Latest**로 표시되는지 확인
2. 앱 실행 → 업데이트 알림이 나타나면 성공!

---

### 🔧 문제 발생 시 확인사항

| 문제 | 원인 | 해결 |
|------|------|------|
| 업데이트 알림 안 뜸 | package.json 버전 안 올림 | 버전 수정 후 재빌드 |
| 404 에러 | 파일명에 공백 있음 | 하이픈으로 변경 |
| 다운로드 실패 | 파일 누락 | 3개 파일 모두 업로드 확인 |
| Tag 없음 | tag push 안 함 | `git push origin v1.0.3` |

**로그 확인**:
```powershell
Get-Content "$env:APPDATA\hr-system\logs\main.log" -Tail 50
```

---

### 📝 배포 체크리스트

배포 전 확인:
- [ ] 파일 적용 완료
- [ ] package.json 버전 수정
- [ ] git commit & push
- [ ] npm run build 성공
- [ ] git tag 생성 & push
- [ ] 파일명 하이픈으로 변경
- [ ] GitHub Release 3개 파일 업로드
- [ ] Publish release 클릭

---

**문서 끝 (v6.1 최종 - 전체 완료! 🎉)**

---

## 📌 v6.2 추가 작업 (2026-01-29)

### 11. 앱 버전 v1.0.4 - 시간외수당 절사 설정 적용 버그 수정

**문제점**: 급여설정에서 시간외수당 절사 방식을 10원 단위 반올림으로 설정해도 적용 안 됨
```
설정: 10원 단위 반올림
예상 결과: 573,790원
실제 결과: 573,794원 (1원 단위로 계산됨)
```

**원인**: `SalaryCalculator.getOvertimeRoundingSettings()` 함수가 존재하지 않음
- 시간외근무_인사.js에서 이 함수를 호출하지만 정의되지 않아 항상 기본값 `unit: 1` 사용

**해결**: 시간외근무_인사.js v3.0.1
- `SalarySettingsManager.getOrdinarySettingsByYear()`에서 직접 `overtimeRounding` 설정 로드
- 기본값을 `unit: 1` → `unit: 10` (10원 단위)로 변경

| 파일 | 버전 | 경로 |
|------|------|------|
| 시간외근무_인사.js | v3.0.1 | C:\hr-system\js\labor\ |

**GitHub Release**: v1.0.4 - 시간외수당 절사 설정 적용 버그 수정

---

### 12. 관리자 페이지 개선

**추가된 기능**:

| 섹션 | 기능 |
|------|------|
| **발급된 라이선스** | 기관명 가나다순 정렬 + 검색 |
| **승인된 사용자** | 기관명 가나다순 정렬 + 검색 |
| **라이선스 발급 > 사용자 선택** | 검색 가능한 드롭다운으로 변경 |
| | 기관명/이메일/이름으로 검색 |
| | 이미 발급된 사용자는 **"발급됨"** 표시 (노란색) |
| | 미발급 사용자는 **"미발급"** 표시 (초록색) |
| | 미발급 사용자 먼저, 발급된 사용자 나중에 정렬 |

**UI 개선**:
- 드롭다운 최대 높이: 350px
- 항목 패딩: 16px (가독성 향상)
- 카드 overflow: visible (드롭다운이 잘리지 않음)

**배포**: Vercel 자동 배포 (Git push 시)

| 파일 | 경로 |
|------|------|
| index.html | C:\sw-hrm-admin\ |

---

### 13. 수정된 파일 요약 (v6.2)

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| 초기화_인사.js | v1.1.0 | C:\hr-system\js\ | 대시보드 이번달 승급 호봉 표시 수정 |
| 시간외근무_인사.js | v3.0.1 | C:\hr-system\js\labor\ | 시간외수당 절사 설정 적용 버그 수정 |
| index.html | - | C:\sw-hrm-admin\ | 관리자 페이지 검색/정렬 기능 추가 |

---

**문서 끝 (v6.2 최종 - 전체 완료! 🎉)**

---

## 📌 v7.0 추가 작업 (2026-01-29)

### 14. 앱 버전 v1.0.4 - 시간외수당 절사 설정 적용 버그 수정

**문제점**: 급여설정에서 시간외수당 절사 방식을 10원 단위 반올림으로 설정해도 적용 안 됨
```
설정: 10원 단위 반올림
예상 결과: 573,790원
실제 결과: 573,794원 (1원 단위로 계산됨)
```

**원인**: `SalaryCalculator.getOvertimeRoundingSettings()` 함수가 존재하지 않음
- 시간외근무_인사.js에서 이 함수를 호출하지만 정의되지 않아 항상 기본값 `unit: 1` 사용

**해결**: 시간외근무_인사.js v3.0.1
- `SalarySettingsManager.getOrdinarySettingsByYear()`에서 직접 `overtimeRounding` 설정 로드
- 기본값을 `unit: 1` → `unit: 10` (10원 단위)로 변경

| 파일 | 버전 | 경로 |
|------|------|------|
| 시간외근무_인사.js | v3.0.1 | C:\hr-system\js\labor\ |

**GitHub Release**: v1.0.4 - 시간외수당 절사 설정 적용 버그 수정

---

### 15. 앱 버전 v1.0.5 - 인사카드 개별 직원 미리보기 버그 수정

**문제점**: 인사카드에서 출력 범위를 '개별 직원 선택'으로 하고 미리보기 버튼을 누르면 결과가 출력되지 않음

**원인 분석 과정**:
1. 콘솔에서 ID 매칭 테스트 → 정상 (1명 매칭)
2. `_buildIndividualPage()` 테스트 → 정상 (페이지 생성됨)
3. `_buildProfileCardPages()` 테스트 → 정상 (1페이지 생성)
4. `_renderPage()` 테스트 → 정상 (4609자 HTML)
5. **DOM 요소 확인** → `profile-card-preview-content` 요소가 없음! ❌

**원인**: `onProfileCardRangeChange()`, `onEmployeeCheckboxChange()` 함수에서 미리보기 초기화 시 `previewArea.innerHTML`을 덮어써서 `profile-card-preview-content` 요소가 삭제됨

**변경 전 (문제 코드)**:
```javascript
const previewArea = document.getElementById('profile-card-preview');
if (previewArea) {
    previewArea.innerHTML = '<div class="preview-placeholder">...</div>';  // ❌ content 요소 삭제
}
```

**변경 후 (수정 코드)**:
```javascript
const previewContent = document.getElementById('profile-card-preview-content');
if (previewContent) {
    previewContent.innerHTML = '<div class="preview-placeholder">...</div>';  // ✅ content 유지
}
```

| 파일 | 버전 | 경로 |
|------|------|------|
| 인사카드_인사.js | v5.0.1 | C:\hr-system\js\reports\ |

**GitHub Release**: v1.0.5 - 인사카드 개별 직원 미리보기 버그 수정

---

### 16. 관리자 페이지 개선 (Vercel 배포)

**추가된 기능**:

| 섹션 | 기능 |
|------|------|
| **발급된 라이선스** | 기관명 가나다순 정렬 + 검색 |
| **승인된 사용자** | 기관명 가나다순 정렬 + 검색 |
| **라이선스 발급 > 사용자 선택** | 검색 가능한 드롭다운으로 변경 |
| | 기관명/이메일/이름으로 검색 |
| | 이미 발급된 사용자는 **"발급됨"** 표시 (노란색) |
| | 미발급 사용자는 **"미발급"** 표시 (초록색) |
| | 미발급 사용자 먼저, 발급된 사용자 나중에 정렬 |

**UI 개선**:
- 드롭다운 최대 높이: 350px
- 항목 패딩: 16px (가독성 향상)
- 카드 overflow: visible (드롭다운이 잘리지 않음)

**배포**: Vercel 자동 배포 (Git push 시)

| 파일 | 경로 |
|------|------|
| index.html | C:\sw-hrm-admin\ |

---

### 17. 수정된 파일 요약 (v7.0)

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| 시간외근무_인사.js | v3.0.1 | C:\hr-system\js\labor\ | 시간외수당 절사 설정 적용 버그 수정 |
| 인사카드_인사.js | v5.0.1 | C:\hr-system\js\reports\ | 개별 직원 미리보기 버그 수정 |
| index.html | - | C:\sw-hrm-admin\ | 관리자 페이지 검색/정렬/발급여부 표시 |

---

### 18. 앱 버전 이력 (v7.0 기준)

| 앱 버전 | 날짜 | 주요 변경 |
|--------|------|----------|
| v1.0.0 | 2026-01-23 | 초기 배포 |
| v1.0.1 | 2026-01-28 | 빠른실행 육아휴직 버그 수정 |
| v1.0.2 | 2026-01-28 | 업데이트 진행률 UI 개선 |
| v1.0.3 | 2026-01-28 | 대시보드 이번달 승급 호봉 표시 수정 |
| v1.0.4 | 2026-01-29 | 시간외수당 절사 설정 적용 버그 수정 |
| v1.0.5 | 2026-01-29 | 인사카드 개별 직원 미리보기 버그 수정 |

---

**문서 끝 (v7.0 최종 - 전체 완료! 🎉)**

---

## 📌 v8.0 추가 작업 (2026-01-29)

### 19. 관리자 페이지 기능 추가 (Vercel 배포)

**추가된 기능**:

| 기능 | 설명 |
|------|------|
| 📅 만료일 수정 | 라이선스 만료일 변경 모달 (빠른 연장: +30일, +90일, +1년) |
| 📦 플랜 변경 | trial/basic/premium 플랜 변경 |
| ⏸️/▶️ 상태 토글 | active ↔ inactive 상태 전환 |
| 🔍 만료 예정 필터 | 전체, 7일 내 만료, 30일 내 만료, 만료됨, 활성만, 비활성 |

**UI 변경**:
- 각 라이선스 행에 📦, 📅, ⏸️/▶️ 버튼 추가
- 액션 컬럼 너비: 140px → 250px
- 만료일 수정 모달 추가
- 플랜 변경 모달 추가
- 만료 예정 필터 셀렉트 박스 추가

**배포**: Vercel 자동 배포 (Git push 시)

| 파일 | 경로 |
|------|------|
| index.html | C:\sw-hrm-admin\ |

---

### 20. 앱 버전 v1.0.6 - 보안 백업 형식 적용 (.hrm)

**배경**: 
- 기존 JSON 백업 파일은 메모장이나 AI에게 내용이 그대로 노출됨
- 데이터 스키마, 필드명, 급여 테이블 등 구조 분석 가능
- 지적재산권 보호를 위해 백업 파일 보안 강화 필요

**해결 방안**: 바이너리 + 인코딩 방식 적용
- JSON → UTF-8 인코딩 → Base64 → 바이트 순서 변환 → 청크 섞기
- 파일 확장자: .json → .hrm
- 메모장으로 열어도 의미 없는 문자열만 표시
- AI에게 제공해도 구조 파악 불가

**변경 전 (.json)**:
```json
{ "name": "원호성", "startRank": 8, "dept": "경영지원팀" }
```
→ AI가 바로 분석 가능 ❌

**변경 후 (.hrm)**:
```
HRM_SECURE_BACKUP_V4
000847gFsX1NpQ2ZjZ3B...kL9mNbVcXzAqWsEd...
```
→ AI가 분석 불가 ✅

**수정 파일**:

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| 백업_인사.js | v4.0 | C:\hr-system\js\system\ | `_encodeBackupData()` 함수 추가, .hrm 형식 백업 |
| 복원가져오기_인사.js | v4.0 | C:\hr-system\js\system\ | `_decodeBackupData()` 함수 추가, .hrm/.json 둘 다 지원 |
| 메인_인사.html | - | C:\hr-system\ | 파일 선택 필터 `.hrm,.json`, UI 문구 변경 |

**하위 호환성**:
- 기존 .json 백업 파일도 복원 가능 (레거시 지원) ✅

**GitHub Release**: v1.0.6 - 보안 백업 형식 적용 (.hrm)

---

### 21. 수정된 파일 요약 (v8.0)

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| index.html | - | C:\sw-hrm-admin\ | 관리자 페이지 기능 추가 (만료일, 플랜, 상태, 필터) |
| 백업_인사.js | v4.0 | C:\hr-system\js\system\ | 보안 인코딩 적용, .hrm 형식 |
| 복원가져오기_인사.js | v4.0 | C:\hr-system\js\system\ | .hrm 디코딩 + .json 레거시 지원 |
| 메인_인사.html | - | C:\hr-system\ | 파일 필터/문구 변경 |

---

### 22. 앱 버전 이력 (v8.0 기준)

| 앱 버전 | 날짜 | 주요 변경 |
|--------|------|----------|
| v1.0.0 | 2026-01-23 | 초기 배포 |
| v1.0.1 | 2026-01-28 | 빠른실행 육아휴직 버그 수정 |
| v1.0.2 | 2026-01-28 | 업데이트 진행률 UI 개선 |
| v1.0.3 | 2026-01-28 | 대시보드 이번달 승급 호봉 표시 수정 |
| v1.0.4 | 2026-01-29 | 시간외수당 절사 설정 적용 버그 수정 |
| v1.0.5 | 2026-01-29 | 인사카드 개별 직원 미리보기 버그 수정 |
| v1.0.6 | 2026-01-29 | 보안 백업 형식 적용 (.hrm) |
| v1.0.7 | 2026-01-30 | 백업/복원 인코딩 버그 수정 (v4.1) |

---

### 23. 앱 버전 v1.0.7 - 백업/복원 인코딩 버그 수정

#### 문제점

v4.0 인코딩에서 마지막 청크가 16자 미만일 때 복원 시 청크 경계가 어긋나는 버그 발생

```
인코딩:
원래 청크: [c0(16자), c1(16자), c2(16자), c3(4자)]
shuffled = c1 + c3 + c0 + c2 = 52자

디코딩 (버그):
52자를 16자씩 다시 나누면 청크 경계가 어긋남
```

#### 해결

- 헤더 구조 변경: 6자리 → 12자리
- 헤더 = 청크개수(6자리) + 원본길이(6자리)
- 원본 길이 정보로 마지막 청크 크기 정확히 계산

#### 수정 파일

| 파일 | 버전 | 변경 내용 |
|------|------|----------|
| 백업_인사.js | v4.0 → v4.1 | 헤더 12자리 (청크개수 + 원본길이) |
| 복원가져오기_인사.js | v4.0 → v4.1 | v4.1/v4.0 형식 자동 감지, 레거시 호환 |

#### 호환성

- v4.1에서 생성한 .hrm 파일 → v4.1에서 복원 ✅
- v4.0에서 생성한 .hrm 파일 → v4.1에서 복원 ✅ (레거시 호환)

---

### 24. 랜딩페이지 업데이트 (2026-01-30)

#### 추가된 내용

| 섹션 | 내용 |
|------|------|
| 회원가입 안내 | 이메일/기관명/성명 실명 필수, 연락처 선택 |
| 테스트 기간 | 2026년 연말까지 (예정), 무료 사용 |
| 중요 안내사항 | 데이터 백업, PC 1대 제한, 개인정보 보호 |
| 화면 미리보기 | 스크린샷 5개 갤러리 (클릭 시 확대) |
| 개발자로부터 | 문구 개선 ("허접하게" → "미처 다듬지 못한") |
| 오픈채팅 안내 | 닉네임 설정 권유 → 자율 (가급적 기관명) |

#### 수정 파일

- C:\sw-hrm-landing\index.html
- C:\sw-hrm-landing\images\ (스크린샷 5개)

---

### 25. 수정된 파일 요약 (v8.1)

| 파일 | 경로 | 버전 |
|------|------|------|
| 백업_인사.js | C:\hr-system\js\system\ | v4.1 |
| 복원가져오기_인사.js | C:\hr-system\js\system\ | v4.1 |
| index.html | C:\sw-hrm-landing\ | 업데이트 |
| images/ | C:\sw-hrm-landing\ | 스크린샷 5개 추가 |

---

### 26. 앱 버전 이력 (v12.0 기준)

| 앱 버전 | 날짜 | 주요 변경 |
|--------|------|----------|
| v1.0.0 | 2026-01-23 | 초기 배포 |
| v1.0.1 | 2026-01-28 | 빠른실행 육아휴직 버그 수정 |
| v1.0.2 | 2026-01-28 | 업데이트 진행률 UI 개선 |
| v1.0.3 | 2026-01-28 | 대시보드 이번달 승급 호봉 표시 수정 |
| v1.0.4 | 2026-01-29 | 시간외수당 절사 설정 적용 버그 수정 |
| v1.0.5 | 2026-01-29 | 인사카드 개별 직원 미리보기 버그 수정 |
| v1.0.6 | 2026-01-29 | 보안 백업 형식 적용 (.hrm) |
| v1.0.7 | 2026-01-30 | 백업/복원 인코딩 버그 수정 (v4.1) |
| v1.0.8 | 2026-01-30 | 대시보드 부서별 현황 호봉 표시 버그 수정 |
| v1.0.9 | 2026-01-30 | 엑셀 가져오기 호봉 숫자 변환 버그 수정 |
| v1.0.10 | 2026-01-30 | 경력편집 저장 후 UI 개선 시도 |
| v1.0.11 | 2026-01-30 | 경력편집 모든 화면 갱신 비동기 처리 |
| v1.0.12 | 2026-01-30 | 경력편집 호봉 변경 즉시 반영 (캐시 무효화) |
| v1.0.13 | 2026-01-30 | 로그인 정보 자동 입력 기능 추가 |
| v1.0.14 | 2026-01-30 | 로그인 정보 자동 입력 버그 수정 |
| v1.0.15 | 2026-02-03 | 전체 삭제 시 모든 설정 데이터 삭제 |
| v1.0.16 | 2026-02-03 | 전체 삭제 시 electron-store 데이터도 삭제 |
| v1.0.17 | 2026-02-03 | 복원 결과 메시지 한글화 |
| v1.0.18 | 2026-02-03 | 겸직/직무대리 등록현황 담당 직원 이름 표시 버그 수정 |
| v1.0.19 | 2026-02-04 | 스크롤 시 상단 메뉴 + 검색창 함께 고정 |

---

### 27. 앱 버전 v1.0.8 - 대시보드 부서별 현황 호봉 표시 버그 수정

#### 문제점

대시보드 부서별 현황 클릭 시 호봉이 `[object Promise]`로 표시됨

```
경영지원팀 (9명)
백상훈 - 관장 - [object Promise]호봉  ← 버그!
```

#### 원인

직원유틸_인사.js v5.0.0에서 `getCurrentRank()`, `getNextUpgradeDate()` 함수가 async로 변경됨
→ 초기화_인사.js에서 await 없이 호출하여 Promise 객체가 문자열로 변환됨

#### 수정 파일

| 파일 | 버전 | 변경 내용 |
|------|------|----------|
| 초기화_인사.js | v3.1.0 → v3.2.0 | async/await 적용 |

#### 수정된 함수

| 함수 | 변경 내용 |
|------|----------|
| `showDeptEmployees()` | async로 변경, await 추가 |
| `_updateDashboardAlerts()` | async로 변경, await 추가 |
| `showMonthlyUpgrades()` | async로 변경, await 추가 |

---

### 28. 수정된 파일 요약 (v12.0)

| 파일 | 경로 | 버전 | 변경 내용 |
|------|------|------|----------|
| 초기화_인사.js | js/ | v3.2.0 | async/await 적용 |
| 백업_인사.js | js/system/ | v4.2 | 전체 삭제 시 모든 설정 + electron-store 삭제 |
| 복원가져오기_인사.js | js/system/ | v4.3 | 복원 메시지 한글화, 호봉 숫자 변환 |
| 경력편집_인사.js | js/career/ | v4.1.1 | 캐시 무효화 및 비동기 처리 |
| login.html | C:\hr-system\ | v1.1.1 | 로그인 정보 자동 입력 |
| index.html | 랜딩페이지 | - | 양식 다운로드 섹션, 직접 등록 권장, 업데이트 내역 섹션 |
| 초기_데이터_가져오기_양식.xlsx | 랜딩페이지 | NEW | 직원 일괄 등록 양식 |
| 포상_데이터_가져오기_양식.xlsx | 랜딩페이지 | NEW | 포상 일괄 등록 양식 |

---

### 29. 향후 개선사항

| 항목 | 현재 상태 | 비고 |
|------|----------|------|
| 앱 로드 시간 최적화 | ⏳ 보류 | 현재 14~20초 소요, JS 실행 시간 문제 |
| 데이터 삭제 후 딜레이 | ⏳ 보류 | location.reload() 때문에 새로고침 발생 |

---

**문서 끝 (v12.0 최종 - 전체 완료! 🎉)**

---

## 📝 v12.0 업데이트 내역 (2026-02-03)

### 전체 삭제 기능 완전 수정

#### 1. 문제점

"전체 삭제" 실행 후에도 일부 데이터가 남아있는 문제:
- 겸직/직무대리 설정
- 직급 관리, 급여표, 직책수당 설정
- electron-store에 저장된 데이터

#### 2. 원인

| 저장소 | 삭제 여부 (이전) | 삭제 여부 (수정 후) |
|--------|-----------------|-------------------|
| localStorage (직원 데이터) | ✅ 삭제됨 | ✅ 삭제됨 |
| localStorage (시스템 설정) | ❌ 남아있음 | ✅ 삭제됨 |
| electron-store | ❌ 남아있음 | ✅ 삭제됨 |

#### 3. 수정 내용 (백업_인사.js v4.2)

```javascript
// BACKUP_SYSTEM_KEYS에 정의된 모든 localStorage 키 삭제
Object.entries(BACKUP_SYSTEM_KEYS).forEach(([key, storageKey]) => {
    localStorage.removeItem(storageKey);
});

// Electron 환경: electron-store도 삭제
if (window.electronStore) {
    await window.electronStore.clear();
}
```

#### 4. 삭제되는 항목

| 항목 | localStorage 키 |
|------|-----------------|
| 직원 데이터 | hr_system_v25_db |
| 겸직/직무대리 | hr_concurrent_positions |
| 조직도 설정 | hr_org_chart_settings |
| 근속현황표 특수부서 | tenureReport_specialDepts |
| 포상 데이터 | hr_awards_data |
| 직급 관리 | hr_salary_grades |
| 급여표 | hr_salary_tables |
| 급여 설정 | hr_salary_settings |
| 통상임금 설정 | hr_ordinary_wage_settings |
| 직책수당 | hr_position_allowances |
| 급여 기본 설정 | hr_salary_basic_settings |
| 시간외근무 설정 | hr_overtime_settings |
| 시간외근무 기록 | hr_overtime_records |

### 복원 결과 메시지 한글화

#### 1. 변경 전

```
📋 시스템 설정 복원:
• 겸직/직무대리
• 조직도 설정
• salaryGrades      ← 영어
• salaryTables      ← 영어
• positionAllowances ← 영어
```

#### 2. 변경 후

```
📋 시스템 설정 복원:
• 겸직/직무대리
• 조직도 설정
• 직급 관리         ← 한글
• 급여표           ← 한글
• 직책수당 설정     ← 한글
```

#### 3. 한글 매핑 (복원가져오기_인사.js v4.3)

| 영어 키 | 한글 이름 |
|--------|----------|
| salaryGrades | 직급 관리 |
| salaryTables | 급여표 |
| salarySettings | 급여 설정 |
| ordinaryWageSettings | 통상임금 설정 |
| positionAllowances | 직책수당 설정 |
| salaryBasicSettings | 급여 기본 설정 |
| overtimeSettings | 시간외근무 설정 |
| overtimeRecords | 시간외근무 기록 |

### 앱 버전 이력 (v1.0.15 ~ v1.0.19)

| 버전 | 수정 파일 | 내용 |
|------|----------|------|
| v1.0.15 | 백업_인사.js (v4.2) | 전체 삭제 시 모든 설정 데이터 삭제 |
| v1.0.16 | 백업_인사.js (v4.2) | electron-store 데이터도 함께 삭제 |
| v1.0.17 | 복원가져오기_인사.js (v4.3) | 복원 결과 메시지 한글화 |
| v1.0.18 | 겸직관리_인사.js (v1.0.2) | 등록현황 담당 직원 이름 표시 버그 수정 |
| v1.0.19 | 스타일_인사.css | 스크롤 시 상단 메뉴 + 검색창 함께 고정 |

### 겸직/직무대리 등록현황 담당 직원 이름 표시 버그 수정

#### 1. 문제점

겸직/직무대리 관리 메뉴에서 등록 현황 테이블의 "담당 직원" 컬럼이 비어있음

#### 2. 원인

직원 데이터 구조와 코드의 불일치:

```javascript
// 기존 코드 (잘못됨)
const empName = employee ? employee.name : '(삭제된 직원)';

// 실제 직원 데이터 구조
employee.personalInfo.name  ← 이름이 여기에 저장됨
```

#### 3. 수정 내용 (겸직관리_인사.js v1.0.2)

```javascript
// 수정 후
const empName = employee ? (employee.personalInfo?.name || employee.name || '(이름없음)') : '(삭제된 직원)';
```

---

### 로그인 정보 자동 입력 기능

#### 1. 기능 설명

사용자 편의성 개선을 위해 로그인 정보 자동 입력 기능을 추가했습니다.

**사용자 흐름:**
```
[첫 로그인]
이메일/비밀번호 입력 → 로그인 버튼 클릭 → 정보 저장됨

[다음 접속부터]
앱 실행 → 이메일/비밀번호 자동 채워짐 → 로그인 버튼만 클릭!
```

#### 2. 구현 방식

| 항목 | 설명 |
|------|------|
| 저장 위치 | electron-store (로컬 PC) |
| 비밀번호 처리 | Base64 인코딩 |
| 저장 시점 | 로그인 성공 시 |
| 불러오기 시점 | 로그인 페이지 로드 시 |

#### 3. 수정 파일

| 파일 | 버전 | 변경 내용 |
|------|------|----------|
| login.html | v1.1.1 | 로그인 정보 저장/불러오기 함수 추가 |

**추가된 함수:**
- `loadSavedLoginInfo()`: 저장된 로그인 정보 불러와서 입력란에 채움
- `saveLoginInfo(email, password)`: 로그인 성공 시 정보 저장

#### 4. 버그 수정 (v1.0.14)

v1.0.13에서 발견된 버그 수정:

```javascript
// 문제: electronStore.get() 반환 형식 오해
// 실제 반환값: {success: true, data: {...}}

// 변경 전 (버그)
const savedLogin = await window.electronStore.get('savedLogin');
if (savedLogin && savedLogin.email) { ... }

// 변경 후 (수정)
const result = await window.electronStore.get('savedLogin');
if (result && result.success && result.data && result.data.email) {
    const savedLogin = result.data;
    ...
}
```

#### 5. 랜딩페이지 업데이트

**직접 등록 권장 안내 추가:**

엑셀 양식 다운로드 섹션에 아래 안내 문구 추가:

```
💡 직접 등록을 권장합니다

엑셀 가져오기는 기존 데이터 이관 시 편의를 위한 기능입니다.
가능하다면 프로그램에서 직접 등록하시는 것이 더 정확하고 안전합니다.
```

#### 6. 앱 버전 이력 (v1.0.13 ~ v1.0.14)

| 버전 | 수정 파일 | 내용 |
|------|----------|------|
| v1.0.13 | login.html (v1.1.0) | 로그인 정보 자동 입력 기능 추가 |
| v1.0.14 | login.html (v1.1.1) | electronStore 반환 형식 버그 수정 |

---

### 엑셀 가져오기 양식 및 랜딩페이지 개선

#### 1. 엑셀 가져오기 양식 생성

**생성된 파일:**

| 파일명 | 용도 | 시트 |
|--------|------|------|
| 초기_데이터_가져오기_양식.xlsx | 직원 일괄 등록 | 직원정보, 사용안내 |
| 포상_데이터_가져오기_양식.xlsx | 포상 일괄 등록 | 포상데이터, 사용안내 |

**초기 데이터 양식 포함 항목:**
- 인적사항 (이름, 주민번호, 연락처)
- 소속 정보 (부서, 직위, 직급)
- 입사 정보 (입사일, 고용형태)
- 호봉 정보 (입사호봉, 첫승급년월일, 현재호봉)
- 발령 이력 (여러 발령 지원)
- 육아휴직 정보

**포상 데이터 양식 포함 항목:**
- 포상 구분 (내부/외부)
- 포상 내역 (행사명/포상명)
- 훈격 (수여자/기관장)
- 포상 주관처
- 선정 여부
- 수상 년월일

**직급 필드 정의 (인건비 가이드):**
- 사회복지직: 사회복지사, 선임사회복지사
- 일반직: 일반직 4급, 3급, 2급, 1급
- 관리직: 관리직 3급, 2급, 1급

#### 2. 랜딩페이지 양식 다운로드 섹션 추가

**위치:** 테스트 참여 안내 섹션 뒤

**포함 내용:**
- 양식 다운로드 카드 2개 (초기 데이터, 포상 데이터)
- 사용 방법 4단계 안내
- 주의사항 (호봉제 필수 작업 포함)

**호봉제 직원 필수 작업 안내 (빨간색 강조):**
```
🔴 호봉제 직원 필수 작업:
엑셀로 등록된 호봉제 직원은 반드시 아래 작업을 수행해야 차기승급일이 정상 반영됩니다.

① [인력관리 → 경력관리] 메뉴로 이동
② 해당 직원 선택 후 "경력편집" 버튼 클릭
③ "호봉 재계산 및 저장" 버튼 클릭

※ 이 작업을 하지 않으면 차기승급일이 표시되지 않습니다.
```

#### 3. 버그 수정 및 개선 (v1.0.9 ~ v1.0.12)

| 버전 | 수정 파일 | 내용 |
|------|----------|------|
| v1.0.9 | 복원가져오기_인사.js (v4.2) | 엑셀 가져오기 호봉 숫자 변환 버그 수정 (`parseInt()` 추가) |
| v1.0.10 | 경력편집_인사.js | 저장 후 UI 블로킹 개선 시도 |
| v1.0.11 | 경력편집_인사.js | 모든 화면 갱신 비동기 처리 |
| v1.0.12 | 경력편집_인사.js (v4.1.1) | 배치 API 캐시 무효화 추가 (`API_인사.clearBatchCache()`) |

**복원가져오기_인사.js v4.2 수정 내용:**
```javascript
// 변경 전 (버그)
startRank: latest['입사호봉'] || 1,     // "1" (문자열)
currentRank: latest['현재호봉'] || 1,   // "1" (문자열)

// 변경 후 (수정)
startRank: parseInt(latest['입사호봉']) || 1,     // 1 (숫자)
currentRank: parseInt(latest['현재호봉']) || 1,   // 1 (숫자)
```

**경력편집_인사.js v4.1.1 수정 내용:**
```javascript
// 캐시 무효화 추가
if (typeof API_인사 !== 'undefined' && typeof API_인사.clearBatchCache === 'function') {
    API_인사.clearBatchCache();
}

// 모든 화면 갱신 비동기 처리
setTimeout(() => {
    if (isCareerManageActive || careerEditSource === 'career-manage') {
        loadCareerManagementTab();
    } else {
        showEmployeeDetail(emp.id);
    }
    loadEmployeeList();
}, 50);
```

#### 4. 랜딩페이지 파일 목록

```
C:\sw-hrm-landing\
├── index.html                          # 메인 페이지 (양식 섹션 추가)
├── 초기_데이터_가져오기_양식.xlsx      # NEW
├── 포상_데이터_가져오기_양식.xlsx      # NEW
└── images/
    └── (스크린샷 이미지들)
```

#### 5. 배포 완료 현황

| 항목 | 상태 | 비고 |
|------|------|------|
| 엑셀 양식 2개 | ✅ 완료 | 랜딩페이지에 배포 |
| 랜딩페이지 양식 섹션 | ✅ 완료 | index.html 수정 |
| 호봉제 필수 작업 안내 | ✅ 완료 | 주의사항에 추가 |
| v1.0.9 릴리즈 | ✅ 완료 | 호봉 숫자 변환 버그 |
| v1.0.10 릴리즈 | ✅ 완료 | UI 블로킹 개선 |
| v1.0.11 릴리즈 | ✅ 완료 | 비동기 처리 |
| v1.0.12 릴리즈 | ✅ 완료 | 캐시 무효화 |

---

---

## 📌 부록: 로컬 PC 변경 가이드

### 개요

로컬 개발 환경을 새 PC로 이전하는 방법입니다.

---

### 방법 1: 폴더 복사 (권장 - 가장 빠름)

#### 1단계: 기존 PC에서 폴더 복사

**복사할 폴더** (USB 또는 외장하드):
```
C:\hr-system
C:\hr-system-server
C:\sw-hrm-admin
C:\sw-hrm-landing
```

**제외 권장** (용량 큼, 새 PC에서 재설치):
```
hr-system\node_modules
hr-system\dist
```

#### 2단계: 새 PC에 필수 프로그램 설치

| 프로그램 | 다운로드 |
|----------|----------|
| Node.js | https://nodejs.org (LTS 버전) |
| Git | https://git-scm.com |
| VS Code | https://code.visualstudio.com |

#### 3단계: 폴더 붙여넣기 후 패키지 설치

```powershell
# hr-system
cd C:\hr-system
npm install

# 실행 테스트
npm start
```

#### 4단계: Git 설정 (최초 1회)

```powershell
git config --global user.name "이름"
git config --global user.email "이메일"
```

---

### 방법 2: GitHub에서 Clone (깔끔함)

#### 1단계: 필수 프로그램 설치

위와 동일

#### 2단계: GitHub에서 코드 복제

```powershell
cd C:\
git clone https://github.com/mangfeel/hr-system.git
cd hr-system
npm install
```

#### 3단계: 실행 테스트

```powershell
npm start
```

---

### 클라우드 저장 현황 (자동 유지)

| 항목 | 저장 위치 | PC 교체 영향 |
|------|----------|-------------|
| 소스 코드 | GitHub | ❌ 없음 |
| 서버 API | Supabase | ❌ 없음 |
| 관리자 페이지 | Vercel | ❌ 없음 |
| 데이터베이스 | Supabase | ❌ 없음 |

**모든 핵심 자료가 클라우드에 있어서 새 PC에서 그대로 작업 가능**

---

### 난이도

```
★☆☆☆☆ (쉬움) - 약 30분~1시간 소요
```

---

### 저작권 등록용 실행파일 빌드 가이드

저작권 등록 시 로그인 없이 바로 실행되는 버전이 필요할 수 있습니다.

#### 1. 수정이 필요한 파일 (2개)

| 파일 | 위치 | 수정 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | 119번 줄: `login.html` → `메인_인사.html` |
| 메인_인사.html | C:\hr-system\ | 73~79번 줄: 인증 체크 코드 우회 |

#### 2. main.js 수정 (119번 줄)

```javascript
// 변경 전
mainWindow.loadFile('login.html');

// 변경 후
mainWindow.loadFile('메인_인사.html');
```

#### 3. 메인_인사.html 수정 (73~79번 줄)

```html
<!-- 변경 전 -->
<script>
    (async function() {
        const isLoggedIn = await Auth_인사.init();
        if (!isLoggedIn) {
            window.location.href = 'login.html';
        }
    })();
</script>

<!-- 변경 후 -->
<script>
    // 저작권 등록용: 인증 우회
    console.log('[저작권등록용] 인증 체크 우회');
</script>
```

#### 4. 빌드 절차

```powershell
# 1. 원본 백업
Copy-Item "C:\hr-system\main.js" "C:\Users\김화겸\Documents\main_원본.js" -Force
Copy-Item "C:\hr-system\메인_인사.html" "C:\Users\김화겸\Documents\메인_인사_원본.html" -Force

# 2. 파일 수정 (위 내용 참고)
notepad C:\hr-system\main.js
notepad C:\hr-system\메인_인사.html

# 3. 빌드
cd C:\hr-system
npm run build

# 4. 저작권용 파일 별도 보관
Copy-Item "C:\hr-system\dist\HRM-System Setup 1.0.18.exe" "C:\Users\김화겸\Documents\HRM-System-저작권등록용.exe" -Force

# 5. 원본 복원
Copy-Item "C:\Users\김화겸\Documents\main_원본.js" "C:\hr-system\main.js" -Force
Copy-Item "C:\Users\김화겸\Documents\메인_인사_원본.html" "C:\hr-system\메인_인사.html" -Force
```

#### 5. 테스트 전 기존 설치 제거

```powershell
# 관련 폴더 삭제
Remove-Item "C:\Users\김화겸\AppData\Local\hr-system" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item "C:\Users\김화겸\AppData\Roaming\hr-system" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item "C:\Users\김화겸\AppData\Local\Programs\hr-system" -Recurse -Force -ErrorAction SilentlyContinue

# 저작권등록용 설치 테스트
& "C:\Users\김화겸\Documents\HRM-System-저작권등록용.exe"
```

#### 6. 주의사항

- 저작권 등록용은 **로그인/라이선스 없이** 바로 메인 화면 실행
- 빌드 후 반드시 **원본 파일 복원** 필요
- 정식 배포용과 혼동하지 않도록 파일명 구분

---

**부록 끝**

---

## 📌 향후 계획: 사업화 로드맵

### 개요

서비스 상용화를 위한 향후 작업 계획입니다.

---

### Phase 1: 도메인 및 이메일 시스템

#### 1-1. 커스텀 도메인 구매

| 항목 | 내용 |
|------|------|
| 목적 | 신뢰성 향상, 이메일 발송 해결 |
| 구매처 | 가비아, 카페24, 호스팅케이알 등 |
| 예상 비용 | 연 1~3만원 |
| 예시 | swhrm.co.kr |

#### 1-2. Vercel 도메인 연결

```
도메인 구매
    ↓
Vercel 프로젝트 설정 > Domains
    ↓
DNS 설정 (도메인 업체에서)
    ↓
연결 완료
```

**연결할 서비스:**

| 서비스 | 현재 URL | 변경 후 |
|--------|----------|---------|
| 랜딩 페이지 | sw-hrm-landing-xxx.vercel.app | swhrm.co.kr |
| 관리자 페이지 | sw-hrm-admin-xxx.vercel.app | admin.swhrm.co.kr |

#### 1-3. 이메일 서비스 연동 (Resend)

**현재 문제:**
```
Resend 무료 플랜 + 도메인 미인증
    ↓
자신의 이메일로만 발송 가능
    ↓
사용자에게 라이선스 키 이메일 발송 ❌
```

**해결 절차:**
```
1. Resend에 도메인 추가 (resend.com/domains)
2. DNS 레코드 설정 (DKIM, SPF)
3. 도메인 인증 완료
4. 관리자 페이지 발신 주소 변경 (noreply@swhrm.co.kr)
5. 이메일 발송 가능 ✅
```

**예상 소요 시간:** 1~2시간

---

### Phase 2: 결제 시스템 구축

#### 2-1. 필수 요건

| 항목 | 필수 여부 | 설명 |
|------|----------|------|
| 사업자등록 | ✅ 필수 | 결제 대행사 가입에 필요 |
| 통신판매업 신고 | ✅ 필수 | 온라인 판매 시 필수 |
| 사업용 계좌 | ✅ 필수 | 정산금 입금용 |
| 도메인 | ✅ 필수 | 결제창 연동에 필요 |

#### 2-2. 사업자등록

| 항목 | 내용 |
|------|------|
| 신청 방법 | 홈택스 또는 세무서 방문 |
| 비용 | 무료 |
| 소요 시간 | 즉시~3일 |
| 업종 예시 | 소프트웨어 개발 및 공급업 |

#### 2-3. 통신판매업 신고

| 항목 | 내용 |
|------|------|
| 신청 방법 | 정부24 또는 구청 방문 |
| 비용 | 무료 |
| 소요 시간 | 즉시~3일 |
| 필요 서류 | 사업자등록증 |

#### 2-4. 결제 대행사(PG) 가입

| PG사 | 특징 | 수수료 |
|------|------|--------|
| **토스페이먼츠** | 연동 쉬움, 문서 좋음 | 약 3% |
| 아임포트(포트원) | 여러 PG 통합 | 약 3% |
| NHN KCP | 대형, 안정적 | 약 3% |

#### 2-5. 결제 시스템 개발

**자동화 흐름:**
```
[사용자] 플랜 선택 → 결제 버튼 클릭
    ↓
[PG사] 결제 처리
    ↓
[서버] 결제 완료 웹훅 수신
    ↓
[Supabase] 라이선스 자동 생성 + DB 저장
    ↓
[Resend] 이메일로 라이선스 키 발송
    ↓
[사용자] 앱에서 라이선스 입력 → 사용 시작
```

---

### Phase 3: 예상 비용 및 일정

#### 비용

| 항목 | 비용 |
|------|------|
| 사업자등록 | 무료 |
| 통신판매업 신고 | 무료 |
| 도메인 | 연 1~3만원 |
| PG 가입비 | 무료 |
| PG 수수료 | 결제금액의 약 3% |
| Resend (이메일) | 월 100건 무료, 이후 유료 |

#### 일정

| 단계 | 예상 시간 |
|------|----------|
| 도메인 구매 + 연결 | 1시간 |
| 이메일 서비스 연동 | 2~3시간 |
| 사업자등록 | 1~3일 |
| 통신판매업 신고 | 1~3일 |
| PG 심사 | 3~7일 |
| 결제 시스템 개발 | 1~2일 |
| **총** | **약 1~2주** |

---

### 진행 상태

| 단계 | 상태 |
|------|------|
| Phase 1: 도메인 + 이메일 | ⏳ 대기 |
| Phase 2: 결제 시스템 | ⏳ 대기 |

---

### Phase 4: 수익 시뮬레이션 (4대보험 포함)

#### 월 비용 총정리

**고정비용:**

| 항목 | 금액 |
|------|------|
| 도메인 | 2,000원 |
| Supabase | 35,000원 |
| Resend | 15,000원 |
| 코드 서명 (선택) | 15,000원 |
| 세무기장 | 70,000원 |
| **합계** | **약 150,000원** |

**변동비용:**

| 항목 | 비율 |
|------|------|
| PG 수수료 | 매출의 3% |
| 부가세 | 매출의 10% |
| 국민연금 | 순이익의 9% |
| 건강보험 | 순이익의 7% |
| **4대보험 합계** | **순이익의 16%** |

---

#### 가격대별 시뮬레이션

**📌 월 19,900원 (저가형)**

| 고객 | 월매출 | 세전이익 | 4대보험 | **월순이익** | **연순이익** |
|------|--------|----------|---------|-------------|-------------|
| 10곳 | 199,000 | 23,130 | 3,701 | **19,429** | 233,148 |
| 20곳 | 398,000 | 196,260 | 31,402 | **164,858** | 1,978,296 |
| 30곳 | 597,000 | 369,390 | 59,102 | **310,288** | 3,723,456 |
| 50곳 | 995,000 | 715,650 | 114,504 | **601,146** | 7,213,752 |
| 100곳 | 1,990,000 | 1,581,300 | 253,008 | **1,328,292** | 15,939,504 |

**📌 월 29,000원 (표준형)**

| 고객 | 월매출 | 세전이익 | 4대보험 | **월순이익** | **연순이익** |
|------|--------|----------|---------|-------------|-------------|
| 10곳 | 290,000 | 102,300 | 16,368 | **85,932** | 1,031,184 |
| 20곳 | 580,000 | 354,600 | 56,736 | **297,864** | 3,574,368 |
| 30곳 | 870,000 | 606,900 | 97,104 | **509,796** | 6,117,552 |
| 50곳 | 1,450,000 | 1,111,500 | 177,840 | **933,660** | 11,203,920 |
| 100곳 | 2,900,000 | 2,373,000 | 379,680 | **1,993,320** | 23,919,840 |

**📌 월 39,000원 (권장)**

| 고객 | 월매출 | 세전이익 | 4대보험 | **월순이익** | **연순이익** |
|------|--------|----------|---------|-------------|-------------|
| 10곳 | 390,000 | 189,300 | 30,288 | **159,012** | 1,908,144 |
| 20곳 | 780,000 | 528,600 | 84,576 | **444,024** | 5,328,288 |
| 30곳 | 1,170,000 | 867,900 | 138,864 | **729,036** | 8,748,432 |
| 50곳 | 1,950,000 | 1,546,500 | 247,440 | **1,299,060** | 15,588,720 |
| 100곳 | 3,900,000 | 3,243,000 | 518,880 | **2,724,120** | 32,689,440 |

**📌 월 49,000원 (프리미엄)**

| 고객 | 월매출 | 세전이익 | 4대보험 | **월순이익** | **연순이익** |
|------|--------|----------|---------|-------------|-------------|
| 10곳 | 490,000 | 276,300 | 44,208 | **232,092** | 2,785,104 |
| 20곳 | 980,000 | 702,600 | 112,416 | **590,184** | 7,082,208 |
| 30곳 | 1,470,000 | 1,128,900 | 180,624 | **948,276** | 11,379,312 |
| 50곳 | 2,450,000 | 1,981,500 | 317,040 | **1,664,460** | 19,973,520 |
| 100곳 | 4,900,000 | 4,113,000 | 658,080 | **3,454,920** | 41,459,040 |

---

#### 손익분기점 (4대보험 포함)

| 월 이용료 | 손익분기점 | 흑자 시작 |
|----------|-----------|----------|
| 19,900원 | 약 **8곳** | 9곳부터 |
| 29,000원 | 약 **6곳** | 7곳부터 |
| 39,000원 | 약 **5곳** | 6곳부터 |
| 49,000원 | 약 **4곳** | 5곳부터 |

---

#### 가격대별 비교 요약

**30곳 기준:**

| 월 이용료 | 월 매출 | 월 순이익 | 연 순이익 |
|----------|--------|----------|----------|
| 19,900원 | 597,000 | 310,288 | **372만원** |
| 29,000원 | 870,000 | 509,796 | **612만원** |
| 39,000원 | 1,170,000 | 729,036 | **875만원** |
| 49,000원 | 1,470,000 | 948,276 | **1,138만원** |

**50곳 기준:**

| 월 이용료 | 월 매출 | 월 순이익 | 연 순이익 |
|----------|--------|----------|----------|
| 19,900원 | 995,000 | 601,146 | **721만원** |
| 29,000원 | 1,450,000 | 933,660 | **1,120만원** |
| 39,000원 | 1,950,000 | 1,299,060 | **1,559만원** |
| 49,000원 | 2,450,000 | 1,664,460 | **1,997만원** |

**100곳 기준:**

| 월 이용료 | 월 매출 | 월 순이익 | 연 순이익 |
|----------|--------|----------|----------|
| 19,900원 | 1,990,000 | 1,328,292 | **1,594만원** |
| 29,000원 | 2,900,000 | 1,993,320 | **2,392만원** |
| 39,000원 | 3,900,000 | 2,724,120 | **3,269만원** |
| 49,000원 | 4,900,000 | 3,454,920 | **4,146만원** |

---

#### 추천 전략

| 단계 | 가격 | 목표 | 월 순이익 | 연 순이익 |
|------|------|------|----------|----------|
| **초기** (고객 확보) | 29,000원 | 30곳 | 약 51만원 | 약 612만원 |
| **안정기** | 39,000원 | 50곳 | 약 130만원 | 약 1,559만원 |
| **성장기** | 49,000원 | 100곳 | 약 345만원 | 약 4,146만원 |

---

#### 1인 사업자 4대보험 안내

| 보험 | 1인 사업자 | 직원 고용 시 |
|------|-----------|-------------|
| **국민연금** | ✅ 의무 (지역가입자) | ✅ 의무 |
| **건강보험** | ✅ 의무 (지역가입자) | ✅ 의무 |
| **고용보험** | ❌ 선택 | ✅ 의무 |
| **산재보험** | ❌ 선택 | ✅ 의무 |

**납부 방법:** 고지서 → 직접 납부 (자동이체 가능)

**참고:** 세무기장은 장부/세금 신고 대행이며, 4대보험 납부는 별도로 직접 처리

---

### Phase 3: 코드 서명 인증서 (선택사항)

#### 개요

| 항목 | 내용 |
|------|------|
| 목적 | Windows SmartScreen 경고 제거 |
| 필수 여부 | ❌ 선택사항 |
| 권장 시점 | 유료 판매, 다수 고객 대상 시 |

#### 현재 vs 서명 후

| 구분 | 서명 없음 (현재) | 서명 있음 |
|------|-----------------|----------|
| 설치 시 | "추가 정보 → 실행" 필요 | 바로 설치 |
| 표시 | "알 수 없는 게시자" | "신뢰할 수 있는 게시자" |
| 신뢰도 | 낮음 | 높음 |
| 비용 | 무료 | 연 10~70만원 |

#### 구매처 및 가격

| 업체 | 인증서 종류 | 가격 (연) | 특징 |
|------|------------|----------|------|
| **Sectigo** | Code Signing | $70~$200 | 가장 저렴 |
| **Comodo** | Code Signing | $80~$200 | Sectigo와 동일 (브랜드명) |
| **DigiCert** | Code Signing | $400~$500 | 대기업용, 비쌈 |
| **GlobalSign** | Code Signing | $250~$350 | 중간 가격대 |
| **Certum** | Open Source Code Signing | $40~$50 | 오픈소스용 (제한적) |

**💡 추천:** Sectigo 또는 Comodo (가성비 좋음)

#### 구매 방법

**방법 1: 직접 구매 (영문 사이트)**

```
1. Sectigo 공식 사이트 접속
   https://sectigo.com/ssl-certificates-tls/code-signing

2. "Code Signing" 선택

3. 결제 (해외 카드 필요)

4. 신원 인증 (사업자등록증, 신분증 등)

5. 인증서 발급 (1~3일)

6. electron-builder에 적용
```

**방법 2: 국내 리셀러 구매 (한글 지원)**

| 리셀러 | 사이트 | 특징 |
|--------|--------|------|
| 한국전자인증 | keca.or.kr | 국내 대표 |
| 코드사인 | codesign.kr | 코드 서명 전문 |
| 가비아 | gabia.com | 도메인과 함께 |

```
1. 리셀러 사이트 접속

2. 코드 서명 인증서 선택

3. 결제 (국내 카드 가능)

4. 서류 제출 (사업자등록증 필요)

5. 인증서 발급 (3~7일)
```

#### 필요 서류

| 서류 | 개인 | 사업자 |
|------|------|--------|
| 신분증 | ✅ | ✅ |
| 사업자등록증 | - | ✅ |
| 전화 인증 | ✅ | ✅ |

#### electron-builder 적용 방법

**package.json 수정:**
```json
{
  "build": {
    "win": {
      "certificateFile": "path/to/certificate.pfx",
      "certificatePassword": "인증서비밀번호"
    }
  }
}
```

#### 진행 상태

| 단계 | 상태 |
|------|------|
| 코드 서명 인증서 | ⏳ 선택사항 (나중에 필요 시) |

---

### Phase 5: 코드 난독화 (선택사항 - 참고용)

#### 개요

| 항목 | 내용 |
|------|------|
| 목적 | 소스 코드 분석 방지 (지적재산권 보호 강화) |
| 필수 여부 | ❌ 선택사항 |
| 권장 시점 | 사업 확장 시 (고객 100곳 이상) |
| 현재 상태 | 미적용 (현재 보안 수준으로 충분) |

#### 현재 보안 상황

**문제점:**
```
HRM-System-Setup.exe 설치
    ↓
C:\Users\...\AppData\Local\Programs\hr-system\resources\app.asar
    ↓
npx asar extract app.asar ./extracted  (누구나 가능)
    ↓
백업_인사.js 등 소스 코드 추출 가능 ⚠️
```

**현재 분석 가능 여부:**

| 대상 | 분석 가능? |
|------|-----------|
| .hrm 백업 파일만 가진 사람 | ❌ 불가능 |
| AI에게 .hrm만 제공 | ❌ 불가능 ✅ |
| 일반 사용자 (95%+) | ❌ 불가능 |
| 전문 개발자 (5% 미만) | ⚠️ 가능 (asar 추출 시) |

**현재 보안 수준:** ★★★☆☆ (3/5) - 일반적인 상황에서 충분

#### 난독화 방법

**방법 1: JavaScript 난독화**

| 항목 | 내용 |
|------|------|
| 도구 | javascript-obfuscator |
| 효과 | 코드를 읽기 어렵게 변환 |
| 난이도 | 쉬움 (1~2시간) |
| 보안 수준 | ★★★★☆ |

변환 예시:
```javascript
// 변환 전
function _encodeBackupData(data) {
    const jsonStr = JSON.stringify(data);
    return btoa(jsonStr);
}

// 변환 후
var _0x3f2a=['stringify','btoa'];(function(_0x2d8f05,_0x3f2a6b){
var _0x4e8c12=function(_0x1a2b3c){while(--_0x1a2b3c){_0x2d8f05
['push'](_0x2d8f05['shift']());}};_0x4e8c12(++_0x3f2a6b);}...
```

**방법 2: Bytenode 컴파일 (더 강력)**

| 항목 | 내용 |
|------|------|
| 도구 | bytenode |
| 효과 | JS → V8 바이트코드 변환 (바이너리) |
| 난이도 | 중간 (3~4시간) |
| 보안 수준 | ★★★★★ |

```
원본 .js 파일 → V8 바이트코드 (.jsc) → 사람이 읽을 수 없음
```

#### 적용 시 위험 요소 ⚠️

| 문제 | 설명 |
|------|------|
| 전역 함수 참조 오류 | `window.License`, `window.SalaryCalculator` 등 이름 변경 시 호출 실패 |
| HTML 인라인 이벤트 | `onclick="backupToJSON()"` 작동 안 함 |
| 파일 간 연결 | 여러 JS 파일이 서로 함수 호출, 이름 변경 시 연결 끊김 |
| 디버깅 어려움 | 오류 발생 시 원인 찾기 매우 어려움 |

**현재 시스템:** 전역 함수/변수가 많이 연결되어 있어 신중한 테스트 필요

#### 보안 수준 비교

| 방법 | 일반인 | 개발자 | 전문 해커 |
|------|--------|--------|----------|
| 현재 (평문) | ❌ | ✅ 분석 가능 | ✅ |
| 난독화 적용 | ❌ | ⚠️ 어려움 | ✅ 가능 |
| Bytenode | ❌ | ❌ | ⚠️ 매우 어려움 |

#### 결론

```
현재: 적용 안 함 (위험도 높음, 현재 보안 수준 충분)
    ↓
나중에: 사업 확장 시 신중하게 테스트 후 적용 검토
```

#### 진행 상태

| 단계 | 상태 |
|------|------|
| 코드 난독화 | ⏳ 선택사항 (나중에 필요 시) |

---

### Phase 5: 소스 코드 보호 - 난독화/컴파일 (선택사항)

#### 개요

| 항목 | 내용 |
|------|------|
| 목적 | app.asar 추출 시에도 소스 코드 분석 어렵게 |
| 필수 여부 | ❌ 선택사항 |
| 권장 시점 | 사업 확장 시 (고객 100곳 이상) |
| 위험도 | ⚠️ 중간 (적용 시 충분한 테스트 필요) |

#### 현재 상황

```
HRM-System-Setup-x.x.x.exe 설치
    ↓
C:\Users\...\AppData\Local\Programs\hr-system\resources\app.asar
    ↓
npx asar extract app.asar ./extracted  (누구나 가능)
    ↓
백업_인사.js 등 소스 코드 추출 가능 ⚠️
```

#### 현재 보안 수준

| 대상 | .hrm 분석 | 소스 코드 분석 |
|------|----------|---------------|
| 일반 사용자 (95%+) | ❌ 불가능 | ❌ 불가능 (모름) |
| AI에게 .hrm 제공 | ❌ 불가능 | - |
| 전문 개발자 (5% 미만) | ✅ 가능 | ✅ 가능 |

**→ 현재 수준으로도 일반적인 상황에서 충분함**

#### 보호 방법

**방법 1: JavaScript 난독화 (Obfuscation)**

| 항목 | 내용 |
|------|------|
| 효과 | ⭐⭐⭐ (읽기 어렵게 변환) |
| 난이도 | 쉬움 (1~2시간) |
| 도구 | javascript-obfuscator |

변환 예시:
```javascript
// 변환 전
function backupToJSON() {
    const data = getAllData();
    return JSON.stringify(data);
}

// 변환 후
var _0x3f2a=['stringify','getAllData'];(function(_0x2d8f05,_0x3f2a6b){
var _0x4e8c12=function(_0x1a2b3c){while(--_0x1a2b3c){_0x2d8f05['push']...
```

**방법 2: Bytenode 컴파일 (더 강력)**

| 항목 | 내용 |
|------|------|
| 효과 | ⭐⭐⭐⭐ (바이너리로 변환) |
| 난이도 | 중간 (3~4시간) |
| 도구 | bytenode |

```
원본 .js 파일
    ↓
V8 바이트코드로 컴파일 (.jsc)
    ↓
사람이 읽을 수 없는 바이너리
```

#### 보안 수준 비교

| 방법 | 일반인 | 개발자 | 전문 해커 |
|------|--------|--------|----------|
| 현재 (평문) | ❌ | ✅ 분석 가능 | ✅ |
| 난독화 적용 | ❌ | ⚠️ 어려움 | ✅ 가능 |
| Bytenode | ❌ | ❌ | ⚠️ 매우 어려움 |

#### ⚠️ 적용 시 주의사항

| 위험 요소 | 설명 |
|----------|------|
| 전역 함수 참조 오류 | `window.License`, `window.SalaryCalculator` 등 이름이 바뀌면 호출 실패 |
| HTML 인라인 이벤트 | `onclick="backupToJSON()"` 같은 코드가 작동 안 함 |
| 파일 간 연결 | 여러 JS 파일이 서로 함수를 호출하는데, 이름이 바뀌면 연결 끊김 |
| 디버깅 어려움 | 오류 발생 시 원인 찾기 매우 어려움 |

**→ 현재 시스템은 전역 함수/변수가 많이 연결되어 있어 신중한 적용 필요**

#### 권장 사항

```
현재: 적용 안 함 (현재 보안 수준으로 충분)
    ↓
사업 확장 시 (고객 100곳 이상)
    ↓
충분한 테스트 후 난독화 먼저 적용
    ↓
필요 시 Bytenode 추가 검토
```

#### 진행 상태

| 단계 | 상태 |
|------|------|
| 소스 코드 난독화 | ⏳ 선택사항 (나중에 필요 시) |

---

## 📝 근로계약서 기능 개선 (v1.0.20 ~ v1.0.21)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 4일 |
| 목적 | 근로계약서 미리보기/인쇄 기능 확장 |
| 적용 버전 | v1.0.20 → v1.0.21 |

### 구현 기능

#### 1단계: 미리보기 편집 기능 + 브라우저 인쇄 ✅

| 기능 | 설명 |
|------|------|
| 주근무장소 편집 | 미리보기에서 contenteditable로 직접 수정 |
| 근무일/휴일 편집 | 미리보기에서 contenteditable로 직접 수정 |
| 가족수당 편집 | 미리보기에서 contenteditable로 직접 수정 |
| 브라우저 인쇄 | Electron IPC → 시스템 브라우저로 인쇄 |
| 임시 파일 관리 | 앱 종료 시 임시 HTML 파일 자동 삭제 |

**수정 파일:**
- `main.js` - IPC 핸들러 (open-in-browser)
- `preload.js` - openInBrowser API 노출
- `근로계약서_인사.js` - 편집 필드 및 인쇄 로직

#### 2단계: 추가 수당 기능 ✅

| 기능 | 설명 |
|------|------|
| [+ 수당 추가] 버튼 | 기본 수당 외 추가 수당 등록 |
| [×] 삭제 버튼 | 추가된 수당 삭제 |
| 수당명/금액 편집 | contenteditable로 직접 입력 |
| 인쇄 시 버튼 숨김 | @media print로 버튼 숨김 처리 |

**수정 파일:**
- `근로계약서_인사.js` - _customAllowances 상태 관리
- `근로계약서_스타일.css` - 버튼 스타일

#### 3단계: 추가 조항 기능 ✅

| 기능 | 설명 |
|------|------|
| [+ 조항 추가] 버튼 | 12. 기타 조항에 추가 조항 등록 |
| [×] 삭제 버튼 | 추가된 조항 삭제 |
| 조항 내용 편집 | contenteditable로 직접 입력 |
| 인쇄 시 버튼 숨김 | @media print로 버튼 숨김 처리 |

**수정 파일:**
- `근로계약서_인사.js` - _customClauses 상태 관리
- `근로계약서_스타일.css` - 버튼 스타일

#### 인쇄 스타일 수정 ✅

| 수정 항목 | 내용 |
|----------|------|
| 사회보험 목록 | padding-left: 15px 추가 |
| 근로계약일 | text-align: center, margin-bottom: 20px |
| 서명 영역 | table 레이아웃으로 좌우 배치 |
| 편집 필드 밑줄 | 인쇄 시 border-bottom: none |

### 파일 버전

| 파일 | 버전 | 위치 |
|------|------|------|
| 근로계약서_인사.js | v5.3.0 | js/hr/ |
| 근로계약서_스타일.css | v2.2 | css/ |
| main.js | v3.2.1 | / |
| preload.js | v2.1.0 | / |

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.20 | 2026-02-04 | 근로계약서 추가 수당/조항 기능 |
| v1.0.21 | 2026-02-04 | 인쇄 시 근로계약일 가운데 정렬 및 간격 수정 |

---

## 📊 보고서 브라우저 인쇄 전환 (v1.0.23)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 4일 |
| 목적 | Electron IPC 인쇄 → 시스템 브라우저 인쇄 전환 |
| 적용 버전 | v1.0.23 |
| 수정 파일 | 9개 (js/reports/ 폴더) |

### 배경

기존 Electron 환경의 `인쇄유틸_인사.js`를 통한 인쇄 방식에서 문제 발생:
- 일부 데이터 누락
- 스타일 미적용
- rowspan/colspan 처리 오류

**해결 방안:** 시스템 브라우저(Chrome 등)에서 HTML 파일 열어 인쇄

### 수정 파일 목록

| 파일 | 주요 수정 내용 |
|------|---------------|
| 조직도_인사.js | 브라우저 인쇄 전환 |
| 연명부_인사.js | 브라우저 인쇄 전환 |
| 근속현황표_인사.js | 브라우저 인쇄 전환 |
| 입사자목록_인사.js | 브라우저 인쇄 전환 |
| 퇴사자목록_인사.js | 브라우저 인쇄 전환 |
| 호봉획정표_인사.js | 브라우저 인쇄 전환 |
| 인사카드_인사.js | 브라우저 인쇄 + 사진 Base64 변환 + 직무대리 표시 수정 |
| 포상현황_인사.js | 브라우저 인쇄 + 선정여부 색상 적용 |
| 통계분석_인사.js | 브라우저 인쇄 + 엑셀 다운로드 rowspan 문제 해결 |

### 주요 버그 수정

#### 1. 인사카드 - 사진 미표시 문제 ✅

| 문제 | 원인 | 해결 |
|------|------|------|
| 브라우저 인쇄 시 사진 안 보임 | Blob URL은 다른 창에서 접근 불가 | Base64 data URL로 변환 |

```javascript
// 해결: Blob URL → Base64 변환
async function _convertBlobToBase64(blobUrl) {
    const response = await fetch(blobUrl);
    const blob = await response.blob();
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
    });
}
```

#### 2. 인사카드 - 직무대리 부서장 표시 문제 ✅

| 문제 | 원인 | 해결 |
|------|------|------|
| 직무대리가 부서장으로 표시 안 됨 | 필드명 불일치 (`position` vs `targetPosition`) | `targetPosition`으로 통일 |
| 같은 부서 직무대리 인식 안 됨 | `_displayAsConcurrent` 속성 누락 | 기존 직원에도 속성 추가 |

#### 3. 포상현황 - 선정여부 색상 미적용 ✅

| 문제 | 원인 | 해결 |
|------|------|------|
| 인쇄 시 모두 검정색 | 인쇄용 HTML에 색상 클래스 스타일 누락 | CSS 클래스 스타일 추가 + `print-color-adjust: exact` |

```css
.status-selected { color: #111 !important; font-weight: 600; }
.status-pending { color: #2563eb !important; font-weight: 600; }
.status-not-selected { color: #9ca3af !important; }
```

#### 4. 통계분석 - 인쇄/엑셀 데이터 누락 ✅ (가장 복잡했던 문제)

| 문제 | 원인 | 해결 |
|------|------|------|
| 2차원 교차분석 시 데이터 밀림 | rowspan 셀이 `outerHTML`로 직렬화될 때 위치 오류 | 테이블을 2차원 배열로 파싱 후 새 HTML 생성 |
| 엑셀 다운로드 시 데이터 누락 | 동일 원인 | `aoa_to_sheet()`로 2차원 배열 직접 변환 |

**증상:**
```
미리보기 (정상):
| 사회복지과 (rowspan=3) | 시설장 | 1명 | 남1/여0 |
|                        | 부장   | 2명 | 남1/여1 |

인쇄 (문제):
| 사회복지과 | 시설장 | 1명 | 남1/여0 |
| 부장       | 2명    | 남1/여1 | (빈칸) |  ← 셀이 밀림!
```

**해결 함수:**
```javascript
// 테이블을 2차원 그리드로 파싱 (rowspan 해결)
function _extractTableData(table, showRemarks) {
    // rowspan 추적하며 모든 셀 위치 정확히 파악
    // 새 HTML 테이블 생성 (rowspan 없이)
}

// 엑셀용 2차원 배열 추출
function _extractTableDataAsArray(table, showRemarks) {
    // XLSX.utils.aoa_to_sheet()로 직접 변환
}
```

### 브라우저 인쇄 공통 패턴

모든 보고서 파일에 적용된 패턴:

```javascript
// HTML 문서 생성
const htmlContent = `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <style>
            @page { size: A4 ${orientation}; margin: 10mm; }
            /* 인쇄 스타일 */
        </style>
    </head>
    <body>
        <button class="no-print" onclick="window.print()">🖨️ 인쇄하기</button>
        ${content}
    </body>
    </html>
`;

// Electron → 시스템 브라우저로 열기
if (window.electronAPI && window.electronAPI.openInBrowser) {
    window.electronAPI.openInBrowser(htmlContent, 'report_print.html');
}
```

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.22 | - | 폐기 (버전 오류) |
| v1.0.23 | 2026-02-04 | 보고서 브라우저 인쇄 전환 (9개 파일), 인사카드/포상현황/통계분석 버그 수정 |
| v1.0.24 | 2026-02-05 | 호봉획정표 인쇄 버튼 중복 및 양식 미적용 수정 |
| v1.0.25 | 2026-02-05 | 연명부/입사자/퇴사자 목록 인쇄 헤더 안 보임 수정 |
| v1.0.26 | 2026-02-05 | localStorage → electron-store 자동 동기화 (시간외 앱 급여 데이터 연동) |
| v1.0.27 | 2026-02-05 | 라이선스 정보 electron-store 동기화 (시간외 앱 라이선스 검증 지원) |
| v1.0.28 | 2026-02-05 | Private 저장소 자동 업데이트 토큰 추가 (GitHub PAT) |

---

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | 호봉획정표 인쇄 시 버튼 중복 및 양식 미적용 문제 해결 |
| 적용 버전 | v1.0.24 |
| 수정 파일 | 1개 (js/reports/호봉획정표_인사.js) |

### 문제 현상

| 문제 | 증상 | 원인 |
|------|------|------|
| 버튼 중복 | 인쇄 브라우저에 버튼 2개 표시, 위쪽 버튼 클릭 불가 | `certificate-print-area`에 이미 `cert-btn-area`가 포함된 상태에서 `printCertificate()`가 또 버튼 추가 |
| 양식 미적용 | 공문서/모던/표준 양식이 인쇄에서 기본 스타일로 표시 | 인쇄용 HTML에 양식별 CSS 스타일 미포함 |

### 해결 방법

#### 1. 버튼 중복 제거 ✅

```javascript
// cert-btn-area 영역 제거하여 버튼 중복 방지
const tempDiv = document.createElement('div');
tempDiv.innerHTML = printArea.innerHTML;
const btnArea = tempDiv.querySelector('.cert-btn-area');
if (btnArea) btnArea.remove();
const cleanContent = tempDiv.innerHTML;
```

#### 2. 양식별 CSS 포함 ✅

- 공문서(`cert-style-official`) CSS 전체 포함
- 모던(`cert-style-modern`) CSS 전체 포함  
- 표준(`cert-style-standard`) CSS 전체 포함
- `-webkit-print-color-adjust: exact` 적용으로 배경색 인쇄 보장

```javascript
// 현재 선택된 양식 타입 확인
const styleType = printArea.classList.contains('cert-style-official') ? 'official' 
                : printArea.classList.contains('cert-style-modern') ? 'modern' 
                : 'standard';

// 양식별 CSS를 인쇄 HTML에 포함
const htmlContent = `
    <!DOCTYPE html>
    <html>
    <head>
        <style>
            ${styleCSS}  // 양식별 CSS 전체 포함
        </style>
    </head>
    <body>
        <div class="cert-container cert-style-${styleType}">
            ${cleanContent}
        </div>
    </body>
    </html>
`;
```

### 파일 버전

| 파일 | 버전 | 위치 |
|------|------|------|
| 호봉획정표_인사.js | v6.0.1 | js/reports/ |

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.24 | 2026-02-05 | 호봉획정표 인쇄 버튼 중복 및 양식 미적용 수정 |
| v1.0.25 | 2026-02-05 | 연명부/입사자/퇴사자 목록 인쇄 헤더 안 보임 수정 |

---

## 🖨️ 연명부/입사자/퇴사자 목록 인쇄 헤더 버그 수정 (v1.0.25)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | 인쇄 시 헤더(출력항목) 텍스트가 안 보이는 문제 해결 |
| 적용 버전 | v1.0.25 |
| 수정 파일 | 3개 (js/reports/) |

### 문제 현상

| 구분 | 미리보기 | 인쇄 브라우저 |
|------|---------|-------------|
| 헤더 배경 | 그라데이션 (보라/초록/빨강) | `#f8f9fa` (연한 회색) |
| 헤더 글자 | `color:white` | `color:white` (그대로!) |
| **결과** | ✅ 흰글씨 + 진한배경 = 잘 보임 | ❌ 흰글씨 + 연한배경 = 안 보임 |

**원인:**
- 미리보기에서 헤더 행에 `style="...;color:white;"` 인라인 스타일 적용
- 인쇄 CSS에서 배경만 `#f8f9fa`로 변경하고 글자색은 지정 안 함
- 인라인 `color:white`가 유지되어 연한 배경에 흰색 글자 = 안 보임

### 해결 방법

#### 1. 헤더 행 인라인 스타일 초기화 ✅

```javascript
// ⭐ 헤더 행의 인라인 스타일 초기화 (color:white 제거)
const headerRow = tableClone.querySelector('thead tr');
if (headerRow) {
    headerRow.style.background = '';
    headerRow.style.color = '';
}
```

#### 2. 인쇄 CSS에 th color 추가 ✅

```css
th { background: #f8f9fa !important; color: #333 !important; font-weight: 600; ... }
```

### 수정 파일 목록

| 파일 | 버전 | 헤더 그라데이션 색상 |
|------|------|-------------------|
| 연명부_인사.js | v6.1.1 | 보라색 (#667eea → #764ba2) |
| 입사자목록_인사.js | v6.0.1 | 초록색 (#10b981 → #059669) |
| 퇴사자목록_인사.js | v6.0.1 | 빨간색 (#ef4444 → #dc2626) |

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.25 | 2026-02-05 | 연명부/입사자/퇴사자 목록 인쇄 헤더 안 보임 수정 |
| v1.0.26 | 2026-02-05 | localStorage → electron-store 자동 동기화 (시간외 앱 급여 데이터 연동) |
| v1.0.27 | 2026-02-05 | 라이선스 정보 electron-store 동기화 (시간외 앱 라이선스 검증 지원) |
| v1.0.28 | 2026-02-05 | Private 저장소 자동 업데이트 토큰 추가 (GitHub PAT) |
| v1.0.29 | 2026-02-05 | 불필요한 GH_TOKEN 제거 (Public 저장소이므로 토큰 불필요) |

---

## 🔄 localStorage → electron-store 자동 동기화 (v1.0.26)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | 시간외근무 앱 등 외부 Electron 앱이 HR 앱의 급여 데이터를 읽을 수 있도록 동기화 |
| 적용 버전 | v1.0.26 |
| 수정 파일 | 초기화_인사.js (v3.2.1) |

### 배경 및 원인

시간외근무 데스크탑 앱에서 월별 집계/상세보고서의 수당 금액이 모두 0원으로 표시되는 문제 발생.

```
HR 앱의 데이터 저장 현황:
├── electron-store (hr-system-data.json)
│   ├── hr_system_v25_db  ✅ (직원 데이터 — 데이터베이스_인사.js에서 동기화)
│   └── savedLogin        ✅ (로그인 정보)
│   └── hr_salary_tables  ❌ 없음!
│   └── hr_position_allowances ❌ 없음!
│
└── localStorage (렌더러 내부)
    ├── hr_salary_tables         ✅ 있음
    ├── hr_position_allowances   ✅ 있음
    ├── hr_salary_grades         ✅ 있음
    ├── hr_salary_settings       ✅ 있음
    ├── hr_ordinary_wage_settings ✅ 있음
    └── ...
```

**문제 구조:**
- HR 앱의 `급여설정_인사.js`는 급여 데이터를 `localStorage`에만 저장
- `데이터베이스_인사.js`는 직원 데이터(`hr_system_v25_db`)만 electron-store에 동기화
- 시간외 앱은 `hrStore` API로 HR 앱의 electron-store **파일**만 읽을 수 있음
- 두 앱은 별도 Electron 프로세스이므로 상대방의 localStorage 접근 불가
- **결과**: 시간외 앱이 급여표, 직책수당 등을 읽을 수 없어 수당 0원 표시

### 해결 방법

`초기화_인사.js`에 `_syncSettingsToElectronStore()` 함수 추가:

1. **앱 시작 시 일괄 동기화**: localStorage → electron-store로 설정 데이터 복사
2. **실시간 자동 동기화**: `localStorage.setItem` 패치하여 변경 시 electron-store에도 자동 저장
3. **삭제 동기화**: `localStorage.removeItem` 패치하여 삭제 시 electron-store에서도 제거

```javascript
// 동기화 대상 키 (11개)
const SYNC_KEYS = [
    'hr_salary_grades',            // 직급 관리
    'hr_salary_tables',            // 급여표
    'hr_position_allowances',      // 직책수당
    'hr_salary_settings',          // 급여 설정
    'hr_ordinary_wage_settings',   // 통상임금 설정
    'hr_salary_basic_settings',    // 급여 기본 설정
    'hr_concurrent_positions',     // 겸직/직무대리
    'hr_org_chart_settings',       // 조직도 설정
    'hr_overtime_settings',        // 시간외근무 유형 설정
    'hr_overtime_records',         // 시간외근무 기록
    'hr_awards_data'               // 포상 데이터
];
```

### 기존 HR 앱 영향

| 항목 | 영향 |
|------|------|
| 기존 동작 | ❌ 변경 없음 — localStorage 읽기/쓰기 그대로 유지 |
| 브라우저 환경 | ❌ 영향 없음 — `window.electronStore === undefined`이면 전체 스킵 |
| 동기화 실패 시 | ❌ 영향 없음 — try-catch로 무시, 기존 동작 정상 수행 |
| 성능 | 무시 가능 — 앱 시작 시 1회 + 설정 저장 시 비동기 복사 |

### 수정 파일

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| 초기화_인사.js | v3.2.1 | js/ | `_syncSettingsToElectronStore()` 함수 추가, DOMContentLoaded에서 호출 |

### 동기화 후 데이터 구조

```
HR 앱의 electron-store (hr-system-data.json) — 동기화 후:
├── hr_system_v25_db           ✅ (기존 — 데이터베이스_인사.js)
├── savedLogin                 ✅ (기존)
├── hr_salary_grades           ✅ ← NEW (동기화)
├── hr_salary_tables           ✅ ← NEW (동기화)
├── hr_position_allowances     ✅ ← NEW (동기화)
├── hr_salary_settings         ✅ ← NEW (동기화)
├── hr_ordinary_wage_settings  ✅ ← NEW (동기화)
├── hr_salary_basic_settings   ✅ ← NEW (동기화)
├── hr_concurrent_positions    ✅ ← NEW (동기화)
├── hr_org_chart_settings      ✅ ← NEW (동기화)
├── hr_overtime_settings       ✅ ← NEW (동기화)
├── hr_overtime_records        ✅ ← NEW (동기화)
└── hr_awards_data             ✅ ← NEW (동기화)
```

시간외 앱이 `hrStore.get('hr_salary_tables')` 등으로 정상 접근 가능.

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.26 | 2026-02-05 | localStorage → electron-store 자동 동기화 (시간외 앱 급여 데이터 연동) |
| v1.0.27 | 2026-02-05 | 라이선스 정보 electron-store 동기화 (시간외 앱 라이선스 검증 지원) |
| v1.0.28 | 2026-02-05 | Private 저장소 자동 업데이트 토큰 추가 (GitHub PAT) |
| v1.0.29 | 2026-02-05 | 불필요한 GH_TOKEN 제거 (Public 저장소이므로 토큰 불필요) |
| v1.0.30 | 2026-02-06 | 신규 직원 등록 호봉획정표 경력 환산 내역 0 표시 수정 |
| v1.0.31 | 2026-02-06 | 보고서 호봉획정표 인정 경력 0 표시 수정 |
| v1.0.32 | 2026-02-06 | 날짜 입력 연도 4자리 제한 및 범위 설정 |
| v1.0.33 | 2026-02-06 | 호봉획정표 기존 백업 데이터 인정 경력 0 표시 수정 |

---

## 🔑 라이선스 정보 electron-store 동기화 (v1.0.27)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | 시간외근무 앱이 HR 앱의 라이선스 정보를 읽어 검증할 수 있도록 electron-store에 동기화 |
| 적용 버전 | v1.0.27 |
| 수정 파일 | license_인사.js (v1.4.0) |

### 배경

시간외근무 데스크탑 앱에 라이선스 검증 시스템(Phase 2)을 추가하면서, HR 앱의 라이선스 정보를 시간외 앱에서 읽을 수 있어야 했음. 기존에 라이선스 정보는 localStorage에만 저장되어 다른 Electron 앱에서 접근 불가.

### 해결 방법

`license_인사.js`에 electron-store 동기화 로직 추가:

1. **마이그레이션**: 기존 localStorage의 라이선스 정보(`hr_license_info`)를 electron-store로 복사
2. **실시간 동기화**: 라이선스 정보 저장/갱신 시 electron-store에도 자동 반영
3. **시간외 앱 연동**: 시간외 앱의 `preload.js`에서 `hrStore.checkLicense()`로 읽기

```
라이선스 데이터 흐름:
┌─────────────────────────┐     ┌─────────────────────────┐
│  HR 앱 (license_인사.js) │     │  시간외 앱 (초기화)      │
│                         │     │                         │
│  Supabase 검증          │     │  hrStore.checkLicense() │
│       ↓                 │     │       ↓                 │
│  localStorage 저장      │     │  hr-system-data.json    │
│       ↓                 │     │  (hr_license_info 읽기) │
│  electron-store 동기화  │────→│       ↓                 │
│  (hr_license_info)      │     │  검증 결과 반환          │
└─────────────────────────┘     └─────────────────────────┘
```

### 수정 파일

| 파일 | 버전 | 경로 | 변경 내용 |
|------|------|------|----------|
| license_인사.js | v1.4.0 | js/license/ | electron-store 동기화 및 마이그레이션 로직 추가 |

### 확인 로그

```
[License] license_인사.js 로드됨 (v1.4.0)
[License] 기존 라이선스 → electron-store 마이그레이션 완료
[License] electron-store 동기화 완료
```

---

## 🔐 Private 저장소 자동 업데이트 토큰 추가 (v1.0.28)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | GitHub 저장소를 Private으로 전환해도 자동 업데이트가 동작하도록 인증 토큰 추가 |
| 적용 버전 | v1.0.28 |
| 수정 파일 | main.js |

### 배경

코드 보호를 위해 GitHub 저장소를 Private으로 전환하는 것을 검토함. Private 저장소에서는 electron-updater가 GitHub Release에 접근할 때 인증이 필요하여 404 에러가 발생함.

```
[문제 상황]
Public 저장소:  electron-updater → releases.atom → ✅ 접근 가능
Private 저장소: electron-updater → releases.atom → ❌ 404 에러 (인증 필요)
```

### 해결 방법

`main.js`의 autoUpdater 설정에 GitHub Personal Access Token 추가:

```javascript
// autoUpdater 설정
const { autoUpdater } = require('electron-updater');
autoUpdater.logger = require('electron-log');
autoUpdater.logger.transports.file.level = 'info';

// ★ Private 저장소 인증 토큰
process.env.GH_TOKEN = 'ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx';

autoUpdater.autoDownload = false;
autoUpdater.autoInstallOnAppQuit = true;
```

### GitHub 저장소 현재 상태

| 저장소 | URL | 상태 | 자동 업데이트 |
|--------|-----|------|-------------|
| HR 앱 | https://github.com/mangfeel/hr-system | **Public** | ✅ 토큰 없이 동작 (v1.0.29에서 토큰 제거) |
| 시간외 앱 | https://github.com/mangfeel/overtime-system | **Public** | ✅ 토큰 없이 동작 (v1.1.8에서 토큰 제거) |

### 수정 파일

| 파일 | 경로 | 변경 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | autoUpdater 영역에 `process.env.GH_TOKEN` 추가 |

### ⚠️ 중요 참고사항

- HR 앱 저장소는 현재 **Public** 상태 → 랜딩페이지에서 직접 다운로드 가능
- ~~토큰은 추가되어 있으므로 향후 Private 전환 시 자동 업데이트 즉시 동작~~ → **v1.0.29에서 토큰 제거됨** (아래 참고)
- 시간외 앱도 Private → **Public으로 전환** 완료 (v1.1.8)
- 결론: 양쪽 앱 모두 Public 저장소로 운영하며, 토큰 관리 부담 제거

---

## 🧹 불필요한 GH_TOKEN 제거 (v1.0.29)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 5일 |
| 목적 | Public 저장소에서 불필요한 GitHub PAT 토큰 제거 (토큰 만료 시 문제 방지) |
| 적용 버전 | v1.0.29 |
| 수정 파일 | main.js |

### 배경

v1.0.28에서 Private 저장소 전환을 대비해 `process.env.GH_TOKEN`을 추가했으나, 시간외 앱의 자동 업데이트 삽질 과정에서 다음 교훈을 얻음:

1. **토큰 만료 문제**: GitHub PAT는 만료될 수 있고, 만료 시 자동 업데이트가 401 에러로 실패
2. **닭과 달걀 문제**: 토큰이 만료된 구 버전이 설치되어 있으면, 새 토큰이 담긴 신 버전을 자동으로 받을 수 없음
3. **인코딩 위험**: PowerShell로 토큰을 교체할 때 UTF-8 인코딩이 깨질 수 있음
4. **Public이면 불필요**: 두 앱 모두 Public 저장소이므로 토큰 자체가 필요 없음

### 해결 방법

`main.js`에서 `process.env.GH_TOKEN` 2줄 제거:

```javascript
// 삭제된 코드:
// process.env.GH_TOKEN = 'ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx';
```

### 수정 파일

| 파일 | 경로 | 변경 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | `process.env.GH_TOKEN` 설정 2줄 제거 |

### 시간외 앱 연동 경과

시간외 앱에서도 동일한 토큰 문제를 겪으며 해결한 과정:

| 버전 | 시도 | 결과 |
|------|------|------|
| v1.1.1 | `process.env.GH_TOKEN` 추가 | ❌ 404 (Atom 피드 인증 미지원) |
| v1.1.2 | requestHeaders 방식 | ❌ 404 |
| v1.1.3 | requestHeaders 개선 | ❌ 404 |
| v1.1.4 | setFeedURL + token | ❌ 401 (토큰 만료) |
| v1.1.5~1.1.7 | 토큰 갱신 시도 | ❌ 인코딩 깨짐 |
| **v1.1.8** | **Private → Public 전환** | **✅ 성공** |

**최종 결론**: Public 저장소 + 토큰 없음 = 가장 안정적

---

## 📋 향후 과제 — GitHub 저장소 Private 전환

### 개요

| 항목 | 내용 |
|------|------|
| 목적 | 소스 코드 보호를 위해 HR 앱 GitHub 저장소를 Public → Private 전환 |
| 선행 조건 | 토큰 방식의 안정성 확보 또는 대안 마련 |
| 우선순위 | ⚠️ **재검토 필요** — 시간외 앱 삽질 경험으로 토큰 방식의 한계 확인됨 |

### 현재 상황 (v15.2 기준)

```
HR 앱 저장소 (Public):
├── 누구나 https://github.com/mangfeel/hr-system 에서 소스 코드 열람 가능
├── 랜딩페이지에서 GitHub Release 직접 다운로드 가능
├── 자동 업데이트 정상 동작 (토큰 없이)
└── v1.0.29: GH_TOKEN 제거됨

시간외 앱 저장소 (Public):
├── 누구나 https://github.com/mangfeel/overtime-system 에서 소스 코드 열람 가능
├── 자동 업데이트 정상 동작 (토큰 없이)
└── v1.1.8: Private → Public 전환, setFeedURL/토큰 제거됨
```

### ⚠️ Private 전환 시 발생하는 문제 (시간외 앱 경험 기반)

| 문제 | 설명 |
|------|------|
| 토큰 만료 | GitHub PAT 만료 시 자동 업데이트 401 에러 |
| 닭과 달걀 | 구 버전(만료된 토큰) → 신 버전(새 토큰) 자동 업데이트 불가 |
| 인코딩 위험 | PowerShell로 토큰 교체 시 UTF-8 인코딩 깨짐 가능 |
| 빌드 캐시 | 인코딩 깨진 파일이 캐시에 남아 정상 빌드 방해 |
| 수동 설치 필요 | 토큰 문제 발생 시 모든 사용자에게 수동 설치 요구 |

### Private 전환 시 영향 및 대응

| 영향 | 대응 방안 |
|------|----------|
| 랜딩페이지 다운로드 불가 | exe 파일 호스팅 별도 구축 필요 (Supabase Storage 유료 플랜 등) |
| 토큰 만료 시 자동 업데이트 불가 | No expiration 토큰 사용 또는 토큰 갱신 자동화 |
| 신규 사용자 최초 설치 | 별도 배포 방식 필요 (직접 전달 또는 파일 호스팅) |

### 전환 절차 (상용화 시점)

```
1단계: 사전 확인
   └── 모든 사용자가 v1.0.28 이상인지 확인

2단계: 파일 호스팅 구축
   ├── Supabase Storage 유료 플랜 (50MB → 무제한) 또는
   ├── Cloudflare R2 (무료 10GB) 또는
   └── 자체 서버 호스팅
   
3단계: 랜딩페이지 수정
   └── 다운로드 URL을 GitHub Release → 파일 호스팅 URL로 변경

4단계: 저장소 전환
   └── https://github.com/mangfeel/hr-system/settings
       → Danger Zone → Change visibility → Private

5단계: 검증
   ├── 설치된 앱 자동 업데이트 동작 확인
   └── 랜딩페이지 다운로드 정상 동작 확인
```

### 비용 비교 (파일 호스팅 옵션)

| 서비스 | 무료 용량 | exe 호스팅 | 비용 |
|--------|----------|-----------|------|
| Supabase Storage | 1GB (50MB/파일) | ❌ 불가 (exe 76MB) | Pro $25/월 → 무제한 |
| Cloudflare R2 | 10GB | ✅ 가능 | 무료 (10GB 이내) |
| AWS S3 | 5GB (12개월) | ✅ 가능 | ~$0.02/GB/월 |
| GitHub Release (Public) | 무제한 | ✅ 현재 사용 중 | 무료 |

### 권장 시점

- **현재**: Public 유지 (비용 없음, 랜딩페이지 동작, 토큰 관리 부담 없음)
- **상용화 시**: Private 전환 + Cloudflare R2 또는 Supabase Pro로 파일 호스팅
- **참고**: Electron asar 패키징 + F12 비활성화로 이미 기본적 코드 보호 적용 중

---

## 🔄 버전 이력 (로드맵)

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v15.0 | 2026-02-05 | 10단계 전체 완료, v1.0.24 릴리즈 |
| v15.1 | 2026-02-05 | v1.0.25~v1.0.28 릴리즈 이력 추가, 인쇄 헤더/동기화/라이선스/토큰 기록 |
| v15.2 | 2026-02-05 | v1.0.29 GH_TOKEN 제거 반영, 시간외 앱 Public 전환 반영, 향후 과제 재검토 |
| v15.3 | 2026-02-06 | v1.0.30~v1.0.33 릴리즈 이력 추가, 호봉획정표 버그 수정, 날짜 입력 개선, 기존 백업 호환성 |

---

## 📋 호봉획정표 경력 데이터 버그 수정 (v1.0.30 ~ v1.0.33)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 6일 |
| 목적 | 호봉획정표에서 경력 관련 데이터가 0으로 표시되는 버그 수정 |
| 적용 버전 | v1.0.30, v1.0.31, v1.0.33 |
| 수정 파일 | 호봉획정표_인사.js (js/reports/) |

### 문제 현상

#### v1.0.30 - 신규 직원 등록 시 경력 환산 내역 0 표시

| 구분 | 저장 형식 | 읽는 형식 | 결과 |
|------|----------|----------|------|
| 원본 기간 | `originalPeriod: { years, months, days }` | `period: "3년 2개월 15일"` | ❌ 0 표시 |
| 환산 기간 | `convertedPeriod: { years, months, days }` | `converted: "3년 2개월 15일"` | ❌ 0 표시 |

**원인:** 직원등록에서 객체 형식으로 저장, 호봉획정표에서 문자열 형식 기대

#### v1.0.31 - 보고서 호봉획정표 인정 경력 0 표시

| 저장 위치 | 읽는 위치 | 결과 |
|----------|----------|------|
| `emp.career.totalYears` | `emp.rank?.careerYears` | ❌ 0 표시 |

**원인:** 필드명 불일치 (career vs rank)

### 해결 방법

#### v1.0.30 - prepareCareerTableData 함수 수정

```javascript
// 객체 형식과 문자열 형식 모두 지원
if (career.originalPeriod && typeof career.originalPeriod === 'object') {
    // 객체 형식: { years: 3, months: 2, days: 15 }
    py = String(career.originalPeriod.years || 0);
    pm = String(career.originalPeriod.months || 0);
    pd = String(career.originalPeriod.days || 0);
} else if (career.period) {
    // 문자열 형식: "3년 2개월 15일"
    const periodParts = career.period.match(/(\d+)년\s*(\d+)개월\s*(\d+)일/);
    // ...
}
```

#### v1.0.31 - printHobongCertificate 함수 수정

```javascript
// career.totalYears 우선, rank.careerYears 폴백
years: emp.career?.totalYears ?? emp.rank?.careerYears ?? 0,
months: emp.career?.totalMonths ?? emp.rank?.careerMonths ?? 0,
days: emp.career?.totalDays ?? emp.rank?.careerDays ?? 0,
```

#### v1.0.33 - 기존 백업 데이터 호환성 수정

**문제:** 기존 백업 데이터는 `career.totalYears: 0`, `rank.careerYears: 7` 구조
- `??` 연산자는 `null`/`undefined`만 폴백
- `0`은 유효한 값으로 인식되어 폴백 안 됨

```javascript
// 수정 전 (v1.0.31) - ?? 연산자
years: emp.career?.totalYears ?? emp.rank?.careerYears ?? 0,  // 0 반환 (문제!)

// 수정 후 (v1.0.33) - || 연산자
years: emp.career?.totalYears || emp.rank?.careerYears || 0,  // 7 반환 (정상)
```

### 파일 버전

| 파일 | 버전 | 위치 |
|------|------|------|
| 호봉획정표_인사.js | v6.0.3 | js/reports/ |

---

## 📅 날짜 입력 연도 4자리 제한 (v1.0.32)

### 개요

| 항목 | 내용 |
|------|------|
| 작업일 | 2026년 2월 6일 |
| 목적 | 날짜 입력 시 연도 5자리 이상 입력 방지, 범위 제한 |
| 적용 버전 | v1.0.32 |
| 수정 파일 | 초기화_인사.js (js/) |

### 문제 현상

| 필드 | 현재 동작 | 원하는 동작 |
|------|----------|------------|
| 연도 (4자리) | 만단위 이상 입력 가능 | 4자리 제한 (1900~2099) |

### 해결 방법

#### 1. min/max 속성 자동 설정

```javascript
input.max = '2099-12-31';  // 연도 최대 2099
input.min = '1900-01-01';  // 연도 최소 1900
```

#### 2. 연도 5자리 이상 입력 시 자동 보정

```javascript
if (yearMatch[1].length > 4) {
    const correctedYear = yearMatch[1].substring(0, 4);
    input.value = correctedYear + rest;
}
```

#### 3. Event Delegation으로 동적 요소 자동 적용

```javascript
document.addEventListener('focusin', function(e) {
    if (e.target && e.target.type === 'date' && !e.target.dataset.dateEnhanced) {
        _applyDateInputEnhancements(e.target);
    }
});
```

### 적용 범위

- 입사일 (entryDate)
- 과거경력 시작일/종료일 (careerStartDate, careerEndDate)
- 동적으로 추가되는 모든 date input

### 파일 버전

| 파일 | 버전 | 위치 |
|------|------|------|
| 초기화_인사.js | v3.3.0 | js/ |

### 릴리즈 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.30 | 2026-02-06 | 신규 직원 등록 호봉획정표 경력 환산 내역 0 표시 수정 |
| v1.0.31 | 2026-02-06 | 보고서 호봉획정표 인정 경력 0 표시 수정 |
| v1.0.32 | 2026-02-06 | 날짜 입력 연도 4자리 제한 및 범위 설정 |
| v1.0.33 | 2026-02-06 | 호봉획정표 기존 백업 데이터 인정 경력 0 표시 수정 |

---

**향후 계획 끝**
