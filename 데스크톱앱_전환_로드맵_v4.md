# 인사관리시스템 데스크톱 앱 전환 로드맵

## 📋 문서 정보
- **작성일**: 2026년 1월 23일
- **최종 수정일**: 2026년 1월 23일
- **버전**: v4.0
- **목표**: 웹앱 → Electron 데스크톱 앱 전환
- **예상 총 기간**: 17~23시간 (10단계 추가)
- **현재 진행 상태**: ✅ **7단계 완료** - 8단계 진행 예정

---

## 📖 배경 및 목적

### 1. 현재 상태 (웹앱)

```
[브라우저]
    │
    ├── F12로 소스 코드 보임 ⚠️
    ├── 핵심 로직 → 서버 API (보호됨 ✅)
    ├── UI/API 호출 코드 → 노출됨 ⚠️
    └── 데이터 → localStorage
```

**문제점**:
- F12 개발자 도구로 클라이언트 코드 노출
- UI 구조, API 호출 패턴 등 분석 가능

### 2. 목표 상태 (데스크톱 앱)

```
[Windows 앱 - Electron]
    │
    ├── F12 소스 노출 방지 ✅
    ├── 핵심 로직 → 서버 API (유지) ✅
    ├── 데이터 → 로컬 파일 (암호화) ✅
    └── 라이선스 키 시스템 ✅
```

**달성 목표**:
| 목표 | 설명 |
|------|------|
| 코드 보호 | F12로 소스 노출 방지 |
| 라이선스 관리 | 사용 기간 제어 가능 |
| 구독 시스템 기반 | 향후 유료 전환 대비 |
| 자동 업데이트 | 새 버전 알림 및 설치 |

---

## 💻 개발 환경 및 폴더 구조

### 1. 로컬 PC 폴더 구조

#### C:\hr-system (클라이언트 - 메인 작업 폴더)

```
C:\hr-system\
│
├── index.html              # Vercel 진입점 (→ 소개 페이지로 변경 예정)
├── login.html              # 로그인/회원가입 페이지
├── 메인_인사.html          # 메인 애플리케이션
│
├── package.json            # ← NEW (Electron 설정)
├── main.js                 # ← NEW (Electron 메인 프로세스)
├── preload.js              # ← NEW (보안 브릿지)
│
├── css/
│   ├── 근로계약서_스타일.css
│   ├── 스타일_인사.css
│   ├── 인사카드_스타일.css
│   ├── 통계분석_스타일.css
│   ├── 포상관리_스타일.css
│   └── 호봉획정표_스타일.css
│
├── js/
│   ├── 초기화_인사.js
│   │
│   ├── auth/               # 인증 (Supabase 연동)
│   │   ├── auth_인사.js
│   │   └── supabase_인사.js
│   │
│   ├── career/             # 경력 관리
│   │   ├── 경력관리_인사.js
│   │   └── 경력편집_인사.js
│   │
│   ├── config/             # 설정/상수
│   │   └── 상수_인사.js
│   │
│   ├── core/               # 핵심 모듈
│   │   ├── API_인사.js         # 서버 API 호출
│   │   ├── 검증_인사.js
│   │   ├── 데이터베이스_인사.js  # ← 수정 예정 (localStorage → 파일)
│   │   └── 호봉계산기_인사.js
│   │
│   ├── employee/           # 직원 관리
│   │   ├── 직원등록_인사.js
│   │   ├── 직원목록_인사.js
│   │   ├── 직원상세_인사.js
│   │   └── 직원수정_인사.js
│   │
│   ├── hr/                 # 인사 업무
│   │   ├── 근로계약서_인사.js
│   │   ├── 단축근로_인사.js
│   │   ├── 육아휴직_인사.js
│   │   ├── 인사발령_인사.js
│   │   ├── 퇴사관리_인사.js
│   │   └── 포상등록_인사.js
│   │
│   ├── labor/              # 급여/근로
│   │   ├── 급여계산기_인사.js
│   │   ├── 급여설정_인사.js
│   │   ├── 급여현황_인사.js
│   │   └── 시간외근무_인사.js
│   │
│   ├── reports/            # 리포트/현황표
│   │   ├── 근속현황표_인사.js
│   │   ├── 연명부_인사.js
│   │   ├── 인사카드_인사.js
│   │   ├── 입사자목록_인사.js
│   │   ├── 조직도_인사.js
│   │   ├── 통계분석_인사.js
│   │   ├── 퇴사자목록_인사.js
│   │   ├── 포상현황_인사.js
│   │   └── 호봉획정표_인사.js
│   │
│   ├── system/             # 시스템 기능
│   │   ├── 검색_인사.js
│   │   ├── 겸직관리_인사.js
│   │   ├── 네비게이션_인사.js
│   │   ├── 백업_인사.js        # ← 수정 예정 (파일 저장 방식)
│   │   ├── 복원가져오기_인사.js  # ← 수정 예정
│   │   └── 조직도설정_인사.js
│   │
│   ├── utils/              # 유틸리티
│   │   ├── DOM유틸_인사.js
│   │   ├── 로거_인사.js
│   │   ├── 에러처리_인사.js
│   │   ├── 인쇄유틸_인사.js
│   │   └── 직원유틸_인사.js
│   │
│   └── license/            # ← NEW (라이선스 관련)
│       ├── license_인사.js     # 라이선스 검증 로직
│       └── storage_인사.js     # 로컬 데이터 저장 (electron-store)
│
├── assets/                 # ← NEW (앱 리소스)
│   ├── icon.ico
│   └── icon.png
│
├── build/                  # ← NEW (빌드 설정)
│   └── electron-builder.yml
│
└── dist/                   # ← NEW (빌드 결과물)
    ├── 인사관리시스템_Setup_x.x.x.exe
    └── latest.yml
```

#### C:\hr-system-server (서버 API - Edge Functions)

```
C:\hr-system-server\
│
├── .vscode/
│   ├── extensions.json
│   └── settings.json
│
└── supabase/
    ├── config.toml
    │
    ├── .temp/              # Supabase CLI 임시 파일
    │
    └── functions/          # Edge Functions (서버 API)
        │
        ├── calculate-batch/        # 배치 호봉 계산
        │   └── index.ts
        │
        ├── calculate-overtime/     # 시간외수당 계산
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-rank/         # 호봉 계산 (통합)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-rank-utils/   # 호봉 계산 (개별 함수)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── calculate-salary/       # 급여 계산
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── hello-world/            # 연결 테스트용
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── validate-employee/      # 직원 데이터 검증
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        ├── validate-license/       # ← NEW (라이선스 검증)
        │   ├── .npmrc
        │   ├── deno.json
        │   └── index.ts
        │
        └── generate-license/       # ← NEW (라이선스 생성)
            ├── .npmrc
            ├── deno.json
            └── index.ts
```

### 2. 관련 URL 및 서비스

| 항목 | URL/경로 | 설명 |
|------|----------|------|
| 웹앱 (현재) | https://hr-system-phi-bluish.vercel.app | Vercel 배포 |
| Supabase 프로젝트 | https://pulanyznvpsrlkpqotat.supabase.co | 백엔드/DB |
| Supabase 대시보드 | https://supabase.com/dashboard | 관리 콘솔 |
| GitHub 저장소 | https://github.com/mangfeel/hr-system | 소스 코드 |
| Vercel 대시보드 | https://vercel.com/dashboard | 배포 관리 |

---

## 🔧 작업 흐름 (중요!)

### 파일 수정/생성 작업 절차

```
[1] Claude가 파일 제공
    │
    ▼
[2] 사용자가 다운로드 (C:\Users\김화겸\Downloads\)
    │
    ▼
[3] PowerShell에서 파일 복사
    │
    ▼
[4] Git 커밋/푸시
    │
    ▼
[5] (서버 API인 경우) Supabase 배포
```

### PowerShell 명령어 템플릿

#### 클라이언트 파일 복사 (C:\hr-system)

```powershell
# 단일 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\[파일명]" "C:\hr-system\[경로]\[파일명]" -Force

# 예시: main.js 복사
Copy-Item "C:\Users\김화겸\Downloads\main.js" "C:\hr-system\main.js" -Force

# 예시: js/core 폴더에 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\API_인사.js" "C:\hr-system\js\core\API_인사.js" -Force

# 예시: 새 폴더 생성 후 파일 복사
New-Item -ItemType Directory -Path "C:\hr-system\js\license" -Force
Copy-Item "C:\Users\김화겸\Downloads\license_인사.js" "C:\hr-system\js\license\license_인사.js" -Force
```

#### Git 커밋/푸시 (C:\hr-system)

```powershell
# hr-system 폴더로 이동
cd C:\hr-system

# 변경사항 확인
git status

# 모든 변경사항 스테이징
git add .

# 커밋 (메시지는 작업 내용에 맞게 수정)
git commit -m "1단계: Electron 기본 설정"

# 푸시
git push
```

#### 서버 API 파일 복사 및 배포 (C:\hr-system-server)

```powershell
# 서버 폴더로 이동
cd C:\hr-system-server

# 새 함수 폴더 생성
New-Item -ItemType Directory -Path "supabase\functions\validate-license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\index.ts" "C:\hr-system-server\supabase\functions\validate-license\index.ts" -Force

# Supabase에 함수 배포
npx supabase functions deploy validate-license --project-ref pulanyznvpsrlkpqotat
```

#### 폴더 구조 확인

```powershell
# hr-system 폴더 구조 확인
tree C:\hr-system /F | Select-Object -First 100

# hr-system-server 폴더 구조 확인
tree C:\hr-system-server /F | Select-Object -First 100

# 특정 폴더만 확인
Get-ChildItem C:\hr-system\js\core
```

---

## 🏗️ 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│  사용자 PC                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  인사관리시스템.exe (Electron)                       │   │
│  │                                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
│  │  │ UI/화면     │  │ 데이터 저장  │  │ 라이선스   │  │   │
│  │  │ (HTML/JS)   │  │ (로컬 파일)  │  │ (암호화)   │  │   │
│  │  └─────────────┘  └─────────────┘  └────────────┘  │   │
│  │         │                                │         │   │
│  └─────────┼────────────────────────────────┼─────────┘   │
│            │                                │             │
└────────────┼────────────────────────────────┼─────────────┘
             │ API 호출                       │ 라이선스 검증
             ▼                                ▼
┌─────────────────────────────────────────────────────────────┐
│  서버 (Supabase)                                            │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │ Edge Functions  │  │ Database        │                  │
│  │                 │  │                 │                  │
│  │ - 호봉 계산     │  │ - users         │                  │
│  │ - 급여 계산     │  │ - profiles      │                  │
│  │ - 경력 환산     │  │ - licenses ←NEW │                  │
│  │ - 배치 API     │  │                 │                  │
│  │ - 라이선스 검증 │  │                 │                  │
│  └─────────────────┘  └─────────────────┘                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────────────────────────┐
│  GitHub Releases (업데이트 서버)                             │
│                                                             │
│  - latest.yml (최신 버전 정보)                              │
│  - 인사관리시스템_Setup_x.x.x.exe                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 데이터 저장 위치

| 항목 | 저장 위치 | 방식 | 이유 |
|------|----------|------|------|
| 직원 정보 (개인정보) | **로컬 PC** | 암호화 파일 | 개인정보보호 |
| 급여 데이터 | **로컬 PC** | 암호화 파일 | 민감정보 |
| 백업/복원 데이터 | **로컬 PC** | JSON 파일 | 사용자 데이터 |
| 설정 (조직명, 급여표 등) | **로컬 PC** | 암호화 파일 | 사용자 데이터 |
| 라이선스 키 | **로컬 PC** | 암호화 저장 | 자동 로그인 |
| 핵심 계산 로직 | **서버** | Edge Function | 코드 보호 |
| 회원 정보 | **서버** | Supabase Auth | 로그인/인증 |
| 라이선스 정보 | **서버** | Supabase DB | 유효성 검증 |

### 웹앱 vs 데스크톱 앱 비교

| 항목 | 웹앱 (현재) | 데스크톱 앱 |
|------|------------|------------|
| 저장 방식 | localStorage | 로컬 파일 (electron-store) |
| 저장 위치 | 브라우저 내부 | `C:\Users\사용자\AppData\...` |
| 백업/복원 | JSON 파일 | JSON 파일 (동일) |
| 용량 제한 | 약 5~10MB | **제한 없음** ✅ |
| 암호화 | 없음 | **AES 암호화** ✅ |

---

## 👤 사용자 경험 흐름

### 1. 최초 사용자 (신규 가입)

```
[1] 다운로드
    hr-system.vercel.app 접속 (소개 페이지)
         │
         ▼
    ┌─────────────────────────────┐
    │  🏢 인사관리시스템           │
    │                             │
    │  • 기능 소개                │
    │  • 스크린샷                 │
    │                             │
    │  [다운로드 (Windows)]       │
    └─────────────────────────────┘
         │
         ▼
    인사관리시스템_Setup.exe 다운로드 (GitHub Releases)

[2] 설치
         │
         ▼
    Setup.exe 실행
         │
         ▼
    ┌─────────────────────────────┐
    │  설치 마법사                 │
    │                             │
    │  ☑ 바탕화면 바로가기 생성   │
    │  ☑ 시작메뉴 등록            │
    │                             │
    │  [다음] → [설치] → [완료]   │
    └─────────────────────────────┘
         │
         ▼
    바탕화면 아이콘 생성

[3] 회원가입
         │
         ▼
    앱 실행
         │
         ▼
    ┌─────────────────────────────┐
    │  🔐 로그인                   │
    │                             │
    │  이메일: [            ]     │
    │  비밀번호: [            ]   │
    │                             │
    │  [로그인] [회원가입]         │
    └─────────────────────────────┘
         │
         ▼
    회원가입 폼 (이메일, 비밀번호, 이름, 기관명)
         │
         ▼
    "가입 완료! 관리자 승인을 기다려주세요"

[4] 관리자 승인 (운영자)
         │
         ▼
    Supabase 대시보드 또는 관리자 페이지
         │
         ▼
    승인 + 라이선스 키 발급 + 만료일 설정
         │
         ▼
    사용자에게 이메일 발송
    "승인 완료! 라이선스 키: XXXX-XXXX-XXXX-XXXX"

[5] 라이선스 등록
         │
         ▼
    앱 실행 → 로그인
         │
         ▼
    ┌─────────────────────────────┐
    │  🔑 라이선스 키 등록         │
    │                             │
    │  키: [XXXX-XXXX-XXXX-XXXX] │
    │                             │
    │  ☑ 이 기기에 저장           │
    │                             │
    │  [등록]                     │
    └─────────────────────────────┘
         │
         ▼
    서버 검증 → 성공 → 로컬 암호화 저장

[6] 사용 시작
         │
         ▼
    ┌─────────────────────────────────────┐
    │  🏢 인사관리시스템                   │
    │                                     │
    │  📅 라이선스: 2026.12.31까지 (342일)│
    │                                     │
    │  [직원관리] [보고서] [설정] ...     │
    └─────────────────────────────────────┘
```

### 2. 기존 사용자 (이후 접속)

```
앱 실행
    │
    ▼
저장된 라이선스 키 자동 로드
    │
    ▼
서버에 유효성 검증 요청 (온라인 필수)
    │
    ├─ 유효 → 메인 화면 진입 + 남은 기간 표시
    │
    ├─ 만료 임박 (30일 이내) → 경고 배너 + 메인 화면
    │
    ├─ 만료 임박 (7일 이내) → 팝업 경고 + 메인 화면
    │
    └─ 만료됨 → "기간이 만료되었습니다" + 갱신 안내
```

### 3. 라이선스 만료 알림 정책

| 남은 기간 | 동작 |
|----------|------|
| 30일 이하 | 상단 노란색 배너 "30일 후 만료됩니다" |
| 7일 이하 | 팝업 경고 "7일 후 만료! 갱신하세요" |
| 만료됨 | 사용 불가 + 갱신 화면만 표시 |

---

## 🔧 기술 스택

| 항목 | 기술 | 설명 |
|------|------|------|
| 앱 프레임워크 | **Electron** | 웹 기술로 데스크톱 앱 제작 |
| UI | 기존 HTML/CSS/JS | 현재 코드 100% 재사용 |
| 데이터 저장 | **electron-store** | 로컬 암호화 저장 |
| 서버 API | Supabase Edge Functions | 기존 그대로 유지 |
| 인증 | Supabase Auth | 기존 그대로 유지 |
| 라이선스 DB | Supabase Database | 신규 테이블 |
| 자동 업데이트 | **electron-updater** | GitHub Releases 연동 |
| 빌드/배포 | **electron-builder** | Setup.exe 생성 |

### 필요한 Node.js 패키지

```json
{
  "devDependencies": {
    "electron": "^28.0.0",
    "electron-builder": "^24.0.0"
  },
  "dependencies": {
    "electron-store": "^8.0.0",
    "electron-updater": "^6.0.0"
  }
}
```

---

## 🗄️ 데이터베이스 구조 (신규)

### licenses 테이블

```sql
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  
  -- 키 정보
  license_key VARCHAR(50) UNIQUE NOT NULL,  -- XXXX-XXXX-XXXX-XXXX
  
  -- 플랜 정보
  plan_type VARCHAR(20) NOT NULL,           -- 'beta', 'monthly', 'yearly'
  
  -- 기간 정보
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  
  -- 상태
  status VARCHAR(20) DEFAULT 'active',      -- 'active', 'expired', 'revoked'
  
  -- 기기 정보 (선택)
  device_id VARCHAR(100),                   -- 등록된 기기 ID
  last_verified_at TIMESTAMP,               -- 마지막 검증 시간
  
  -- 메타
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_licenses_user_id ON licenses(user_id);
CREATE INDEX idx_licenses_license_key ON licenses(license_key);
CREATE INDEX idx_licenses_status ON licenses(status);
```

### 플랜 타입

| plan_type | 설명 | 기간 |
|-----------|------|------|
| beta | 클로즈 베타 (무료) | 관리자 지정 |
| monthly | 월간 구독 (향후) | 30일 |
| yearly | 연간 구독 (향후) | 365일 |

### 상태 값

| status | 설명 |
|--------|------|
| active | 활성 (사용 가능) |
| expired | 만료됨 |
| revoked | 관리자가 취소함 |

---

## 🌐 API 목록

### 기존 API (유지)

| API | 용도 |
|-----|------|
| calculate-rank | 호봉 계산 (통합) |
| calculate-rank-utils | 호봉 계산 (개별 함수) |
| calculate-salary | 급여 계산 |
| calculate-overtime | 시간외수당 계산 |
| calculate-batch | 배치 호봉 계산 |
| validate-employee | 직원 데이터 검증 |

### 신규 API (추가)

| API | 용도 | 설명 |
|-----|------|------|
| validate-license | 라이선스 키 유효성 검증 | 앱 실행 시 호출 |
| generate-license | 라이선스 키 생성 | 관리자 승인 시 호출 |

### validate-license API 상세

**요청**:
```json
{
  "license_key": "XXXX-XXXX-XXXX-XXXX",
  "device_id": "기기고유ID",
  "app_version": "1.0.0"
}
```

**응답 (성공)**:
```json
{
  "success": true,
  "status": "active",
  "plan_type": "beta",
  "start_date": "2026-01-23",
  "expire_date": "2026-12-31",
  "days_remaining": 342
}
```

**응답 (만료)**:
```json
{
  "success": false,
  "status": "expired",
  "message": "라이선스가 만료되었습니다.",
  "expire_date": "2026-01-22"
}
```

---

## 📋 작업 단계 상세

### 1단계: Electron 기본 설정 (1~2시간)

**목표**: Electron 프로젝트 구조 생성

**작업 내용**:
1. package.json 생성 (Electron 의존성 추가)
2. main.js (메인 프로세스) 생성
3. preload.js (보안 브릿지) 생성
4. 기본 실행 테스트

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| package.json | C:\hr-system\ | Electron 프로젝트 설정 |
| main.js | C:\hr-system\ | Electron 메인 프로세스 |
| preload.js | C:\hr-system\ | 보안 브릿지 (IPC) |

**PowerShell 명령어**:
```powershell
# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\package.json" "C:\hr-system\package.json" -Force
Copy-Item "C:\Users\김화겸\Downloads\main.js" "C:\hr-system\main.js" -Force
Copy-Item "C:\Users\김화겸\Downloads\preload.js" "C:\hr-system\preload.js" -Force

# 의존성 설치
cd C:\hr-system
npm install

# 실행 테스트
npm start

# Git 커밋 (테스트 성공 후)
git add .
git commit -m "1단계: Electron 기본 설정"
git push
```

**완료 기준**:
- [ ] `npm start`로 Electron 앱 실행됨
- [ ] 기존 메인_인사.html이 앱에 표시됨
- [ ] 콘솔에 에러 없음

---

### 2단계: 기존 코드 통합 (1~2시간)

**목표**: 기존 웹앱 코드를 Electron에서 실행

**작업 내용**:
1. 모든 HTML/CSS/JS 파일 통합 확인
2. 경로 문제 해결 (file:// vs http://)
3. Supabase 연결 확인
4. 서버 API 호출 확인

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | 경로 설정 조정 |
| supabase_인사.js | C:\hr-system\js\auth\ | 필요시 수정 |

**완료 기준**:
- [ ] 로그인 페이지 정상 작동
- [ ] 메인 화면 정상 표시
- [ ] 서버 API 호출 정상 (호봉 계산 등)
- [ ] 데이터 저장/불러오기 정상

---

### 3단계: 로컬 데이터 저장 전환 (2~3시간)

**목표**: localStorage → electron-store로 전환

**작업 내용**:
1. electron-store 설치 및 설정
2. storage_인사.js 생성 (저장소 래퍼)
3. 데이터베이스_인사.js 수정 (저장 방식 변경)
4. 백업/복원 기능 수정

**생성/수정 파일**:
| 파일 | 경로 | 작업 |
|------|------|------|
| storage_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| 데이터베이스_인사.js | C:\hr-system\js\core\ | 수정 |
| 백업_인사.js | C:\hr-system\js\system\ | 수정 |
| 복원가져오기_인사.js | C:\hr-system\js\system\ | 수정 |
| preload.js | C:\hr-system\ | IPC 핸들러 추가 |
| main.js | C:\hr-system\ | IPC 핸들러 추가 |

**PowerShell 명령어**:
```powershell
# 새 폴더 생성
New-Item -ItemType Directory -Path "C:\hr-system\js\license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\storage_인사.js" "C:\hr-system\js\license\storage_인사.js" -Force
Copy-Item "C:\Users\김화겸\Downloads\데이터베이스_인사.js" "C:\hr-system\js\core\데이터베이스_인사.js" -Force
# ... 기타 파일

# Git 커밋
cd C:\hr-system
git add .
git commit -m "3단계: 로컬 데이터 저장 전환 (electron-store)"
git push
```

**완료 기준**:
- [x] 직원 데이터 로컬 파일 저장됨
- [x] 앱 재시작 후 데이터 유지됨
- [x] 백업/복원 정상 작동
- [x] 기존 localStorage 데이터 마이그레이션 (자동 동기화)

---

### 4단계: licenses 테이블 생성 (30분)

**목표**: Supabase에 라이선스 테이블 생성

**작업 내용**:
1. Supabase 대시보드 접속
2. SQL Editor에서 테이블 생성
3. 인덱스 생성
4. 테스트 데이터 삽입

**SQL 실행** (Supabase SQL Editor):
```sql
-- licenses 테이블 생성
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  license_key VARCHAR(50) UNIQUE NOT NULL,
  plan_type VARCHAR(20) NOT NULL,
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  device_id VARCHAR(100),
  last_verified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX idx_licenses_user_id ON licenses(user_id);
CREATE INDEX idx_licenses_license_key ON licenses(license_key);
CREATE INDEX idx_licenses_status ON licenses(status);
```

**완료 기준**:
- [x] licenses 테이블 생성됨
- [x] Supabase 대시보드에서 테이블 확인 가능
- [x] 테스트 데이터 삽입 가능

---

### 5단계: 라이선스 API 구현 (2~3시간)

**목표**: 라이선스 검증/생성 API 구현

**작업 내용**:
1. validate-license Edge Function 생성
2. generate-license Edge Function 생성
3. API 테스트
4. 에러 처리

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| index.ts | C:\hr-system-server\supabase\functions\validate-license\ | 라이선스 검증 |
| index.ts | C:\hr-system-server\supabase\functions\generate-license\ | 라이선스 생성 |

**PowerShell 명령어**:
```powershell
# 서버 폴더로 이동
cd C:\hr-system-server

# 새 함수 폴더 생성
New-Item -ItemType Directory -Path "supabase\functions\validate-license" -Force
New-Item -ItemType Directory -Path "supabase\functions\generate-license" -Force

# 파일 복사
Copy-Item "C:\Users\김화겸\Downloads\validate-license-index.ts" "supabase\functions\validate-license\index.ts" -Force
Copy-Item "C:\Users\김화겸\Downloads\generate-license-index.ts" "supabase\functions\generate-license\index.ts" -Force

# Supabase에 함수 배포
npx supabase functions deploy validate-license --project-ref pulanyznvpsrlkpqotat
npx supabase functions deploy generate-license --project-ref pulanyznvpsrlkpqotat
```

**완료 기준**:
- [x] validate-license API 정상 작동
- [x] generate-license API 정상 작동
- [x] 유효/만료/무효 케이스 모두 처리

---

### 6단계: 앱에 라이선스 검증 로직 추가 (2~3시간)

**목표**: 앱 실행 시 라이선스 검증

**작업 내용**:
1. license_인사.js 생성 (라이선스 관리 모듈)
2. 앱 시작 시 라이선스 검증 로직
3. 라이선스 키 입력 UI
4. 만료 알림 UI
5. 로컬 암호화 저장

**생성/수정 파일**:
| 파일 | 경로 | 작업 |
|------|------|------|
| license_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| login.html | C:\hr-system\ | 수정 (라이선스 UI 추가) |
| main.js | C:\hr-system\ | 수정 (라이선스 검증 추가) |
| 메인_인사.html | C:\hr-system\ | 수정 (남은 기간 표시) |

**완료 기준**:
- [x] 라이선스 키 입력 화면 표시
- [x] 키 검증 후 메인 화면 진입
- [x] 키 로컬 저장 및 자동 로드
- [x] 만료 시 경고/차단
- [x] 남은 기간 표시

---

### 7단계: 자동 업데이트 설정 (1~2시간)

**목표**: electron-updater로 자동 업데이트 구현

**작업 내용**:
1. electron-updater 설정
2. GitHub Releases 연동 설정
3. 업데이트 확인 로직
4. 업데이트 알림 UI

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| main.js | C:\hr-system\ | 업데이트 로직 추가 |
| package.json | C:\hr-system\ | 빌드 설정 추가 |

**완료 기준**:
- [x] 앱 시작 시 업데이트 확인
- [x] 새 버전 알림 표시
- [x] 업데이트 다운로드 및 설치

---

### 8단계: 빌드 및 테스트 (2~3시간)

**목표**: Setup.exe 생성 및 전체 테스트

**작업 내용**:
1. electron-builder 설정
2. 앱 아이콘 설정
3. 빌드 테스트
4. 설치 테스트
5. 전체 기능 테스트

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| electron-builder.yml | C:\hr-system\build\ | 빌드 설정 |
| icon.ico | C:\hr-system\assets\ | 앱 아이콘 |

**PowerShell 명령어**:
```powershell
# 폴더 생성
New-Item -ItemType Directory -Path "C:\hr-system\build" -Force
New-Item -ItemType Directory -Path "C:\hr-system\assets" -Force

# 빌드 실행
cd C:\hr-system
npm run build

# 결과물 확인
Get-ChildItem C:\hr-system\dist
```

**완료 기준**:
- [ ] Setup.exe 빌드 성공
- [ ] 설치 및 실행 정상
- [ ] 모든 기능 정상 작동
- [ ] 자동 업데이트 테스트

---

### 9단계: 소개 페이지 + 다운로드 링크 (1~2시간)

**목표**: Vercel에 소개 페이지 배포

**작업 내용**:
1. 소개 페이지 HTML 작성
2. 다운로드 버튼 (GitHub Releases 연결)
3. 기능 소개 / 스크린샷
4. Vercel 배포

**수정 파일**:
| 파일 | 경로 | 수정 내용 |
|------|------|----------|
| index.html | C:\hr-system\ | 소개 페이지로 변경 |

**완료 기준**:
- [ ] hr-system.vercel.app 접속 시 소개 페이지 표시
- [ ] 다운로드 버튼 클릭 시 exe 다운로드
- [ ] 기능 소개 표시

---

## ✅ 전체 완료 기준

- [ ] F12로 소스 코드 보이지 않음
- [ ] 라이선스 키 없이 사용 불가
- [ ] 라이선스 만료 시 사용 차단
- [ ] 데이터 로컬 저장 (암호화)
- [ ] 서버 API 정상 호출
- [ ] 자동 업데이트 작동
- [ ] 백업/복원 정상 작동
- [ ] 소개 페이지에서 다운로드 가능

---

## 📝 참고 문서

| 문서 | 설명 |
|------|------|
| 완전서버이동_로드맵_v5.md | 서버화 작업 완료 기록 |
| 인사관리시스템_서버화_작업가이드.md | 서버화 상세 과정 |
| 개발_핵심가이드_v1_5.md | 시스템 개발 가이드 |
| 시스템_레퍼런스_v1_3.md | 시스템 API 레퍼런스 |

---

## 🔄 작업 진행 기록

| 날짜 | 단계 | 작업 내용 | 상태 |
|------|------|----------|------|
| 2026-01-23 | 준비 | 로드맵 문서 작성 (v1) | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v2) - 폴더 구조/작업 방식 추가 | ✅ 완료 |
| 2026-01-23 | 1단계 | Electron 기본 설정 (package.json, main.js, preload.js) | ✅ 완료 |
| 2026-01-23 | 2단계 | 기존 코드 통합 - 로그인/메인화면 정상 작동 확인 | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v3) - 진행 상태 반영 | ✅ 완료 |
| 2026-01-23 | 3단계 | electron-store 연동 + 버그 수정 | ✅ 완료 |
| 2026-01-23 | 준비 | 로드맵 문서 업데이트 (v4) - 3단계 완료 및 발견 이슈 기록 | ✅ 완료 |
| 2026-01-23 | 4단계 | licenses 테이블 생성 (Supabase SQL Editor) | ✅ 완료 |
| 2026-01-23 | 5단계 | 라이선스 API 구현 (validate-license, generate-license) | ✅ 완료 |
| 2026-01-23 | 6단계 | 앱에 라이선스 검증 로직 추가 | ✅ 완료 |
| 2026-01-23 | 7단계 | 자동 업데이트 기능 추가 | ✅ 완료 |
| | 8단계 | 빌드 및 테스트 | ⏳ 진행 예정 |
| | 6단계 | 앱에 라이선스 검증 추가 | ⏳ 대기 |
| | 7단계 | 자동 업데이트 설정 | ⏳ 대기 |
| | 8단계 | 빌드 및 테스트 | ⏳ 대기 |
| | 9단계 | 소개 페이지 배포 | ⏳ 대기 |
| | 10단계 | 관리자 페이지 구현 | ⏳ 대기 |

---

## 📌 1단계 완료 내용

### 생성된 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| package.json | C:\hr-system\ | Electron 프로젝트 설정, 빌드 설정 포함 |
| main.js | C:\hr-system\ | Electron 메인 프로세스 (윈도우 생성, IPC 핸들러) |
| preload.js | C:\hr-system\ | 보안 브릿지 (contextBridge로 안전한 API 노출) |

### 실행 명령어

```powershell
cd C:\hr-system
npm install    # 의존성 설치 (최초 1회)
npm start      # 앱 실행
```

### Git 커밋

```powershell
git add .
git commit -m "1단계: Electron 기본 설정 (package.json, main.js, preload.js)"
git push
```

---

## 📌 2단계 완료 내용

### 테스트 결과

| 항목 | 결과 |
|------|------|
| Electron 앱 실행 | ✅ 정상 |
| 로그인 페이지 표시 | ✅ 정상 |
| Supabase 로그인 | ✅ 정상 |
| 메인 화면 진입 | ✅ 정상 |
| 서버 API 호출 | ✅ 정상 (기존 코드 그대로 동작) |

### 확인 사항

- 기존 HTML/CSS/JS 코드 수정 없이 Electron에서 정상 동작
- Supabase 인증 및 서버 API 연동 정상
- localStorage 데이터 저장/불러오기 정상 (3단계에서 electron-store로 전환 예정)

---

**문서 끝**

---

## 📌 3단계 완료 내용

### 수정/생성된 파일

| 파일 | 경로 | 버전 | 작업 내용 |
|------|------|------|----------|
| main.js | C:\hr-system\ | v3단계 | electron-store IPC 핸들러 추가 |
| preload.js | C:\hr-system\ | v3단계 | electronStore API 노출 |
| 데이터베이스_인사.js | C:\hr-system\js\core\ | v4.0.0 | electron-store 연동, 하이브리드 저장 |
| 직원등록_인사.js | C:\hr-system\js\employee\ | v4.1.1 | 호봉 계산 undefined 버그 수정 |
| 호봉계산기_인사.js | C:\hr-system\js\core\ | v4.0.1 | calculateTotalCareer() 반환값 보강 |
| 직원목록_인사.js | C:\hr-system\js\employee\ | v6.0.1 | Electron prompt() 호환성 수정 |
| .gitignore | C:\hr-system\ | - | node_modules/ 제외 추가 |

### 테스트 결과

| 항목 | 결과 |
|------|------|
| electron-store 저장 | ✅ 정상 |
| 앱 재시작 후 데이터 유지 | ✅ 정상 |
| 고유번호 생성 | ✅ 정상 |
| 신규 직원 등록 | ✅ 정상 |
| 직원 삭제 | ✅ 정상 |
| 호봉 계산 결과 표시 | ✅ 정상 |

### 수정된 버그

| 버그 | 원인 | 해결 |
|------|------|------|
| 고유번호 undefined | CONFIG.UNIQUE_CODE_PREFIX 미정의 | fallback 값 'H' 추가 |
| 호봉 계산 undefined | careerResult.years → careerResult.totalYears | 필드명 수정 |
| 직원 삭제 오류 | Electron에서 prompt() 미지원 | confirm()으로 대체 |

### Git 커밋

```powershell
git add .
git commit -m "3단계: electron-store 연동 + 버그 수정"
git push
```

**주의**: `node_modules/` 폴더가 GitHub에 push되어 오류 발생 → `.gitignore` 추가 및 `git filter-branch`로 히스토리에서 제거 완료

---

## ⚠️ 발견된 이슈: Electron에서 prompt() 미지원

### 문제

Electron 환경에서 JavaScript의 `prompt()` 함수가 지원되지 않습니다.
웹앱에서는 정상 작동하지만, Electron 앱에서 실행 시 에러 발생:

```
Uncaught Error: prompt() is and will not be supported.
```

### 영향 받는 파일 목록

| 파일 | 경로 | 사용 횟수 | 상태 |
|------|------|----------|------|
| 직원목록_인사.js | js/employee/ | 1곳 (삭제 확인) | ✅ 수정 완료 |
| 급여설정_인사.js | js/labor/ | 11곳 | ⏳ 수정 필요 |
| 백업_인사.js | js/system/ | 1곳 | ⏳ 수정 필요 |
| 육아휴직_인사.js | js/hr/ | 1곳 | ⏳ 수정 필요 |

### 해결 방법

```javascript
// 환경 감지
const isElectron = typeof window !== 'undefined' && window.isElectron === true;

if (isElectron) {
    // Electron: confirm()으로 대체
    const confirmed = confirm('정말 삭제하시겠습니까?');
    if (!confirmed) return;
} else {
    // 웹: prompt() 사용 가능
    const inputName = prompt('이름을 입력하세요:');
    if (inputName !== expectedName) return;
}
```

### 향후 작업

- 각 기능 테스트 시 해당 파일의 prompt() 사용 부분 발견되면 수정
- 또는 모든 파일 일괄 수정 (별도 작업으로 진행)

---

**문서 끝 (v4)**

---

## 📌 4단계 완료 내용

### 작업 내용

| 항목 | 결과 |
|------|------|
| Supabase SQL Editor 접속 | ✅ 완료 |
| licenses 테이블 생성 | ✅ 완료 |
| 인덱스 3개 생성 | ✅ 완료 |

### 생성된 테이블 구조

```sql
CREATE TABLE licenses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  license_key VARCHAR(50) UNIQUE NOT NULL,
  plan_type VARCHAR(20) NOT NULL,
  start_date DATE NOT NULL,
  expire_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  device_id VARCHAR(100),
  last_verified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 생성된 인덱스

| 인덱스명 | 대상 컬럼 |
|----------|----------|
| idx_licenses_user_id | user_id |
| idx_licenses_license_key | license_key |
| idx_licenses_status | status |

---

**문서 끝 (v4 업데이트)**

---

## 📌 5단계 완료 내용

### 생성된 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| index.ts | supabase/functions/validate-license/ | 라이선스 검증 API |
| deno.json | supabase/functions/validate-license/ | 설정 파일 |
| index.ts | supabase/functions/generate-license/ | 라이선스 생성 API |
| deno.json | supabase/functions/generate-license/ | 설정 파일 |

### API 테스트 결과

| API | 테스트 결과 |
|-----|------------|
| generate-license | ✅ 라이선스 생성 성공 (GHF4-NFWG-3ZMR-JY4M) |
| validate-license | ✅ 라이선스 검증 성공 (valid: true) |

### 설정 변경

| 항목 | 변경 내용 |
|------|----------|
| validate-license | Verify JWT → OFF |
| generate-license | Verify JWT → OFF |

### API 사용법

**라이선스 생성**:
```powershell
$headers = @{
    "Content-Type" = "application/json"
    "apikey" = "[SUPABASE_ANON_KEY]"
}

# 30일짜리 trial 라이선스
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/generate-license" -Method POST -Headers $headers -Body '{"plan_type":"trial","duration_days":30}'

# 1년짜리 premium 라이선스
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/generate-license" -Method POST -Headers $headers -Body '{"plan_type":"premium","duration_days":365}'
```

**라이선스 검증**:
```powershell
Invoke-RestMethod -Uri "https://pulanyznvpsrlkpqotat.supabase.co/functions/v1/validate-license" -Method POST -Headers $headers -Body '{"license_key":"XXXX-XXXX-XXXX-XXXX"}'
```

---

## 📌 6단계 완료 내용

### 생성/수정된 파일

| 파일 | 경로 | 작업 |
|------|------|------|
| license_인사.js | C:\hr-system\js\license\ | 신규 생성 |
| login.html | C:\hr-system\ | 수정 (라이선스 입력 UI 추가) |
| 메인_인사.html | C:\hr-system\ | 수정 (상단 라이선스 정보 표시) |

### 테스트 결과

| 항목 | 결과 |
|------|------|
| 로그인 | ✅ 성공 |
| 라이선스 키 입력 화면 | ✅ 표시됨 |
| 라이선스 검증 | ✅ 성공 |
| 메인 화면 진입 | ✅ 성공 |
| 상단 라이선스 정보 | ✅ "체험판 30일 남음" 표시 |

### 라이선스 흐름

```
[로그인 화면]
    │
    ▼ (이메일/비밀번호)
[계정 인증]
    │
    ▼ (승인된 사용자인지 확인)
[라이선스 확인]
    │
    ├── 유효함 → [메인 화면] (상단에 남은 기간 표시)
    │
    └── 없음/만료 → [라이선스 키 입력 화면]
                         │
                         ▼ (키 입력)
                    [서버에서 검증]
                         │
                         ├── 유효 → [메인 화면]
                         └── 무효 → 에러 메시지
```

### Git 커밋

```powershell
git add .
git commit -m "6단계: 라이선스 검증 로직 추가"
git push
```

---

## 📌 7단계 완료 내용

### 수정된 파일

| 파일 | 버전 | 작업 내용 |
|------|------|----------|
| main.js | v3.0.0 | 자동 업데이트 기능 추가 (electron-updater) |
| preload.js | v2.0.0 | 업데이트 API 추가 |
| package.json | - | electron-log 패키지 추가 |

### 자동 업데이트 기능

| 기능 | 설명 |
|------|------|
| 업데이트 확인 | 앱 시작 3초 후 자동 확인 |
| 새 버전 알림 | 다이얼로그로 다운로드 여부 확인 |
| 다운로드 진행률 | 타이틀바에 % 표시 |
| 설치 | 다운로드 완료 후 재시작 여부 확인 |

### 업데이트 흐름

```
[앱 실행] → (3초 후) → [업데이트 확인]
                            │
    ┌───────────────────────┴───────────────────────┐
    │                                               │
[새 버전 있음]                              [최신 버전]
    │                                               │
[다운로드 여부 묻기]                          [정상 사용]
    │
    ├── "다운로드" → [다운로드 중 (진행률 표시)]
    │                       │
    │               [다운로드 완료]
    │                       │
    │               [재시작 여부 묻기]
    │                       │
    │       ┌───────────────┴───────────────┐
    │       │                               │
    │   [지금 재시작]                   [나중에]
    │       │                               │
    │   [업데이트 적용]              [다음 실행 시 적용]
    │
    └── "나중에" → [다음 실행 시 다시 확인]
```

### Git 커밋

```powershell
git add .
git commit -m "7단계: 자동 업데이트 기능 추가"
git push
```

---

## 🆕 10단계: 관리자 페이지 구현 (2~3시간)

**목표**: 라이선스 발급/관리를 위한 웹 기반 관리자 페이지

**작업 내용**:
1. 관리자 페이지 HTML/JS 작성
2. 라이선스 발급 UI (달력으로 만료일 선택)
3. 라이선스 목록 조회
4. 라이선스 관리 (연장/취소/재발급)
5. 사용자 관리 (승인/거절)

**생성 파일**:
| 파일 | 경로 | 설명 |
|------|------|------|
| admin.html | C:\hr-system\ | 관리자 페이지 |
| admin_인사.js | C:\hr-system\js\admin\ | 관리자 기능 모듈 |

**관리자 페이지 기능**:

```
┌─────────────────────────────────────────────────────────┐
│  🔐 인사관리시스템 - 관리자 페이지                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📋 라이선스 발급                                        │
│  ┌─────────────────────────────────────────────────┐   │
│  │  플랜 유형:  [trial ▼] [basic ▼] [premium ▼]    │   │
│  │  만료일:     [2026-12-31] 📅                    │   │
│  │  사용자:     [선택안함 ▼] (선택사항)             │   │
│  │                                                 │   │
│  │  [🔑 라이선스 발급하기]                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  📊 발급된 라이선스 목록                                 │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 라이선스 키      │ 플랜   │ 만료일     │ 상태   │   │
│  │ GHF4-NFWG-...  │ trial  │ 2026-02-22│ 활성   │   │
│  │ ABCD-EFGH-...  │ premium│ 2027-01-23│ 활성   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  👥 사용자 승인 대기                                     │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 이메일              │ 가입일     │ 액션        │   │
│  │ user@example.com   │ 2026-01-20│ [승인][거절] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**완료 기준**:
- [ ] 관리자 페이지 접속 가능
- [ ] 달력으로 만료일 선택하여 라이선스 발급
- [ ] 발급된 라이선스 목록 조회
- [ ] 라이선스 상태 변경 (활성/비활성/취소)
- [ ] 사용자 승인/거절 기능

---

## 🔧 선택사항: 관리자 디버그 모드

**목적**: 빌드된 앱에서 원호성님만 콘솔(DevTools) 열 수 있도록 함

**작동 방식**:
```
1. 비밀 단축키 입력 (예: Ctrl + Shift + Alt + D)
2. 비밀번호 입력창 표시
3. 비밀번호 일치 → 콘솔 열림
   비밀번호 불일치 → 아무 일도 안 일어남
```

**장점**:
- 일반 사용자: 코드 접근 불가
- 관리자(원호성님): 다른 PC에서도 디버깅 가능

**우선순위**: 낮음 (필요할 때 추가)

---

**문서 끝 (v4 최종)**
